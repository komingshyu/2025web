</script><!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLæ ¼å¼åŒ–å·¥å…· ğŸ› ï¸âœ¨</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-css.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.js"></script>
    <style>
        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            color: #333;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #ff69b4;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            resize: vertical;
            background-color: #fff;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        button {
            padding: 12px 25px;
            background-color: #ff69b4;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s, transform 0.3s;
        }
        button:hover {
            background-color: #ff1493;
            transform: scale(1.05);
        }
        pre {
            background-color: #fff;
            padding: 15px;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        .error {
            color: #ff0000;
            text-align: center;
            font-weight: bold;
        }
        .emoji {
            font-size: 1.5em;
        }
        .success {
            color: #28a745;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>HTMLæ ¼å¼åŒ–å·¥å…· <span class="emoji">ğŸ› ï¸âœ¨</span></h1>
    <div class="container">
        <textarea id="inputHtml" placeholder="è¼¸å…¥æ‚¨çš„HTMLä»£ç¢¼... ğŸ’»"></textarea>
        <div class="button-group">
            <button onclick="formatHtml()">æ ¼å¼åŒ– âœ¨</button>
            <button onclick="copyFormatted()">æ ¼å¼åŒ–æ–‡ä»¶è¤‡è£½ ğŸ“‹</button>
            <button onclick="clearData()">æ¸…ç©ºè³‡æ–™ ğŸ—‘ï¸</button>
        </div>
        <pre id="outputHtml"></pre>
        <p id="errorMessage" class="error"></p>
        <p id="successMessage" class="success"></p>
    </div>

    <script>
        function formatHtml() {
            const input = document.getElementById('inputHtml').value;
            const output = document.getElementById('outputHtml');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            try {
                // é è™•ç† <script> å’Œ <style> å…§å®¹
                const processedInput = preprocessInput(input);
                // ä½¿ç”¨ js-beautify çš„ html_beautify æ ¼å¼åŒ– HTML
                const options = {
                    indent_size: 2,
                    wrap_line_length: 80,
                    preserve_newlines: true,
                    max_preserve_newlines: 2,
                    indent_inner_html: true,
                    indent_scripts: 'normal',
                    unformatted: [] // ç¢ºä¿ä¸å¿½ç•¥ä»»ä½•æ¨™ç±¤
                };
                const formatted = html_beautify(processedInput, options);
                output.textContent = formatted;
                errorMessage.textContent = '';
                successMessage.textContent = '';
            } catch (error) {
                output.textContent = '';
                errorMessage.textContent = 'éŒ¯èª¤ï¼šç„¡æ•ˆçš„HTMLä»£ç¢¼ ğŸ˜”';
                successMessage.textContent = '';
            }
        }

        function preprocessInput(html) {
            // ä½¿ç”¨ DOMParser è§£æ HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const parsererror = doc.querySelector('parsererror');
            if (parsererror) {
                throw new Error('Invalid HTML');
            }

            // è™•ç† <script> å’Œ <style> æ¨™ç±¤å…§çš„å…§å®¹
            const scripts = doc.querySelectorAll('script');
            const styles = doc.querySelectorAll('style');
            
            scripts.forEach(script => {
                const jsCode = script.textContent.trim();
                if (jsCode) {
                    // ä½¿ç”¨ js_beautify æ ¼å¼åŒ– JavaScript
                    const jsOptions = {
                        indent_size: 2,
                        brace_style: 'collapse,preserve-inline',
                        space_before_conditional: true
                    };
                    script.textContent = '\n' + js_beautify(jsCode, jsOptions) + '\n';
                }
            });

            styles.forEach(style => {
                const cssCode = style.textContent.trim();
                if (cssCode) {
                    // ä½¿ç”¨ css_beautify æ ¼å¼åŒ– CSS
                    const cssOptions = {
                        indent_size: 2
                    };
                    style.textContent = '\n' + css_beautify(cssCode, cssOptions) + '\n';
                }
            });

            // å°‡è™•ç†å¾Œçš„ DOM è½‰å›å­—ç¬¦ä¸²
            return doc.documentElement.outerHTML;
        }

        function copyFormatted() {
            const output = document.getElementById('outputHtml').textContent;
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');

            if (!output) {
                errorMessage.textContent = 'éŒ¯èª¤ï¼šç„¡æ ¼å¼åŒ–å…§å®¹å¯è¤‡è£½ ğŸ˜”';
                successMessage.textContent = '';
                return;
            }

            navigator.clipboard.writeText(output).then(() => {
                successMessage.textContent = 'å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼ğŸ‰';
                errorMessage.textContent = '';
                // 3ç§’å¾Œæ¸…é™¤æˆåŠŸè¨Šæ¯
                setTimeout(() => {
                    successMessage.textContent = '';
                }, 3000);
            }).catch(() => {
                errorMessage.textContent = 'è¤‡è£½å¤±æ•—ï¼Œè«‹é‡è©¦ ğŸ˜”';
                successMessage.textContent = '';
            });
        }

        function clearData() {
            const input = document.getElementById('inputHtml');
            const output = document.getElementById('outputHtml');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');

            input.value = '';
            output.textContent = '';
            errorMessage.textContent = '';
            successMessage.textContent = 'å·²æ¸…ç©ºæ‰€æœ‰è³‡æ–™ï¼ğŸ—‘ï¸';
            // 3ç§’å¾Œæ¸…é™¤æˆåŠŸè¨Šæ¯
            setTimeout(() => {
                successMessage.textContent = '';
            }, 3000);
        }
    </script>
</body>
</html>