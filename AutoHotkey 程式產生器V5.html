<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoHotkey ç¨‹å¼ç”¢ç”Ÿå™¨ - Blockly ç‰ˆ</title>
    <script src="https://unpkg.com/blockly@9.2.0/blockly.min.js"></script>
    <script src="https://unpkg.com/blockly@9.2.0/blocks.min.js"></script>
    <script src="https://unpkg.com/blockly@9.2.0/javascript.min.js"></script>
    <script src="https://unpkg.com/blockly@9.2.0/msg/zh-hans.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header p {
            margin-top: 0.5rem;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .container {
            display: flex;
            height: calc(100vh - 100px);
            gap: 1rem;
            padding: 1rem;
        }

        .left-panel {
            width: 280px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .examples-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            border: 2px solid #e9ecef;
        }

        .examples-title {
            font-size: 1rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .example-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            transform: translateY(-1px);
        }

        .example-item h4 {
            font-size: 0.9rem;
            color: #495057;
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .example-item p {
            font-size: 0.8rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .category {
            margin-bottom: 1.5rem;
        }

        .category h3 {
            font-size: 1rem;
            color: #667eea;
            margin-bottom: 0.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .block-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .block-item:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .block-item:active {
            transform: translateY(0);
        }

        .block-item .icon {
            font-size: 1.2rem;
        }

        .workspace-container {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        #blocklyDiv {
            width: 100%;
            height: 100%;
        }

        .right-panel {
            width: 400px;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .preview-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: #667eea;
            color: white;
            padding: 1rem;
            border-radius: 10px 10px 0 0;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            background: #f8f9fa;
        }

        .preview-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .controls {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem;
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #495057;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .notification {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #28a745;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .blocklyToolboxDiv {
            background: #f8f9fa !important;
        }

        .blocklyTreeSelected .blocklyTreeLabel {
            color: #667eea !important;
            font-weight: bold !important;
        }

        .example-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .example-modal-content {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .example-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e9ecef;
        }

        .example-modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #667eea;
        }

        .example-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .example-modal-close:hover {
            color: #dc3545;
        }

        .example-code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            margin: 1rem 0;
            white-space: pre-wrap;
        }

        .example-description {
            line-height: 1.6;
            color: #495057;
            margin-bottom: 1rem;
        }

        .example-usage {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin: 1rem 0;
        }

        .example-usage h4 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .btn-load-example {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            margin-right: 0.5rem;
        }

        .btn-load-example:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        @media (max-width: 1200px) {
            .right-panel {
                width: 350px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .left-panel {
                width: 100%;
                height: 200px;
            }
            
            .right-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>AutoHotkey ç¨‹å¼ç”¢ç”Ÿå™¨</h1>
        <p>ä½¿ç”¨æ‹–æ›³ç©æœ¨çš„æ–¹å¼å¿«é€Ÿç”¢ç”Ÿ AutoHotkey è…³æœ¬</p>
    </header>

    <div class="container">
        <div class="left-panel">
            <div class="examples-section">
                <div class="examples-title">
                    <span>ğŸ“š</span>
                    <span>ç¯„ä¾‹æ•™å­¸</span>
                </div>
                
                <div class="example-item" onclick="showExample('hello-world')">
                    <h4><span>ğŸ‘‹</span> Hello World</h4>
                    <p>æœ€åŸºç¤çš„ AutoHotkey è…³æœ¬ï¼Œé¡¯ç¤ºè¨Šæ¯æ¡†</p>
                </div>
                
                <div class="example-item" onclick="showExample('hotkey-basic')">
                    <h4><span>ğŸ”‘</span> åŸºç¤ç†±éµ</h4>
                    <p>è¨­å®šç°¡å–®çš„ç†±éµä¾†åŸ·è¡Œå‹•ä½œ</p>
                </div>
                
                <div class="example-item" onclick="showExample('auto-typing')">
                    <h4><span>âŒ¨ï¸</span> è‡ªå‹•è¼¸å…¥</h4>
                    <p>è‡ªå‹•è¼¸å…¥æ–‡å­—å’ŒæŒ‰éµçµ„åˆ</p>
                </div>
                
                <div class="example-item" onclick="showExample('mouse-automation')">
                    <h4><span>ğŸ–±ï¸</span> æ»‘é¼ è‡ªå‹•åŒ–</h4>
                    <p>æ§åˆ¶æ»‘é¼ ç§»å‹•å’Œé»æ“Š</p>
                </div>
                
                <div class="example-item" onclick="showExample('window-control')">
                    <h4><span>ğŸªŸ</span> è¦–çª—æ§åˆ¶</h4>
                    <p>è‡ªå‹•åŒ–è¦–çª—æ“ä½œå’Œç®¡ç†</p>
                </div>
                
                <div class="example-item" onclick="showExample('file-operations')">
                    <h4><span>ğŸ“</span> æª”æ¡ˆæ“ä½œ</h4>
                    <p>è®€å–ã€å¯«å…¥å’Œè™•ç†æª”æ¡ˆ</p>
                </div>
                
                <div class="example-item" onclick="showExample('game-macro')">
                    <h4><span>ğŸ®</span> éŠæˆ²å·¨é›†</h4>
                    <p>ç°¡å–®çš„éŠæˆ²è‡ªå‹•åŒ–è…³æœ¬</p>
                </div>
                
                <div class="example-item" onclick="showExample('productivity')">
                    <h4><span>âš¡</span> æ•ˆç‡å·¥å…·</h4>
                    <p>æå‡å·¥ä½œæ•ˆç‡çš„å¯¦ç”¨è…³æœ¬</p>
                </div>
            </div>

            <div class="category">
                <h3>ğŸ”¤ è¼¸å…¥/è¼¸å‡º</h3>
                <div class="block-item" data-type="ahk_send">
                    <span class="icon">âŒ¨ï¸</span>
                    <span>Send æŒ‰éµ</span>
                </div>
                <div class="block-item" data-type="ahk_sendkeys">
                    <span class="icon">ğŸ¹</span>
                    <span>SendKeys æŒ‰éµè¨­å®š</span>
                </div>
                <div class="block-item" data-type="ahk_sendraw">
                    <span class="icon">ğŸ“</span>
                    <span>SendRaw åŸå§‹æ–‡å­—</span>
                </div>
                <div class="block-item" data-type="ahk_msgbox">
                    <span class="icon">ğŸ’¬</span>
                    <span>MsgBox è¨Šæ¯æ¡†</span>
                </div>
                <div class="block-item" data-type="ahk_inputbox">
                    <span class="icon">ğŸ“</span>
                    <span>InputBox è¼¸å…¥æ¡†</span>
                </div>
                <div class="block-item" data-type="ahk_tooltip">
                    <span class="icon">ğŸ’¡</span>
                    <span>ToolTip æç¤º</span>
                </div>
            </div>
            
            <div class="category">
                <h3>â±ï¸ å»¶é²èˆ‡ç­‰å¾…</h3>
                <div class="block-item" data-type="ahk_sleep">
                    <span class="icon">â³</span>
                    <span>Sleep å»¶é²</span>
                </div>
                <div class="block-item" data-type="ahk_settimer">
                    <span class="icon">â°</span>
                    <span>SetTimer è¨ˆæ™‚å™¨</span>
                </div>
                <div class="block-item" data-type="ahk_wait">
                    <span class="icon">â¸ï¸</span>
                    <span>Wait ç­‰å¾…</span>
                </div>
            </div>
            
            <div class="category">
                <h3>ğŸ–±ï¸ æ»‘é¼ æ§åˆ¶</h3>
                <div class="block-item" data-type="ahk_mousemove">
                    <span class="icon">ğŸ–±ï¸</span>
                    <span>MouseMove ç§»å‹•</span>
                </div>
                <div class="block-item" data-type="ahk_mouseclick">
                    <span class="icon">ğŸ‘†</span>
                    <span>MouseClick é»æ“Š</span>
                </div>
                <div class="block-item" data-type="ahk_mousedrag">
                    <span class="icon">âœ‹</span>
                    <span>MouseDrag æ‹–æ›³</span>
                </div>
                <div class="block-item" data-type="ahk_mousegetpos">
                    <span class="icon">ğŸ“</span>
                    <span>MouseGetPos å–å¾—ä½ç½®</span>
                </div>
            </div>
            
            <div class="category">
                <h3>âŒ¨ï¸ éµç›¤æ§åˆ¶</h3>
                <div class="block-item" data-type="ahk_hotkey">
                    <span class="icon">ğŸ”‘</span>
                    <span>HotKey ç†±éµ</span>
                </div>
                <div class="block-item" data-type="ahk_keywait">
                    <span class="icon">â³</span>
                    <span>KeyWait ç­‰å¾…æŒ‰éµ</span>
                </div>
                <div class="block-item" data-type="ahk_getkeystate">
                    <span class="icon">ğŸ”</span>
                    <span>GetKeyState æŒ‰éµç‹€æ…‹</span>
                </div>
            </div>
            
            <div class="category">
                <h3>ğŸ”„ æµç¨‹æ§åˆ¶</h3>
                <div class="block-item" data-type="ahk_loop">
                    <span class="icon">ğŸ”„</span>
                    <span>Loop è¿´åœˆ</span>
                </div>
                <div class="block-item" data-type="ahk_while">
                    <span class="icon">ğŸ”„</span>
                    <span>While è¿´åœˆ</span>
                </div>
                <div class="block-item" data-type="ahk_for">
                    <span class="icon">ğŸ”¢</span>
                    <span>For è¿´åœˆ</span>
                </div>
                <div class="block-item" data-type="ahk_if">
                    <span class="icon">â“</span>
                    <span>If æ¢ä»¶åˆ¤æ–·</span>
                </div>
                <div class="block-item" data-type="ahk_else">
                    <span class="icon">â”</span>
                    <span>Else å¦å‰‡</span>
                </div>
                <div class="block-item" data-type="ahk_break">
                    <span class="icon">â¹ï¸</span>
                    <span>Break ä¸­æ–·</span>
                </div>
                <div class="block-item" data-type="ahk_continue">
                    <span class="icon">â­ï¸</span>
                    <span>Continue ç¹¼çºŒ</span>
                </div>
            </div>
            
            <div class="category">
                <h3>ğŸ“ æª”æ¡ˆæ“ä½œ</h3>
                <div class="block-item" data-type="ahk_run">
                    <span class="icon">ğŸš€</span>
                    <span>Run åŸ·è¡Œç¨‹å¼</span>
                </div>
                <div class="block-item" data-type="ahk_runwait">
                    <span class="icon">â³</span>
                    <span>RunWait ç­‰å¾…åŸ·è¡Œ</span>
                </div>
                <div class="block-item" data-type="ahk_fileexist">
                    <span class="icon">ğŸ“„</span>
                    <span>FileExist æª¢æŸ¥æª”æ¡ˆ</span>
                </div>
                <div class="block-item" data-type="ahk_fileread">
                    <span class="icon">ğŸ“–</span>
                    <span>FileRead è®€å–æª”æ¡ˆ</span>
                </div>
                <div class="block-item" data-type="ahk_filewrite">
                    <span class="icon">âœï¸</span>
                    <span>FileWrite å¯«å…¥æª”æ¡ˆ</span>
                </div>
                <div class="block-item" data-type="ahk_fileappend">
                    <span class="icon">ğŸ“</span>
                    <span>FileAppend é™„åŠ æª”æ¡ˆ</span>
                </div>
            </div>

            <div class="category">
                <h3>ğŸ”§ ç³»çµ±æ“ä½œ</h3>
                <div class="block-item" data-type="ahk_winactivate">
                    <span class="icon">ğŸªŸ</span>
                    <span>WinActivate å•Ÿå‹•è¦–çª—</span>
                </div>
                <div class="block-item" data-type="ahk_winclose">
                    <span class="icon">âŒ</span>
                    <span>WinClose é—œé–‰è¦–çª—</span>
                </div>
                <div class="block-item" data-type="ahk_winmove">
                    <span class="icon">ğŸ“</span>
                    <span>WinMove ç§»å‹•è¦–çª—</span>
                </div>
                <div class="block-item" data-type="ahk_process">
                    <span class="icon">âš™ï¸</span>
                    <span>Process ç¨‹åºæ“ä½œ</span>
                </div>
                <div class="block-item" data-type="ahk_regread">
                    <span class="icon">ğŸ“‹</span>
                    <span>RegRead è®€å–ç™»éŒ„</span>
                </div>
                <div class="block-item" data-type="ahk_regwrite">
                    <span class="icon">âœï¸</span>
                    <span>RegWrite å¯«å…¥ç™»éŒ„</span>
                </div>
            </div>

            <div class="category">
                <h3>ğŸ“Š è®Šæ•¸èˆ‡è³‡æ–™</h3>
                <div class="block-item" data-type="ahk_varassign">
                    <span class="icon">ğŸ“¦</span>
                    <span>è®Šæ•¸è³¦å€¼</span>
                </div>
                <div class="block-item" data-type="ahk_varincrement">
                    <span class="icon">â•</span>
                    <span>è®Šæ•¸éå¢</span>
                </div>
                <div class="block-item" data-type="ahk_array">
                    <span class="icon">ğŸ“š</span>
                    <span>é™£åˆ—æ“ä½œ</span>
                </div>
                <div class="block-item" data-type="ahk_strlen">
                    <span class="icon">ğŸ“</span>
                    <span>StrLen å­—ä¸²é•·åº¦</span>
                </div>
                <div class="block-item" data-type="ahk_substr">
                    <span class="icon">âœ‚ï¸</span>
                    <span>SubStr å­å­—ä¸²</span>
                </div>
            </div>
        </div>

        <div class="workspace-container">
            <div id="blocklyDiv"></div>
        </div>

        <div class="right-panel">
            <div class="preview-container">
                <div class="preview-header">
                    <span>ğŸ“„ è…³æœ¬é è¦½</span>
                    <span id="codeLength">0 è¡Œ</span>
                </div>
                <div class="preview-content">
                    <pre id="generatedCode">; å°‡ç©æœ¨æ‹–æ›³åˆ°å·¦å´ç·¨è¼¯å€é–‹å§‹å»ºç«‹æ‚¨çš„ AutoHotkey è…³æœ¬</pre>
                </div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="downloadScript()">
                    ğŸ’¾ ä¸‹è¼‰ .AHK æª”æ¡ˆ
                </button>
                <button class="btn btn-secondary" onclick="copyToClipboard()">
                    ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿
                </button>
                <button class="btn-danger" onclick="clearWorkspace()">
                    ğŸ—‘ï¸ æ¸…ç©ºç·¨è¼¯å€
                </button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <!-- ç¯„ä¾‹æ¨¡æ…‹æ¡† -->
    <div class="example-modal" id="exampleModal">
        <div class="example-modal-content">
            <div class="example-modal-header">
                <div class="example-modal-title" id="exampleTitle">ç¯„ä¾‹æ¨™é¡Œ</div>
                <button class="example-modal-close" onclick="closeExample()">&times;</button>
            </div>
            <div id="exampleContent">
                <!-- ç¯„ä¾‹å…§å®¹å°‡å‹•æ…‹æ’å…¥ -->
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let workspace = null;
        let isInitialized = false;

        // ç¯„ä¾‹è³‡æ–™
        const examples = {
            'hello-world': {
                title: 'Hello World - åŸºç¤ç¯„ä¾‹',
                description: 'é€™æ˜¯æœ€åŸºç¤çš„ AutoHotkey è…³æœ¬ï¼Œå±•ç¤ºå¦‚ä½•é¡¯ç¤ºè¨Šæ¯æ¡†å’ŒåŸ·è¡Œç°¡å–®çš„å‹•ä½œã€‚',
                code: `; Hello World åŸºç¤ç¯„ä¾‹
MsgBox, æ­¡è¿ä½¿ç”¨ AutoHotkeyï¼
Sleep, 1000
MsgBox, é€™æ˜¯ä¸€å€‹ç°¡å–®çš„è¨Šæ¯æ¡†
ToolTip, è…³æœ¬åŸ·è¡Œä¸­...
Sleep, 2000`,
                usage: 'é€™å€‹ç¯„ä¾‹é©åˆåˆå­¸è€…äº†è§£ AutoHotkey çš„åŸºæœ¬èªæ³•å’Œå·¥ä½œæ–¹å¼ã€‚',
                blocks: [
                    { type: 'ahk_msgbox', values: { MESSAGE: '"æ­¡è¿ä½¿ç”¨ AutoHotkeyï¼"' } },
                    { type: 'ahk_sleep', values: { TIME: '1000' } },
                    { type: 'ahk_msgbox', values: { MESSAGE: '"é€™æ˜¯ä¸€å€‹ç°¡å–®çš„è¨Šæ¯æ¡†"' } },
                    { type: 'ahk_tooltip', values: { TEXT: '"è…³æœ¬åŸ·è¡Œä¸­..."' } },
                    { type: 'ahk_sleep', values: { TIME: '2000' } }
                ]
            },
            'hotkey-basic': {
                title: 'åŸºç¤ç†±éµè¨­å®š',
                description: 'å­¸ç¿’å¦‚ä½•è¨­å®šç†±éµä¾†åŸ·è¡Œç‰¹å®šçš„å‹•ä½œï¼Œé€™æ˜¯ AutoHotkey æœ€å¸¸ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚',
                code: `; åŸºç¤ç†±éµç¯„ä¾‹
F1::
    MsgBox, æ‚¨æŒ‰ä¸‹äº† F1 éµ
Return

^j::
    Send, Hello World!
    Send, {Enter}
Return

!n::
    Run, notepad.exe
Return`,
                usage: 'F1 é¡¯ç¤ºè¨Šæ¯æ¡†ï¼ŒCtrl+J è¼¸å…¥æ–‡å­—ï¼ŒAlt+N é–‹å•Ÿè¨˜äº‹æœ¬ã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F1"' }, statements: { DO: [
                        { type: 'ahk_msgbox', values: { MESSAGE: '"æ‚¨æŒ‰ä¸‹äº† F1 éµ"' } }
                    ]}},
                    { type: 'ahk_hotkey', values: { KEY: '"^j"' }, statements: { DO: [
                        { type: 'ahk_send', values: { TEXT: '"Hello World!"' } },
                        { type: 'ahk_sendkeys', values: { KEY: '{Enter}', REPEAT: '1' } }
                    ]}},
                    { type: 'ahk_hotkey', values: { KEY: '"!n"' }, statements: { DO: [
                        { type: 'ahk_run', values: { PROGRAM: '"notepad.exe"' } }
                    ]}}
                ]
            },
            'auto-typing': {
                title: 'è‡ªå‹•è¼¸å…¥æ–‡å­—',
                description: 'ç¤ºç¯„å¦‚ä½•è‡ªå‹•è¼¸å…¥æ–‡å­—ã€å¡«å¯«è¡¨å–®å’ŒåŸ·è¡ŒæŒ‰éµçµ„åˆã€‚',
                code: `; è‡ªå‹•è¼¸å…¥ç¯„ä¾‹
F2::
    Send, é€™æ˜¯è‡ªå‹•è¼¸å…¥çš„æ–‡å­—
    Send, {Enter}
    Send, ç¬¬äºŒè¡Œæ–‡å­—
    Send, {Tab}
    Send, å¡«å¯«è¡¨å–®å…§å®¹
    SendKeys, Ctrl+Home æ¬¡æ•¸ 1
    Send, ç§»å‹•åˆ°æ–‡ä»¶é–‹é ­
Return`,
                usage: 'æŒ‰ F2 è‡ªå‹•è¼¸å…¥å¤šè¡Œæ–‡å­—ä¸¦æ¨¡æ“¬è¡¨å–®å¡«å¯«ã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F2"' }, statements: { DO: [
                        { type: 'ahk_send', values: { TEXT: '"é€™æ˜¯è‡ªå‹•è¼¸å…¥çš„æ–‡å­—"' } },
                        { type: 'ahk_sendkeys', values: { KEY: '{Enter}', REPEAT: '1' } },
                        { type: 'ahk_send', values: { TEXT: '"ç¬¬äºŒè¡Œæ–‡å­—"' } },
                        { type: 'ahk_sendkeys', values: { KEY: '{Tab}', REPEAT: '1' } },
                        { type: 'ahk_send', values: { TEXT: '"å¡«å¯«è¡¨å–®å…§å®¹"' } },
                        { type: 'ahk_sendkeys', values: { KEY: 'Ctrl+Home', REPEAT: '1' } },
                        { type: 'ahk_send', values: { TEXT: '"ç§»å‹•åˆ°æ–‡ä»¶é–‹é ­"' } }
                    ]}}
                ]
            },
            'mouse-automation': {
                title: 'æ»‘é¼ è‡ªå‹•åŒ–æ§åˆ¶',
                description: 'å­¸ç¿’å¦‚ä½•æ§åˆ¶æ»‘é¼ ç§»å‹•ã€é»æ“Šå’Œæ‹–æ›³ç­‰æ“ä½œã€‚',
                code: `; æ»‘é¼ è‡ªå‹•åŒ–ç¯„ä¾‹
F3::
    MouseMove, 100, 100
    Sleep, 500
    MouseClick, L
    Sleep, 300
    MouseMove, 200, 200
    MouseClick, R
    MouseGetPos, mouseX, mouseY
    MsgBox, æ»‘é¼ ä½ç½®: X=%mouseX%, Y=%mouseY%
Return`,
                usage: 'æŒ‰ F3 åŸ·è¡Œæ»‘é¼ ç§»å‹•ã€é»æ“Šä¸¦å–å¾—ç•¶å‰ä½ç½®ã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F3"' }, statements: { DO: [
                        { type: 'ahk_mousemove', values: { X: '100', Y: '100' } },
                        { type: 'ahk_sleep', values: { TIME: '500' } },
                        { type: 'ahk_mouseclick', values: { BUTTON: 'L' } },
                        { type: 'ahk_sleep', values: { TIME: '300' } },
                        { type: 'ahk_mousemove', values: { X: '200', Y: '200' } },
                        { type: 'ahk_mouseclick', values: { BUTTON: 'R' } },
                        { type: 'ahk_mousegetpos', values: { XVAR: '"mouseX"', YVAR: '"mouseY"' } },
                        { type: 'ahk_msgbox', values: { MESSAGE: '"æ»‘é¼ ä½ç½®: X=%mouseX%, Y=%mouseY%"' } }
                    ]}}
                ]
            },
            'window-control': {
                title: 'è¦–çª—æ§åˆ¶èˆ‡ç®¡ç†',
                description: 'ç¤ºç¯„å¦‚ä½•è‡ªå‹•åŒ–è¦–çª—æ“ä½œï¼ŒåŒ…æ‹¬å•Ÿå‹•ã€ç§»å‹•ã€é—œé–‰è¦–çª—ç­‰ã€‚',
                code: `; è¦–çª—æ§åˆ¶ç¯„ä¾‹
F4::
    Run, notepad.exe
    WinWait, Untitled
    Sleep, 1000
    WinMove, Untitled, , 100, 100
    Send, é€™æ˜¯åœ¨ç§»å‹•å¾Œçš„è¦–çª—ä¸­è¼¸å…¥çš„æ–‡å­—
    Sleep, 2000
    WinClose, Untitled
Return`,
                usage: 'æŒ‰ F4 é–‹å•Ÿè¨˜äº‹æœ¬ï¼Œç§»å‹•è¦–çª—ä½ç½®ï¼Œè¼¸å…¥æ–‡å­—å¾Œé—œé–‰ã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F4"' }, statements: { DO: [
                        { type: 'ahk_run', values: { PROGRAM: '"notepad.exe"' } },
                        { type: 'ahk_winactivate', values: { TITLE: '"Untitled"' } },
                        { type: 'ahk_sleep', values: { TIME: '1000' } },
                        { type: 'ahk_winmove', values: { TITLE: '"Untitled"', X: '100', Y: '100' } },
                        { type: 'ahk_send', values: { TEXT: '"é€™æ˜¯åœ¨ç§»å‹•å¾Œçš„è¦–çª—ä¸­è¼¸å…¥çš„æ–‡å­—"' } },
                        { type: 'ahk_sleep', values: { TIME: '2000' } },
                        { type: 'ahk_winclose', values: { TITLE: '"Untitled"' } }
                    ]}}
                ]
            },
            'file-operations': {
                title: 'æª”æ¡ˆè®€å¯«æ“ä½œ',
                description: 'å­¸ç¿’å¦‚ä½•è®€å–ã€å¯«å…¥å’Œè™•ç†æª”æ¡ˆå…§å®¹ã€‚',
                code: `; æª”æ¡ˆæ“ä½œç¯„ä¾‹
F5::
    If FileExist("test.txt")
    {
        FileRead, content, test.txt
        MsgBox, æª”æ¡ˆå…§å®¹: %content%
    }
    Else
    {
        FileWrite, test.txt, é€™æ˜¯æ–°å»ºç«‹çš„æª”æ¡ˆå…§å®¹
        MsgBox, æª”æ¡ˆå·²å»ºç«‹
    }
    FileAppend, test.txt, %A_Now% - è…³æœ¬åŸ·è¡Œæ™‚é–“
Return`,
                usage: 'æŒ‰ F5 æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨ï¼Œè®€å–å…§å®¹æˆ–å»ºç«‹æ–°æª”æ¡ˆã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F5"' }, statements: { DO: [
                        { type: 'ahk_if', values: { CONDITION: 'FileExist("test.txt")' }, statements: { DO: [
                            { type: 'ahk_fileread', values: { VARIABLE: '"content"', FILE: '"test.txt"' } },
                            { type: 'ahk_msgbox', values: { MESSAGE: '"æª”æ¡ˆå…§å®¹: %content%"' } }
                        ]}},
                        { type: 'ahk_else', statements: { DO: [
                            { type: 'ahk_filewrite', values: { CONTENT: '"é€™æ˜¯æ–°å»ºç«‹çš„æª”æ¡ˆå…§å®¹"', FILE: '"test.txt"' } },
                            { type: 'ahk_msgbox', values: { MESSAGE: '"æª”æ¡ˆå·²å»ºç«‹"' } }
                        ]}},
                        { type: 'ahk_fileappend', values: { CONTENT: 'A_Now . " - è…³æœ¬åŸ·è¡Œæ™‚é–“"', FILE: '"test.txt"' } }
                    ]}}
                ]
            },
            'game-macro': {
                title: 'éŠæˆ²è‡ªå‹•åŒ–å·¨é›†',
                description: 'ç°¡å–®çš„éŠæˆ²è‡ªå‹•åŒ–è…³æœ¬ï¼Œç¤ºç¯„é€£çºŒæŒ‰éµå’Œè¿´åœˆæ“ä½œã€‚',
                code: `; éŠæˆ²å·¨é›†ç¯„ä¾‹
F6::
    Loop, 10
    {
        Send, 1
        Sleep, 100
        Send, 2
        Sleep, 100
        Send, 3
        Sleep, 500
    }
Return

F7::
    While GetKeyState("F7", "P")
    {
        MouseClick, L
        Sleep, 50
    }
Return`,
                usage: 'F6 åŸ·è¡ŒæŠ€èƒ½é€£æ“Šï¼ŒæŒ‰ä½ F7 é€£çºŒé»æ“Šæ»‘é¼ ã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"F6"' }, statements: { DO: [
                        { type: 'ahk_loop', values: { TIMES: '10' }, statements: { DO: [
                            { type: 'ahk_send', values: { TEXT: '"1"' } },
                            { type: 'ahk_sleep', values: { TIME: '100' } },
                            { type: 'ahk_send', values: { TEXT: '"2"' } },
                            { type: 'ahk_sleep', values: { TIME: '100' } },
                            { type: 'ahk_send', values: { TEXT: '"3"' } },
                            { type: 'ahk_sleep', values: { TIME: '500' } }
                        ]}}
                    ]}},
                    { type: 'ahk_hotkey', values: { KEY: '"F7"' }, statements: { DO: [
                        { type: 'ahk_while', values: { CONDITION: 'GetKeyState("F7", "P")' }, statements: { DO: [
                            { type: 'ahk_mouseclick', values: { BUTTON: 'L' } },
                            { type: 'ahk_sleep', values: { TIME: '50' } }
                        ]}}
                    ]}}
                ]
            },
            'productivity': {
                title: 'æ•ˆç‡æå‡å·¥å…·',
                description: 'å¯¦ç”¨çš„è¾¦å…¬å®¤è‡ªå‹•åŒ–å·¥å…·ï¼Œæå‡å·¥ä½œæ•ˆç‡ã€‚',
                code: `; æ•ˆç‡å·¥å…·ç¯„ä¾‹
^!s::
    Send, Sincerely,
    Send, {Enter}
    Send, Your Name
    Send, {Enter}
    Send, your.email@example.com
Return

#t::
    FormatTime, timestamp, , yyyy-MM-dd HH:mm:ss
    Send, %timestamp%
Return

^+d::
    WinActivate, ahk_class Notepad
    Send, ^a
    Send, ^c
    WinActivate, ahk_class Chrome_WidgetWin_1
    Send, ^v
Return`,
                usage: 'Ctrl+Alt+S æ’å…¥ç°½åæª”ï¼ŒWin+T æ’å…¥æ™‚é–“æˆ³ï¼ŒCtrl+Shift+D è¤‡è£½è²¼ä¸Šã€‚',
                blocks: [
                    { type: 'ahk_hotkey', values: { KEY: '"^!s"' }, statements: { DO: [
                        { type: 'ahk_send', values: { TEXT: '"Sincerely,"' } },
                        { type: 'ahk_sendkeys', values: { KEY: '{Enter}', REPEAT: '1' } },
                        { type: 'ahk_send', values: { TEXT: '"Your Name"' } },
                        { type: 'ahk_sendkeys', values: { KEY: '{Enter}', REPEAT: '1' } },
                        { type: 'ahk_send', values: { TEXT: '"your.email@example.com"' } }
                    ]}},
                    { type: 'ahk_hotkey', values: { KEY: '"#t"' }, statements: { DO: [
                        { type: 'ahk_varassign', values: { VARIABLE: '"timestamp"', VALUE: 'A_Now' } },
                        { type: 'ahk_send', values: { TEXT: 'timestamp' } }
                    ]}},
                    { type: 'ahk_hotkey', values: { KEY: '"^+d"' }, statements: { DO: [
                        { type: 'ahk_winactivate', values: { TITLE: '"ahk_class Notepad"' } },
                        { type: 'ahk_sendkeys', values: { KEY: 'Ctrl+A', REPEAT: '1' } },
                        { type: 'ahk_sendkeys', values: { KEY: 'Ctrl+C', REPEAT: '1' } },
                        { type: 'ahk_winactivate', values: { TITLE: '"ahk_class Chrome_WidgetWin_1"' } },
                        { type: 'ahk_sendkeys', values: { KEY: 'Ctrl+V', REPEAT: '1' } }
                    ]}}
                ]
            }
        };

        // ç­‰å¾… Blockly è¼‰å…¥å®Œæˆ
        function waitForBlockly(callback, attempts = 0) {
            if (typeof Blockly !== 'undefined' && 
                Blockly.Blocks && 
                Blockly.JavaScript && 
                Blockly.inject &&
                Blockly.Xml &&
                Blockly.utils &&
                Blockly.utils.Coordinate) {
                console.log('Blockly å·²è¼‰å…¥ï¼Œé–‹å§‹åˆå§‹åŒ–');
                callback();
            } else if (attempts < 30) {
                console.log('ç­‰å¾… Blockly è¼‰å…¥...', attempts);
                setTimeout(() => waitForBlockly(callback, attempts + 1), 300);
            } else {
                console.error('Blockly è¼‰å…¥è¶…æ™‚');
                showNotification('ç³»çµ±è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
            }
        }

        // å®šç¾© AutoHotkey ç©æœ¨
        function defineBlocks() {
            console.log('å®šç¾© AutoHotkey ç©æœ¨...');

            // è¼¸å…¥/è¼¸å‡ºé¡ç©æœ¨
            Blockly.Blocks['ahk_send'] = {
                init: function() {
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("Send");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("ç™¼é€æŒ‰éµæˆ–æ–‡å­—");
                }
            };

            // SendKeys æŒ‰éµè¨­å®šç©æœ¨
            Blockly.Blocks['ahk_sendkeys'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("SendKeys")
                        .appendField(new Blockly.FieldDropdown([
                            ["Enter", "{Enter}"],
                            ["Tab", "{Tab}"],
                            ["Esc", "{Esc}"],
                            ["Space", "{Space}"],
                            ["Backspace", "{Backspace}"],
                            ["Delete", "{Delete}"],
                            ["Insert", "{Insert}"],
                            ["Home", "{Home}"],
                            ["End", "{End}"],
                            ["PgUp", "{PgUp}"],
                            ["PgDn", "{PgDn}"],
                            ["Up", "{Up}"],
                            ["Down", "{Down}"],
                            ["Left", "{Left}"],
                            ["Right", "{Right}"],
                            ["F1", "{F1}"],
                            ["F2", "{F2}"],
                            ["F3", "{F3}"],
                            ["F4", "{F4}"],
                            ["F5", "{F5}"],
                            ["F6", "{F6}"],
                            ["F7", "{F7}"],
                            ["F8", "{F8}"],
                            ["F9", "{F9}"],
                            ["F10", "{F10}"],
                            ["F11", "{F11}"],
                            ["F12", "{F12}"],
                            ["Ctrl+C", "^c"],
                            ["Ctrl+V", "^v"],
                            ["Ctrl+X", "^x"],
                            ["Ctrl+Z", "^z"],
                            ["Ctrl+A", "^a"],
                            ["Ctrl+S", "^s"],
                            ["Alt+Tab", "!{Tab}"],
                            ["Alt+F4", "!{F4}"],
                            ["Win+R", "#r"],
                            ["Win+E", "#e"],
                            ["Win+D", "#d"],
                            ["Shift+Tab", "+{Tab}"],
                            ["Ctrl+Shift+Esc", "^+{Esc}"],
                            ["PrintScreen", "{PrintScreen}"],
                            ["ScrollLock", "{ScrollLock}"],
                            ["CapsLock", "{CapsLock}"],
                            ["NumLock", "{NumLock}"],
                            ["Ctrl+Alt+Del", "^!{Delete}"],
                            ["Ctrl+Home", "^{Home}"],
                            ["Ctrl+End", "^{End}"],
                            ["Shift+Home", "+{Home}"],
                            ["Shift+End", "+{End}"],
                            ["Ctrl+Left", "^{Left}"],
                            ["Ctrl+Right", "^{Right}"],
                            ["Ctrl+Up", "^{Up}"],
                            ["Ctrl+Down", "^{Down}"]
                        ]), "KEY");
                    this.appendValueInput("REPEAT")
                        .setCheck("Number")
                        .appendField("æ¬¡æ•¸");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("ç™¼é€é è¨­çš„æŒ‰éµçµ„åˆ");
                }
            };

            Blockly.Blocks['ahk_sendraw'] = {
                init: function() {
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("SendRaw");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("ç™¼é€åŸå§‹æ–‡å­—ï¼Œä¸è§£é‡‹ç‰¹æ®Šå­—å…ƒ");
                }
            };

            Blockly.Blocks['ahk_msgbox'] = {
                init: function() {
                    this.appendValueInput("MESSAGE")
                        .setCheck("String")
                        .appendField("MsgBox");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("é¡¯ç¤ºè¨Šæ¯æ¡†");
                }
            };

            Blockly.Blocks['ahk_inputbox'] = {
                init: function() {
                    this.appendValueInput("PROMPT")
                        .setCheck("String")
                        .appendField("InputBox");
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("å„²å­˜åˆ°");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("é¡¯ç¤ºè¼¸å…¥æ¡†ä¸¦å„²å­˜çµæœ");
                }
            };

            Blockly.Blocks['ahk_tooltip'] = {
                init: function() {
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("ToolTip");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("é¡¯ç¤ºå·¥å…·æç¤º");
                }
            };

            // å»¶é²èˆ‡ç­‰å¾…é¡ç©æœ¨
            Blockly.Blocks['ahk_sleep'] = {
                init: function() {
                    this.appendValueInput("TIME")
                        .setCheck("Number")
                        .appendField("Sleep");
                    this.appendDummyInput()
                        .appendField("æ¯«ç§’");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("å»¶é²æŒ‡å®šçš„æ¯«ç§’æ•¸");
                }
            };

            Blockly.Blocks['ahk_settimer'] = {
                init: function() {
                    this.appendValueInput("LABEL")
                        .setCheck("String")
                        .appendField("SetTimer");
                    this.appendValueInput("INTERVAL")
                        .setCheck("Number")
                        .appendField("é–“éš”");
                    this.appendDummyInput()
                        .appendField("æ¯«ç§’");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("è¨­å®šè¨ˆæ™‚å™¨");
                }
            };

            Blockly.Blocks['ahk_wait'] = {
                init: function() {
                    this.appendValueInput("TIME")
                        .setCheck("Number")
                        .appendField("Wait");
                    this.appendDummyInput()
                        .appendField("æ¯«ç§’");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(120);
                    this.setTooltip("ç­‰å¾…æŒ‡å®šçš„æ™‚é–“");
                }
            };

            // æ»‘é¼ æ§åˆ¶é¡ç©æœ¨
            Blockly.Blocks['ahk_mousemove'] = {
                init: function() {
                    this.appendValueInput("X")
                        .setCheck("Number")
                        .appendField("MouseMove");
                    this.appendValueInput("Y")
                        .setCheck("Number")
                        .appendField(",");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(290);
                    this.setTooltip("ç§»å‹•æ»‘é¼ åˆ°æŒ‡å®šåº§æ¨™");
                }
            };

            Blockly.Blocks['ahk_mouseclick'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("MouseClick")
                        .appendField(new Blockly.FieldDropdown([["å·¦éµ", "L"], ["å³éµ", "R"], ["ä¸­éµ", "M"]]), "BUTTON");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(290);
                    this.setTooltip("é»æ“Šæ»‘é¼ æŒ‰éµ");
                }
            };

            Blockly.Blocks['ahk_mousedrag'] = {
                init: function() {
                    this.appendValueInput("X1")
                        .setCheck("Number")
                        .appendField("MouseDrag");
                    this.appendValueInput("Y1")
                        .setCheck("Number")
                        .appendField(",");
                    this.appendValueInput("X2")
                        .setCheck("Number")
                        .appendField("åˆ°");
                    this.appendValueInput("Y2")
                        .setCheck("Number")
                        .appendField(",");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(290);
                    this.setTooltip("æ‹–æ›³æ»‘é¼ å¾ä¸€å€‹ä½ç½®åˆ°å¦ä¸€å€‹ä½ç½®");
                }
            };

            Blockly.Blocks['ahk_mousegetpos'] = {
                init: function() {
                    this.appendValueInput("XVAR")
                        .setCheck("String")
                        .appendField("MouseGetPos");
                    this.appendValueInput("YVAR")
                        .setCheck("String")
                        .appendField("å„²å­˜åˆ°");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(290);
                    this.setTooltip("å–å¾—æ»‘é¼ ä½ç½®");
                }
            };

            // éµç›¤æ§åˆ¶é¡ç©æœ¨
            Blockly.Blocks['ahk_hotkey'] = {
                init: function() {
                    this.appendValueInput("KEY")
                        .setCheck("String")
                        .appendField("HotKey");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("åŸ·è¡Œ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(20);
                    this.setTooltip("è¨­å®šç†±éµ");
                }
            };

            Blockly.Blocks['ahk_keywait'] = {
                init: function() {
                    this.appendValueInput("KEY")
                        .setCheck("String")
                        .appendField("KeyWait");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(20);
                    this.setTooltip("ç­‰å¾…æŒ‰éµæŒ‰ä¸‹");
                }
            };

            Blockly.Blocks['ahk_getkeystate'] = {
                init: function() {
                    this.appendValueInput("KEY")
                        .setCheck("String")
                        .appendField("GetKeyState");
                    this.setOutput(true, "Boolean");
                    this.setColour(20);
                    this.setTooltip("å–å¾—æŒ‰éµç‹€æ…‹");
                }
            };

            // æµç¨‹æ§åˆ¶é¡ç©æœ¨
            Blockly.Blocks['ahk_loop'] = {
                init: function() {
                    this.appendValueInput("TIMES")
                        .setCheck("Number")
                        .appendField("Loop");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("æ¬¡æ•¸");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(160);
                    this.setTooltip("åŸ·è¡ŒæŒ‡å®šæ¬¡æ•¸çš„è¿´åœˆ");
                }
            };

            Blockly.Blocks['ahk_while'] = {
                init: function() {
                    this.appendValueInput("CONDITION")
                        .setCheck("Boolean")
                        .appendField("While");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("åŸ·è¡Œ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(160);
                    this.setTooltip("ç•¶æ¢ä»¶ç‚ºçœŸæ™‚åŸ·è¡Œè¿´åœˆ");
                }
            };

            Blockly.Blocks['ahk_for'] = {
                init: function() {
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("For");
                    this.appendValueInput("START")
                        .setCheck("Number")
                        .appendField("å¾");
                    this.appendValueInput("END")
                        .setCheck("Number")
                        .appendField("åˆ°");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("åŸ·è¡Œ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(160);
                    this.setTooltip("For è¿´åœˆ");
                }
            };

            Blockly.Blocks['ahk_if'] = {
                init: function() {
                    this.appendValueInput("CONDITION")
                        .setCheck("Boolean")
                        .appendField("If");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("å‰‡");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(210);
                    this.setTooltip("æ¢ä»¶åˆ¤æ–·");
                }
            };

            Blockly.Blocks['ahk_else'] = {
                init: function() {
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .appendField("Else");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(210);
                    this.setTooltip("å¦å‰‡åŸ·è¡Œ");
                }
            };

            Blockly.Blocks['ahk_break'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("Break");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(210);
                    this.setTooltip("ä¸­æ–·è¿´åœˆ");
                }
            };

            Blockly.Blocks['ahk_continue'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("Continue");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(210);
                    this.setTooltip("ç¹¼çºŒä¸‹ä¸€æ¬¡è¿´åœˆ");
                }
            };

            // æª”æ¡ˆæ“ä½œé¡ç©æœ¨
            Blockly.Blocks['ahk_run'] = {
                init: function() {
                    this.appendValueInput("PROGRAM")
                        .setCheck("String")
                        .appendField("Run");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("åŸ·è¡Œç¨‹å¼");
                }
            };

            Blockly.Blocks['ahk_runwait'] = {
                init: function() {
                    this.appendValueInput("PROGRAM")
                        .setCheck("String")
                        .appendField("RunWait");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("åŸ·è¡Œç¨‹å¼ä¸¦ç­‰å¾…å®Œæˆ");
                }
            };

            Blockly.Blocks['ahk_fileexist'] = {
                init: function() {
                    this.appendValueInput("FILE")
                        .setCheck("String")
                        .appendField("FileExist");
                    this.setOutput(true, "Boolean");
                    this.setColour(330);
                    this.setTooltip("æª¢æŸ¥æª”æ¡ˆæ˜¯å¦å­˜åœ¨");
                }
            };

            Blockly.Blocks['ahk_fileread'] = {
                init: function() {
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("FileRead");
                    this.appendValueInput("FILE")
                        .setCheck("String")
                        .appendField("å¾æª”æ¡ˆ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("è®€å–æª”æ¡ˆå…§å®¹");
                }
            };

            Blockly.Blocks['ahk_filewrite'] = {
                init: function() {
                    this.appendValueInput("CONTENT")
                        .setCheck("String")
                        .appendField("FileWrite");
                    this.appendValueInput("FILE")
                        .setCheck("String")
                        .appendField("åˆ°æª”æ¡ˆ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("å¯«å…¥å…§å®¹åˆ°æª”æ¡ˆ");
                }
            };

            Blockly.Blocks['ahk_fileappend'] = {
                init: function() {
                    this.appendValueInput("CONTENT")
                        .setCheck("String")
                        .appendField("FileAppend");
                    this.appendValueInput("FILE")
                        .setCheck("String")
                        .appendField("é™„åŠ åˆ°æª”æ¡ˆ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(330);
                    this.setTooltip("é™„åŠ å…§å®¹åˆ°æª”æ¡ˆ");
                }
            };

            // ç³»çµ±æ“ä½œé¡ç©æœ¨
            Blockly.Blocks['ahk_winactivate'] = {
                init: function() {
                    this.appendValueInput("TITLE")
                        .setCheck("String")
                        .appendField("WinActivate");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("å•Ÿå‹•æŒ‡å®šè¦–çª—");
                }
            };

            Blockly.Blocks['ahk_winclose'] = {
                init: function() {
                    this.appendValueInput("TITLE")
                        .setCheck("String")
                        .appendField("WinClose");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("é—œé–‰æŒ‡å®šè¦–çª—");
                }
            };

            Blockly.Blocks['ahk_winmove'] = {
                init: function() {
                    this.appendValueInput("TITLE")
                        .setCheck("String")
                        .appendField("WinMove");
                    this.appendValueInput("X")
                        .setCheck("Number")
                        .appendField("åˆ°");
                    this.appendValueInput("Y")
                        .setCheck("Number")
                        .appendField(",");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("ç§»å‹•è¦–çª—åˆ°æŒ‡å®šä½ç½®");
                }
            };

            Blockly.Blocks['ahk_process'] = {
                init: function() {
                    this.appendDummyInput()
                        .appendField("Process")
                        .appendField(new Blockly.FieldDropdown([["é—œé–‰", "Close"], ["ç­‰å¾…", "Wait"], ["å­˜åœ¨", "Exist"]]), "ACTION");
                    this.appendValueInput("NAME")
                        .setCheck("String")
                        .appendField("");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("ç¨‹åºæ“ä½œ");
                }
            };

            Blockly.Blocks['ahk_regread'] = {
                init: function() {
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("RegRead");
                    this.appendValueInput("KEY")
                        .setCheck("String")
                        .appendField("å¾ç™»éŒ„éµ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("è®€å–ç™»éŒ„å€¼");
                }
            };

            Blockly.Blocks['ahk_regwrite'] = {
                init: function() {
                    this.appendValueInput("VALUE")
                        .setCheck("String")
                        .appendField("RegWrite");
                    this.appendValueInput("KEY")
                        .setCheck("String")
                        .appendField("åˆ°ç™»éŒ„éµ");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(45);
                    this.setTooltip("å¯«å…¥ç™»éŒ„å€¼");
                }
            };

            // è®Šæ•¸èˆ‡è³‡æ–™é¡ç©æœ¨
            Blockly.Blocks['ahk_varassign'] = {
                init: function() {
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("è¨­å®š");
                    this.appendValueInput("VALUE")
                        .setCheck(null)
                        .appendField("ç‚º");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("è®Šæ•¸è³¦å€¼");
                }
            };

            Blockly.Blocks['ahk_varincrement'] = {
                init: function() {
                    this.appendValueInput("VARIABLE")
                        .setCheck("String")
                        .appendField("éå¢");
                    this.appendValueInput("VALUE")
                        .setCheck("Number")
                        .appendField("");
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(260);
                    this.setTooltip("è®Šæ•¸éå¢");
                }
            };

            Blockly.Blocks['ahk_array'] = {
                init: function() {
                    this.appendValueInput("ARRAY")
                        .setCheck("String")
                        .appendField("é™£åˆ—");
                    this.appendValueInput("INDEX")
                        .setCheck("Number")
                        .appendField("[");
                    this.appendDummyInput()
                        .appendField("]");
                    this.setOutput(true, null);
                    this.setColour(260);
                    this.setTooltip("é™£åˆ—å…ƒç´ å­˜å–");
                }
            };

            Blockly.Blocks['ahk_strlen'] = {
                init: function() {
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("StrLen");
                    this.setOutput(true, "Number");
                    this.setColour(260);
                    this.setTooltip("å–å¾—å­—ä¸²é•·åº¦");
                }
            };

            Blockly.Blocks['ahk_substr'] = {
                init: function() {
                    this.appendValueInput("TEXT")
                        .setCheck("String")
                        .appendField("SubStr");
                    this.appendValueInput("START")
                        .setCheck("Number")
                        .appendField("å¾ä½ç½®");
                    this.appendValueInput("LENGTH")
                        .setCheck("Number")
                        .appendField("é•·åº¦");
                    this.setOutput(true, "String");
                    this.setColour(260);
                    this.setTooltip("å–å¾—å­å­—ä¸²");
                }
            };

            console.log('ç©æœ¨å®šç¾©å®Œæˆ');
        }

        // å®šç¾©ç¨‹å¼ç¢¼ç”Ÿæˆå™¨
        function defineGenerators() {
            console.log('å®šç¾©ç¨‹å¼ç¢¼ç”Ÿæˆå™¨...');

            // è¼¸å…¥/è¼¸å‡ºé¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_send'] = function(block) {
                var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                // ç§»é™¤å¼•è™Ÿ
                text = text.replace(/^["']|["']$/g, '');
                return 'Send, ' + text + '\n';
            };

            // SendKeys æŒ‰éµè¨­å®šç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_sendkeys'] = function(block) {
                var key = block.getFieldValue('KEY');
                var repeat = Blockly.JavaScript.valueToCode(block, 'REPEAT', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                var code = 'Loop, ' + repeat + '\n{\n';
                code += '    Send, ' + key + '\n';
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_sendraw'] = function(block) {
                var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                // ç§»é™¤å¼•è™Ÿ
                text = text.replace(/^["']|["']$/g, '');
                return 'SendRaw, ' + text + '\n';
            };

            Blockly.JavaScript['ahk_msgbox'] = function(block) {
                var message = Blockly.JavaScript.valueToCode(block, 'MESSAGE', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello World"';
                // ç§»é™¤å¼•è™Ÿ
                message = message.replace(/^["']|["']$/g, '');
                return 'MsgBox, ' + message + '\n';
            };

            Blockly.JavaScript['ahk_inputbox'] = function(block) {
                var prompt = Blockly.JavaScript.valueToCode(block, 'PROMPT', Blockly.JavaScript.ORDER_ATOMIC) || '"è«‹è¼¸å…¥å…§å®¹"';
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"result"';
                // ç§»é™¤å¼•è™Ÿ
                prompt = prompt.replace(/^["']|["']$/g, '');
                variable = variable.replace(/^["']|["']$/g, '');
                return 'InputBox, ' + variable + ', ' + prompt + '\n';
            };

            Blockly.JavaScript['ahk_tooltip'] = function(block) {
                var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '"æç¤º"';
                // ç§»é™¤å¼•è™Ÿ
                text = text.replace(/^["']|["']$/g, '');
                return 'ToolTip, ' + text + '\n';
            };

            // å»¶é²èˆ‡ç­‰å¾…é¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_sleep'] = function(block) {
                var time = Blockly.JavaScript.valueToCode(block, 'TIME', Blockly.JavaScript.ORDER_ATOMIC) || '1000';
                return 'Sleep, ' + time + '\n';
            };

            Blockly.JavaScript['ahk_settimer'] = function(block) {
                var label = Blockly.JavaScript.valueToCode(block, 'LABEL', Blockly.JavaScript.ORDER_ATOMIC) || '"Timer"';
                var interval = Blockly.JavaScript.valueToCode(block, 'INTERVAL', Blockly.JavaScript.ORDER_ATOMIC) || '1000';
                // ç§»é™¤å¼•è™Ÿ
                label = label.replace(/^["']|["']$/g, '');
                return 'SetTimer, ' + label + ', ' + interval + '\n';
            };

            Blockly.JavaScript['ahk_wait'] = function(block) {
                var time = Blockly.JavaScript.valueToCode(block, 'TIME', Blockly.JavaScript.ORDER_ATOMIC) || '1000';
                return 'Wait, ' + time + '\n';
            };

            // æ»‘é¼ æ§åˆ¶é¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_mousemove'] = function(block) {
                var x = Blockly.JavaScript.valueToCode(block, 'X', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                var y = Blockly.JavaScript.valueToCode(block, 'Y', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                return 'MouseMove, ' + x + ', ' + y + '\n';
            };

            Blockly.JavaScript['ahk_mouseclick'] = function(block) {
                var button = block.getFieldValue('BUTTON');
                return 'MouseClick, ' + button + '\n';
            };

            Blockly.JavaScript['ahk_mousedrag'] = function(block) {
                var x1 = Blockly.JavaScript.valueToCode(block, 'X1', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                var y1 = Blockly.JavaScript.valueToCode(block, 'Y1', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                var x2 = Blockly.JavaScript.valueToCode(block, 'X2', Blockly.JavaScript.ORDER_ATOMIC) || '100';
                var y2 = Blockly.JavaScript.valueToCode(block, 'Y2', Blockly.JavaScript.ORDER_ATOMIC) || '100';
                return 'MouseClickDrag, L, ' + x1 + ', ' + y1 + ', ' + x2 + ', ' + y2 + '\n';
            };

            Blockly.JavaScript['ahk_mousegetpos'] = function(block) {
                var xvar = Blockly.JavaScript.valueToCode(block, 'XVAR', Blockly.JavaScript.ORDER_ATOMIC) || '"MouseX"';
                var yvar = Blockly.JavaScript.valueToCode(block, 'YVAR', Blockly.JavaScript.ORDER_ATOMIC) || '"MouseY"';
                // ç§»é™¤å¼•è™Ÿ
                xvar = xvar.replace(/^["']|["']$/g, '');
                yvar = yvar.replace(/^["']|["']$/g, '');
                return 'MouseGetPos, ' + xvar + ', ' + yvar + '\n';
            };

            // éµç›¤æ§åˆ¶é¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_hotkey'] = function(block) {
                var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '"F1"';
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                // ç§»é™¤å¼•è™Ÿ
                key = key.replace(/^["']|["']$/g, '');
                var code = key + '::\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += 'Return\n';
                return code;
            };

            Blockly.JavaScript['ahk_keywait'] = function(block) {
                var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '"Enter"';
                // ç§»é™¤å¼•è™Ÿ
                key = key.replace(/^["']|["']$/g, '');
                return 'KeyWait, ' + key + '\n';
            };

            Blockly.JavaScript['ahk_getkeystate'] = function(block) {
                var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '"Shift"';
                // ç§»é™¤å¼•è™Ÿ
                key = key.replace(/^["']|["']$/g, '');
                return ['GetKeyState(' + key + ')', Blockly.JavaScript.ORDER_FUNCTION_CALL];
            };

            // æµç¨‹æ§åˆ¶é¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_loop'] = function(block) {
                var times = Blockly.JavaScript.valueToCode(block, 'TIMES', Blockly.JavaScript.ORDER_ATOMIC) || '5';
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                var code = 'Loop, ' + times + '\n{\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_while'] = function(block) {
                var condition = Blockly.JavaScript.valueToCode(block, 'CONDITION', Blockly.JavaScript.ORDER_ATOMIC) || 'true';
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                var code = 'While ' + condition + '\n{\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_for'] = function(block) {
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"i"';
                var start = Blockly.JavaScript.valueToCode(block, 'START', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                var end = Blockly.JavaScript.valueToCode(block, 'END', Blockly.JavaScript.ORDER_ATOMIC) || '10';
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                var code = 'For ' + variable + ', ' + start + ', ' + end + '\n{\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_if'] = function(block) {
                var condition = Blockly.JavaScript.valueToCode(block, 'CONDITION', Blockly.JavaScript.ORDER_ATOMIC) || 'true';
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                var code = 'If (' + condition + ')\n{\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_else'] = function(block) {
                var statements_do = Blockly.JavaScript.statementToCode(block, 'DO');
                var code = 'Else\n{\n';
                if (statements_do) {
                    code += statements_do;
                }
                code += '}\n';
                return code;
            };

            Blockly.JavaScript['ahk_break'] = function(block) {
                return 'Break\n';
            };

            Blockly.JavaScript['ahk_continue'] = function(block) {
                return 'Continue\n';
            };

            // æª”æ¡ˆæ“ä½œé¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_run'] = function(block) {
                var program = Blockly.JavaScript.valueToCode(block, 'PROGRAM', Blockly.JavaScript.ORDER_ATOMIC) || '"notepad.exe"';
                // ç§»é™¤å¼•è™Ÿ
                program = program.replace(/^["']|["']$/g, '');
                return 'Run, ' + program + '\n';
            };

            Blockly.JavaScript['ahk_runwait'] = function(block) {
                var program = Blockly.JavaScript.valueToCode(block, 'PROGRAM', Blockly.JavaScript.ORDER_ATOMIC) || '"notepad.exe"';
                // ç§»é™¤å¼•è™Ÿ
                program = program.replace(/^["']|["']$/g, '');
                return 'RunWait, ' + program + '\n';
            };

            Blockly.JavaScript['ahk_fileexist'] = function(block) {
                var file = Blockly.JavaScript.valueToCode(block, 'FILE', Blockly.JavaScript.ORDER_ATOMIC) || '"test.txt"';
                // ç§»é™¤å¼•è™Ÿ
                file = file.replace(/^["']|["']$/g, '');
                return ['FileExist(' + file + ')', Blockly.JavaScript.ORDER_FUNCTION_CALL];
            };

            Blockly.JavaScript['ahk_fileread'] = function(block) {
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"content"';
                var file = Blockly.JavaScript.valueToCode(block, 'FILE', Blockly.JavaScript.ORDER_ATOMIC) || '"test.txt"';
                // ç§»é™¤å¼•è™Ÿ
                variable = variable.replace(/^["']|["']$/g, '');
                file = file.replace(/^["']|["']$/g, '');
                return 'FileRead, ' + variable + ', ' + file + '\n';
            };

            Blockly.JavaScript['ahk_filewrite'] = function(block) {
                var content = Blockly.JavaScript.valueToCode(block, 'CONTENT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                var file = Blockly.JavaScript.valueToCode(block, 'FILE', Blockly.JavaScript.ORDER_ATOMIC) || '"test.txt"';
                // ç§»é™¤å¼•è™Ÿ
                content = content.replace(/^["']|["']$/g, '');
                file = file.replace(/^["']|["']$/g, '');
                return 'FileWrite, ' + file + ', ' + content + '\n';
            };

            Blockly.JavaScript['ahk_fileappend'] = function(block) {
                var content = Blockly.JavaScript.valueToCode(block, 'CONTENT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                var file = Blockly.JavaScript.valueToCode(block, 'FILE', Blockly.JavaScript.ORDER_ATOMIC) || '"test.txt"';
                // ç§»é™¤å¼•è™Ÿ
                content = content.replace(/^["']|["']$/g, '');
                file = file.replace(/^["']|["']$/g, '');
                return 'FileAppend, ' + content + ', ' + file + '\n';
            };

            // ç³»çµ±æ“ä½œé¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_winactivate'] = function(block) {
                var title = Blockly.JavaScript.valueToCode(block, 'TITLE', Blockly.JavaScript.ORDER_ATOMIC) || '"Untitled"';
                // ç§»é™¤å¼•è™Ÿ
                title = title.replace(/^["']|["']$/g, '');
                return 'WinActivate, ' + title + '\n';
            };

            Blockly.JavaScript['ahk_winclose'] = function(block) {
                var title = Blockly.JavaScript.valueToCode(block, 'TITLE', Blockly.JavaScript.ORDER_ATOMIC) || '"Untitled"';
                // ç§»é™¤å¼•è™Ÿ
                title = title.replace(/^["']|["']$/g, '');
                return 'WinClose, ' + title + '\n';
            };

            Blockly.JavaScript['ahk_winmove'] = function(block) {
                var title = Blockly.JavaScript.valueToCode(block, 'TITLE', Blockly.JavaScript.ORDER_ATOMIC) || '"Untitled"';
                var x = Blockly.JavaScript.valueToCode(block, 'X', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                var y = Blockly.JavaScript.valueToCode(block, 'Y', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                // ç§»é™¤å¼•è™Ÿ
                title = title.replace(/^["']|["']$/g, '');
                return 'WinMove, ' + title + ', , ' + x + ', ' + y + '\n';
            };

            Blockly.JavaScript['ahk_process'] = function(block) {
                var action = block.getFieldValue('ACTION');
                var name = Blockly.JavaScript.valueToCode(block, 'NAME', Blockly.JavaScript.ORDER_ATOMIC) || '"notepad.exe"';
                // ç§»é™¤å¼•è™Ÿ
                name = name.replace(/^["']|["']$/g, '');
                return 'Process, ' + action + ', ' + name + '\n';
            };

            Blockly.JavaScript['ahk_regread'] = function(block) {
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"value"';
                var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '"HKEY_LOCAL_MACHINE\\Software\\MyApp"';
                // ç§»é™¤å¼•è™Ÿ
                variable = variable.replace(/^["']|["']$/g, '');
                key = key.replace(/^["']|["']$/g, '');
                return 'RegRead, ' + variable + ', ' + key + '\n';
            };

            Blockly.JavaScript['ahk_regwrite'] = function(block) {
                var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '"data"';
                var key = Blockly.JavaScript.valueToCode(block, 'KEY', Blockly.JavaScript.ORDER_ATOMIC) || '"HKEY_LOCAL_MACHINE\\Software\\MyApp"';
                // ç§»é™¤å¼•è™Ÿ
                value = value.replace(/^["']|["']$/g, '');
                key = key.replace(/^["']|["']$/g, '');
                return 'RegWrite, REG_SZ, ' + key + ', , ' + value + '\n';
            };

            // è®Šæ•¸èˆ‡è³‡æ–™é¡ç”Ÿæˆå™¨
            Blockly.JavaScript['ahk_varassign'] = function(block) {
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"myVar"';
                var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '0';
                // ç§»é™¤å¼•è™Ÿ
                variable = variable.replace(/^["']|["']$/g, '');
                return variable + ' := ' + value + '\n';
            };

            Blockly.JavaScript['ahk_varincrement'] = function(block) {
                var variable = Blockly.JavaScript.valueToCode(block, 'VARIABLE', Blockly.JavaScript.ORDER_ATOMIC) || '"myVar"';
                var value = Blockly.JavaScript.valueToCode(block, 'VALUE', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                // ç§»é™¤å¼•è™Ÿ
                variable = variable.replace(/^["']|["']$/g, '');
                return variable + ' += ' + value + '\n';
            };

            Blockly.JavaScript['ahk_array'] = function(block) {
                var array = Blockly.JavaScript.valueToCode(block, 'ARRAY', Blockly.JavaScript.ORDER_ATOMIC) || '"myArray"';
                var index = Blockly.JavaScript.valueToCode(block, 'INDEX', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                // ç§»é™¤å¼•è™Ÿ
                array = array.replace(/^["']|["']$/g, '');
                return [array + '[' + index + ']', Blockly.JavaScript.ORDER_MEMBER];
            };

            Blockly.JavaScript['ahk_strlen'] = function(block) {
                var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                return ['StrLen(' + text + ')', Blockly.JavaScript.ORDER_FUNCTION_CALL];
            };

            Blockly.JavaScript['ahk_substr'] = function(block) {
                var text = Blockly.JavaScript.valueToCode(block, 'TEXT', Blockly.JavaScript.ORDER_ATOMIC) || '"Hello"';
                var start = Blockly.JavaScript.valueToCode(block, 'START', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                var length = Blockly.JavaScript.valueToCode(block, 'LENGTH', Blockly.JavaScript.ORDER_ATOMIC) || '1';
                return ['SubStr(' + text + ', ' + start + ', ' + length + ')', Blockly.JavaScript.ORDER_FUNCTION_CALL];
            };

            console.log('ç¨‹å¼ç¢¼ç”Ÿæˆå™¨å®šç¾©å®Œæˆ');
        }

        // åˆå§‹åŒ–å·¥ä½œå€
        function initWorkspace() {
            console.log('åˆå§‹åŒ–å·¥ä½œå€...');

            try {
                // å»ºç«‹å·¥å…·ç®± XML
                const toolboxXml = `
                    <xml id="toolbox" style="display: none">
                        <category name="AutoHotkey" colour="#667eea">
                            <block type="ahk_send"></block>
                            <block type="ahk_sendkeys"></block>
                            <block type="ahk_sendraw"></block>
                            <block type="ahk_msgbox"></block>
                            <block type="ahk_inputbox"></block>
                            <block type="ahk_tooltip"></block>
                            <block type="ahk_sleep"></block>
                            <block type="ahk_settimer"></block>
                            <block type="ahk_wait"></block>
                            <block type="ahk_mousemove"></block>
                            <block type="ahk_mouseclick"></block>
                            <block type="ahk_mousedrag"></block>
                            <block type="ahk_mousegetpos"></block>
                            <block type="ahk_hotkey"></block>
                            <block type="ahk_keywait"></block>
                            <block type="ahk_getkeystate"></block>
                            <block type="ahk_loop"></block>
                            <block type="ahk_while"></block>
                            <block type="ahk_for"></block>
                            <block type="ahk_if"></block>
                            <block type="ahk_else"></block>
                            <block type="ahk_break"></block>
                            <block type="ahk_continue"></block>
                            <block type="ahk_run"></block>
                            <block type="ahk_runwait"></block>
                            <block type="ahk_fileexist"></block>
                            <block type="ahk_fileread"></block>
                            <block type="ahk_filewrite"></block>
                            <block type="ahk_fileappend"></block>
                            <block type="ahk_winactivate"></block>
                            <block type="ahk_winclose"></block>
                            <block type="ahk_winmove"></block>
                            <block type="ahk_process"></block>
                            <block type="ahk_regread"></block>
                            <block type="ahk_regwrite"></block>
                            <block type="ahk_varassign"></block>
                            <block type="ahk_varincrement"></block>
                            <block type="ahk_array"></block>
                            <block type="ahk_strlen"></block>
                            <block type="ahk_substr"></block>
                        </category>
                        <category name="é‚è¼¯" colour="#5C81A6">
                            <block type="controls_if"></block>
                            <block type="logic_compare"></block>
                            <block type="logic_operation"></block>
                            <block type="logic_boolean"></block>
                            <block type="logic_null"></block>
                        </category>
                        <category name="è¿´åœˆ" colour="#5CA65C">
                            <block type="controls_repeat_ext"></block>
                            <block type="controls_for"></block>
                        </category>
                        <category name="æ•¸å­¸" colour="#5C68D6">
                            <block type="math_number"></block>
                            <block type="math_arithmetic"></block>
                            <block type="math_single"></block>
                        </category>
                        <category name="æ–‡å­—" colour="#5CA68D">
                            <block type="text"></block>
                            <block type="text_join"></block>
                            <block type="text_length"></block>
                            <block type="text_isEmpty"></block>
                        </category>
                        <category name="è®Šæ•¸" colour="#A65C81" custom="VARIABLE"></category>
                    </xml>
                `;

                workspace = Blockly.inject('blocklyDiv', {
                    toolbox: toolboxXml,
                    grid: {
                        spacing: 20,
                        length: 3,
                        colour: '#ccc',
                        snap: true
                    },
                    zoom: {
                        controls: true,
                        wheel: true,
                        startScale: 1.0,
                        maxScale: 3,
                        minScale: 0.3,
                        scaleSpeed: 1.2
                    },
                    trashcan: true,
                    scrollbars: true,
                    sounds: false,
                    oneBasedIndex: false,
                    move: {
                        scrollbars: true,
                        drag: true,
                        wheel: true
                    }
                });

                // æ·»åŠ äº‹ä»¶ç›£è½å™¨
                workspace.addChangeListener(function(event) {
                    setTimeout(updateCode, 150);
                });

                isInitialized = true;
                console.log('å·¥ä½œå€åˆå§‹åŒ–æˆåŠŸ');
                updateCode();
                
            } catch (error) {
                console.error('å·¥ä½œå€åˆå§‹åŒ–å¤±æ•—:', error);
                showNotification('åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
            }
        }

        // æ›´æ–°ç¨‹å¼ç¢¼é è¦½
        function updateCode() {
            if (!workspace || !isInitialized) {
                return;
            }
            
            try {
                var code = Blockly.JavaScript.workspaceToCode(workspace);
                var codeElement = document.getElementById('generatedCode');
                var lengthElement = document.getElementById('codeLength');
                
                if (code && code.trim()) {
                    // ä¿®å¾©è½‰ç¾©å­—ç¬¦å•é¡Œ
                    code = code.replace(/\\\\n/g, '\n');
                    
                    // ç§»é™¤æ–‡å­—ç©æœ¨çš„å¤šé¤˜å¼•è™Ÿ
                    // è™•ç† Send, "text" -> Send, text
                    code = code.replace(/Send,\s*"([^"]*)"/g, 'Send, $1');
                    code = code.replace(/SendRaw,\s*"([^"]*)"/g, 'SendRaw, $1');
                    code = code.replace(/MsgBox,\s*"([^"]*)"/g, 'MsgBox, $1');
                    code = code.replace(/InputBox,\s*"([^"]*)",\s*"([^"]*)"/g, 'InputBox, $1, $2');
                    code = code.replace(/ToolTip,\s*"([^"]*)"/g, 'ToolTip, $1');
                    
                    // è™•ç† Run, "program" -> Run, program
                    code = code.replace(/Run,\s*"([^"]*)"/g, 'Run, $1');
                    code = code.replace(/RunWait,\s*"([^"]*)"/g, 'RunWait, $1');
                    
                    // è™•ç† FileExist("file") -> FileExist(file)
                    code = code.replace(/FileExist\("([^"]*)"\)/g, 'FileExist($1)');
                    code = code.replace(/FileRead,\s*"([^"]*)",\s*"([^"]*)"/g, 'FileRead, $1, $2');
                    code = code.replace(/FileWrite,\s*"([^"]*)",\s*"([^"]*)"/g, 'FileWrite, $1, $2');
                    code = code.replace(/FileAppend,\s*"([^"]*)",\s*"([^"]*)"/g, 'FileAppend, $1, $2');
                    
                    // è™•ç† WinActivate, "title" -> WinActivate, title
                    code = code.replace(/WinActivate,\s*"([^"]*)"/g, 'WinActivate, $1');
                    code = code.replace(/WinClose,\s*"([^"]*)"/g, 'WinClose, $1');
                    code = code.replace(/WinMove,\s*"([^"]*)",\s*,\s*"([^"]*)",\s*"([^"]*)"/g, 'WinMove, $1, , $2, $3');
                    
                    // è™•ç† Process, action, "name" -> Process, action, name
                    code = code.replace(/Process,\s*(\w+),\s*"([^"]*)"/g, 'Process, $1, $2');
                    
                    // è™•ç† RegRead, var, "key" -> RegRead, var, key
                    code = code.replace(/RegRead,\s*"([^"]*)",\s*"([^"]*)"/g, 'RegRead, $1, $2');
                    code = code.replace(/RegWrite,\s*REG_SZ,\s*"([^"]*)",\s*,\s*"([^"]*)"/g, 'RegWrite, REG_SZ, $1, , $2');
                    
                    // è™•ç† HotKey, "key" -> HotKey, key
                    code = code.replace(/(\w+)::\n/g, '$1::\n');
                    
                    // è™•ç†è®Šæ•¸è³¦å€¼
                    code = code.replace(/"([^"]*)"\s*:=/g, '$1 :=');
                    
                    // è™•ç† MouseGetPos, "xvar", "yvar" -> MouseGetPos, xvar, yvar
                    code = code.replace(/MouseGetPos,\s*"([^"]*)",\s*"([^"]*)"/g, 'MouseGetPos, $1, $2');
                    
                    // è™•ç† KeyWait, "key" -> KeyWait, key
                    code = code.replace(/KeyWait,\s*"([^"]*)"/g, 'KeyWait, $1');
                    
                    // è™•ç† GetKeyState("key") -> GetKeyState(key)
                    code = code.replace(/GetKeyState\("([^"]*)"\)/g, 'GetKeyState($1)');
                    
                    codeElement.textContent = code;
                    var lines = code.split('\n').filter(line => line.trim()).length;
                    lengthElement.textContent = lines + ' è¡Œ';
                } else {
                    codeElement.textContent = '; å°‡ç©æœ¨æ‹–æ›³åˆ°å·¦å´ç·¨è¼¯å€é–‹å§‹å»ºç«‹æ‚¨çš„ AutoHotkey è…³æœ¬';
                    lengthElement.textContent = '0 è¡Œ';
                }
            } catch (e) {
                console.error('ç¨‹å¼ç¢¼ç”ŸæˆéŒ¯èª¤:', e);
                document.getElementById('generatedCode').textContent = '; ç¨‹å¼ç¢¼ç”ŸæˆéŒ¯èª¤: ' + e.message;
            }
        }

        // æ·»åŠ ç©æœ¨åˆ°å·¥ä½œå€
        function addBlockToWorkspace(blockType) {
            if (!workspace || !isInitialized) {
                showNotification('ç³»çµ±æœªæº–å‚™å°±ç·’', 'error');
                return;
            }
            
            try {
                const block = workspace.newBlock(blockType);
                if (!block) {
                    throw new Error('ç„¡æ³•å‰µå»ºç©æœ¨: ' + blockType);
                }
                
                block.initSvg();
                block.render();
                
                const metrics = workspace.getMetrics();
                if (metrics && metrics.viewWidth && metrics.viewHeight) {
                    const x = (metrics.viewWidth / 2) - 100;
                    const y = (metrics.viewHeight / 2) - 50;
                    const xy = block.getRelativeToSurfaceXY();
                    block.moveBy(x - xy.x, y - xy.y);
                }
                
                block.select();
                setTimeout(updateCode, 200);
                
                console.log('æˆåŠŸæ·»åŠ ç©æœ¨:', blockType);
                
            } catch (e) {
                console.error('æ·»åŠ ç©æœ¨éŒ¯èª¤:', e);
                showNotification('æ·»åŠ ç©æœ¨å¤±æ•—', 'error');
            }
        }

        // é»æ“Šæ·»åŠ ç©æœ¨åŠŸèƒ½
        document.querySelectorAll('.block-item').forEach(item => {
            item.addEventListener('click', function() {
                const blockType = this.dataset.type;
                if (blockType) {
                    addBlockToWorkspace(blockType);
                }
            });
        });

        // é¡¯ç¤ºç¯„ä¾‹
        function showExample(exampleId) {
            const example = examples[exampleId];
            if (!example) return;

            const modal = document.getElementById('exampleModal');
            const title = document.getElementById('exampleTitle');
            const content = document.getElementById('exampleContent');

            title.textContent = example.title;
            
            content.innerHTML = `
                <div class="example-description">
                    <strong>èªªæ˜ï¼š</strong>${example.description}
                </div>
                
                <div class="example-usage">
                    <h4>ğŸ“‹ ä½¿ç”¨æ–¹å¼</h4>
                    <p>${example.usage}</p>
                </div>
                
                <div class="example-code">
                    <strong>ğŸ“ ç”Ÿæˆçš„ç¨‹å¼ç¢¼ï¼š</strong>
                    <pre>${example.code}</pre>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button class="btn-load-example" onclick="loadExample('${exampleId}')">
                        ğŸ“¥ è¼‰å…¥æ­¤ç¯„ä¾‹åˆ°ç·¨è¼¯å€
                    </button>
                    <button class="btn-secondary" onclick="closeExample()">
                        é—œé–‰
                    </button>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // é—œé–‰ç¯„ä¾‹
        function closeExample() {
            const modal = document.getElementById('exampleModal');
            modal.style.display = 'none';
        }

        // è¼‰å…¥ç¯„ä¾‹åˆ°å·¥ä½œå€
        function loadExample(exampleId) {
            const example = examples[exampleId];
            if (!example) return;

            // æ¸…ç©ºå·¥ä½œå€
            workspace.clear();

            // å»ºç«‹ç¯„ä¾‹ç©æœ¨
            let previousBlock = null;
            
            function createBlock(blockData) {
                const block = workspace.newBlock(blockData.type);
                if (!block) {
                    console.error('ç„¡æ³•å‰µå»ºç©æœ¨:', blockData.type);
                    return null;
                }
                
                block.initSvg();
                block.render();

                // è¨­å®šå€¼
                if (blockData.values) {
                    Object.keys(blockData.values).forEach(inputName => {
                        const input = block.getInput(inputName);
                        if (input) {
                            const value = blockData.values[inputName];
                            
                            // åˆ¤æ–·æ˜¯å¦ç‚ºæ•¸å­—
                            if (typeof value === 'number' || 
                                (typeof value === 'string' && !isNaN(value) && value.trim() !== '')) {
                                // å‰µå»ºæ•¸å­—å¡Š
                                const numberBlock = workspace.newBlock('math_number');
                                const numValue = typeof value === 'string' ? parseFloat(value) : value;
                                numberBlock.setFieldValue(numValue, 'NUM');
                                numberBlock.initSvg();
                                numberBlock.render();
                                
                                // ç¢ºä¿é€£æ¥å­˜åœ¨
                                if (input.connection && numberBlock.outputConnection) {
                                    input.connection.connect(numberBlock.outputConnection);
                                }
                            } else {
                                // å‰µå»ºæ–‡æœ¬å¡Š
                                const textBlock = workspace.newBlock('text');
                                // ç§»é™¤å¤–å±¤å¼•è™Ÿï¼ˆå¦‚æœæœ‰ï¼‰
                                const textValue = typeof value === 'string' ? 
                                    value.replace(/^["']|["']$/g, '') : value;
                                textBlock.setFieldValue(textValue, 'TEXT');
                                textBlock.initSvg();
                                textBlock.render();
                                
                                // ç¢ºä¿é€£æ¥å­˜åœ¨
                                if (input.connection && textBlock.outputConnection) {
                                    input.connection.connect(textBlock.outputConnection);
                                }
                            }
                        }
                    });
                }

                // è¨­å®šæ¬„ä½å€¼
                if (blockData.fields) {
                    Object.keys(blockData.fields).forEach(fieldName => {
                        const field = block.getField(fieldName);
                        if (field) {
                            field.setValue(blockData.fields[fieldName]);
                        }
                    });
                }

                // è™•ç†èªå¥å¡Š
                if (blockData.statements && blockData.statements.DO) {
                    const statementInput = block.getInput('DO');
                    if (statementInput && statementInput.connection) {
                        let lastStatementBlock = null;
                        blockData.statements.DO.forEach(statementData => {
                            const statementBlock = createBlock(statementData);
                            if (statementBlock) {
                                if (lastStatementBlock && 
                                    lastStatementBlock.nextConnection && 
                                    statementBlock.previousConnection) {
                                    lastStatementBlock.nextConnection.connect(statementBlock.previousConnection);
                                } else if (statementInput.connection && statementBlock.previousConnection) {
                                    statementInput.connection.connect(statementBlock.previousConnection);
                                }
                                lastStatementBlock = statementBlock;
                            }
                        });
                    }
                }

                return block;
            }

            // å‰µå»ºæ‰€æœ‰ç©æœ¨
            example.blocks.forEach((blockData, index) => {
                const block = createBlock(blockData);
                if (!block) return;
                
                // è¨­å®šä½ç½® - ä½¿ç”¨ç°¡å–®çš„éå¢ä½ç½®
                const x = 50;
                const y = 50 + (index * 150);
                
                // ç¢ºä¿ä½ç½®æ˜¯æœ‰æ•ˆæ•¸å­—
                if (!isNaN(x) && !isNaN(y)) {
                    block.moveTo(new Blockly.utils.Coordinate(x, y));
                }

                // é€£æ¥ç©æœ¨
                if (previousBlock && 
                    previousBlock.nextConnection && 
                    block.previousConnection) {
                    previousBlock.nextConnection.connect(block.previousConnection);
                }
                
                previousBlock = block;
            });

            // æ›´æ–°ç¨‹å¼ç¢¼é è¦½
            setTimeout(updateCode, 200);

            // é—œé–‰æ¨¡æ…‹æ¡†
            closeExample();

            showNotification('ç¯„ä¾‹å·²è¼‰å…¥åˆ°ç·¨è¼¯å€', 'success');
        }

        // ä¸‹è¼‰è…³æœ¬
        function downloadScript() {
            if (!workspace || !isInitialized) {
                showNotification('ç³»çµ±æœªæº–å‚™å°±ç·’', 'error');
                return;
            }
            
            const code = Blockly.JavaScript.workspaceToCode(workspace).replace(/\\\\n/g, '\n');
            if (!code || !code.trim()) {
                showNotification('è«‹å…ˆå»ºç«‹ä¸€äº›ç©æœ¨ï¼', 'error');
                return;
            }
            
            try {
                const blob = new Blob([code], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'script.ahk';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('è…³æœ¬å·²ä¸‹è¼‰ï¼', 'success');
            } catch (e) {
                showNotification('ä¸‹è¼‰å¤±æ•—', 'error');
            }
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        function copyToClipboard() {
            if (!workspace || !isInitialized) {
                showNotification('ç³»çµ±æœªæº–å‚™å°±ç·’', 'error');
                return;
            }
            
            const code = Blockly.JavaScript.workspaceToCode(workspace).replace(/\\\\n/g, '\n');
            if (!code || !code.trim()) {
                showNotification('è«‹å…ˆå»ºç«‹ä¸€äº›ç©æœ¨ï¼', 'error');
                return;
            }
            
            navigator.clipboard.writeText(code).then(() => {
                showNotification('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
            }).catch(() => {
                const textArea = document.createElement('textarea');
                textArea.value = code;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
            });
        }

        // æ¸…ç©ºå·¥ä½œå€
        function clearWorkspace() {
            if (!workspace || !isInitialized) {
                showNotification('ç³»çµ±æœªæº–å‚™å°±ç·’', 'error');
                return;
            }
            
            if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç©æœ¨å—ï¼Ÿ')) {
                try {
                    workspace.clear();
                    updateCode();
                    showNotification('å·¥ä½œå€å·²æ¸…ç©º', 'info');
                } catch (e) {
                    showNotification('æ¸…ç©ºå¤±æ•—', 'error');
                }
            }
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'error') {
                notification.style.background = '#dc3545';
            } else if (type === 'info') {
                notification.style.background = '#17a2b8';
            } else {
                notification.style.background = '#28a745';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // éµç›¤å¿«æ·éµ
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        downloadScript();
                        break;
                    case 'c':
                        if (e.shiftKey) {
                            e.preventDefault();
                            copyToClipboard();
                        }
                        break;
                }
            }
        });

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        document.getElementById('exampleModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeExample();
            }
        });

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆ');
            waitForBlockly(function() {
                defineBlocks();
                defineGenerators();
                setTimeout(initWorkspace, 500);
            });
        });

        // è¦–çª—å¤§å°æ”¹è®Šæ™‚é‡æ–°èª¿æ•´
        window.addEventListener('resize', function() {
            if (workspace) {
                Blockly.svgResize(workspace);
            }
        });
    </script>
</body>
</html>