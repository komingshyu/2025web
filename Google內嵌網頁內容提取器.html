<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sites 嵌入程式還原工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 自定義滾動條樣式 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* 標籤頁活動狀態 */
        .tab-active {
            border-bottom: 3px solid #3b82f6;
        }
        
        /* 按鈕懸停效果 */
        .btn-hover {
            transition: all 0.3s ease;
        }
        
        /* 卡片陰影效果 */
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        /* 通知樣式 */
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* 模態框樣式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 通知容器 -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- 幫助模態框 -->
    <div id="helpModal" class="modal">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto m-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">使用說明</h3>
                    <button id="closeHelpBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold mb-2">如何使用：</h4>
                        <ol class="list-decimal list-inside space-y-1 text-gray-700">
                            <li>在 Google Sites 頁面上，右鍵點擊並選擇"檢視頁面原始碼"</li>
                            <li>複製整個頁面的 HTML 原始碼</li>
                            <li>將原始碼貼上到左側的輸入框中</li>
                            <li>點擊"提取程式碼"按鈕</li>
                            <li>系統會自動提取並解碼嵌入的 HTML 程式碼</li>
                            <li>系統會自動轉換  &amp;lt;、&amp;gt;、&amp;quot; 為HTML 實體字符</li>
                            <li>您可以在右側查看結果，並選擇下載為獨立的 HTML 檔案</li>
                        </ol>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">功能說明：</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-700">
                            <li><strong>提取程式碼：</strong>從 Google Sites 的 data-code 屬性中提取並解碼實際內容</li>
                            <li><strong>自動轉換HTML實體：</strong>將 &amp;lt;、&amp;gt;、&amp;quot; 轉換為 &lt;、&gt;、&quot; HTML實體字符</li>
                            <li><strong>預覽功能：</strong>即時預覽還原後的網頁效果</li>
                            <li><strong>複製功能：</strong>將提取的程式碼複製到剪貼簿</li>
                            <li><strong>下載功能：</strong>將處理後的程式碼下載為獨立的 HTML 檔案</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">常見問題：</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-700">
                            <li><strong>問：為什麼提取失敗？</strong><br>
                               答：請確保您貼上的原始碼包含 data-code 屬性，這是 Google Sites 嵌入應用的標準格式。</li>
                            <li><strong>問：提取的程式碼無法正常運行？</strong><br>
                               答：某些應用可能需要特定的伺服器環境或外部資源，請確保這些資源可以從外部訪問。</li>
                            <li><strong>問：如何獲取 Google Sites 頁面原始碼？</strong><br>
                               答：在 Chrome 瀏覽器中，右鍵點擊頁面並選擇"檢視頁面原始碼"，或按 Ctrl+U（Windows）/ Cmd+U（Mac）。</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">注意事項：</h4>
                        <ul class="list-disc list-inside space-y-1 text-gray-700">
                            <li>確保您有權限使用和修改提取的程式碼</li>
                            <li>某些嵌入的應用可能需要特定的伺服器環境才能正常運行</li>
                            <li>如果提取的程式碼包含外部資源，請確保這些資源可以從外部訪問</li>
                            <li>對於複雜的應用，可能需要手動調整依賴項或資源路徑</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 頭部區域 -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-code text-3xl"></i>
                    <div>
                        <h1 class="text-2xl font-bold">Google Sites 嵌入程式還原工具</h1>
                        <p class="text-blue-100 text-sm">從 Google Sites 頁面中提取並還原嵌入的 HTML 程式碼</p>
                    </div>
                </div>
                <button id="helpBtn" class="bg-blue-700 hover:bg-blue-800 px-4 py-2 rounded-lg btn-hover">
                    <i class="fas fa-question-circle mr-2"></i>使用說明
                </button>
            </div>
        </div>
    </header>

    <!-- 主要內容區域 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 左右兩欄佈局 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- 左側：輸入區域 -->
            <div class="bg-white rounded-lg card-shadow overflow-hidden">
                <div class="bg-gray-100 px-4 py-3 border-b">
                    <h2 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-paste mr-2 text-blue-600"></i>
                        Google Sites 原始碼
                    </h2>
                </div>
                <div class="p-4">
                    <textarea 
                        id="sourceCode"
                        class="w-full h-96 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm custom-scrollbar" 
                        placeholder="請在此貼上 Google Sites 頁面的原始 HTML 碼..."
                    ></textarea>
                    <div class="mt-3 flex justify-between">
                        <button id="clearInputBtn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg btn-hover">
                            <i class="fas fa-eraser mr-2"></i>清空
                        </button>
                        <button id="extractBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg btn-hover">
                            <i class="fas fa-magic mr-2"></i>提取程式碼
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右側：輸出區域 -->
            <div class="bg-white rounded-lg card-shadow overflow-hidden">
                <div class="bg-gray-100 px-4 py-3 border-b">
                    <h2 class="font-semibold text-lg flex items-center">
                        <i class="fas fa-file-code mr-2 text-green-600"></i>
                        還原的 HTML 程式碼
                    </h2>
                </div>
                <div class="p-4">
                    <!-- 標籤頁切換 -->
                    <div class="flex border-b mb-3">
                        <button id="codeTab" class="px-4 py-2 font-medium text-gray-700 hover:text-blue-600 transition tab-active">
                            <i class="fas fa-code mr-2"></i>程式碼
                        </button>
                        <button id="previewTab" class="px-4 py-2 font-medium text-gray-700 hover:text-blue-600 transition">
                            <i class="fas fa-eye mr-2"></i>預覽
                        </button>
                    </div>

                    <!-- 程式碼顯示區域 -->
                    <div id="codeTabContent" class="h-96 bg-gray-900 rounded-lg p-3 custom-scrollbar overflow-auto">
                        <pre id="outputCode" class="text-gray-300 text-sm"><code>&lt;!-- 提取的程式碼將顯示在這裡 --&gt;

  </code></pre>
                    </div>

                    <!-- 預覽區域（預設隱藏） -->
                    <div id="previewTabContent" class="h-96 border border-gray-200 rounded-lg p-3 hidden">
                        <iframe id="previewFrame" class="w-full h-full border-0"></iframe>
                    </div>

                    <!-- 操作按鈕 -->
                    <div class="mt-3 flex justify-between">
                        <div class="flex space-x-2">
                            <button id="copyBtn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg btn-hover">
                                <i class="fas fa-copy mr-2"></i>複製
                            </button>
                        </div>
                        <button id="downloadBtn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg btn-hover">
                            <i class="fas fa-download mr-2"></i>下載 HTML
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 狀態提示區域 -->
        <div id="statusMessage" class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <div class="flex items-start">
                <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
                <div>
                    <h4 class="font-semibold text-blue-900">準備就緒</h4>
                    <p class="text-blue-700 text-sm mt-1">工具已準備就緒，請貼上 Google Sites 原始碼並點擊"提取程式碼"按鈕。</p>
                </div>
            </div>
        </div>
    </main>

    <!-- 頁腳 -->
    <footer class="bg-gray-800 text-white mt-12 py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm">© 2025 Google Sites 嵌入程式還原工具 | 版本 1.0.0</p>
                <p class="text-gray-400 text-sm mt-2 md:mt-0">design by koming</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript 功能 -->
    <script>
        // 等待DOM加載完成
        document.addEventListener('DOMContentLoaded', function() {
            // DOM 元素
            const sourceCode = document.getElementById('sourceCode');
            const outputCode = document.getElementById('outputCode');
            const extractBtn = document.getElementById('extractBtn');
            const clearInputBtn = document.getElementById('clearInputBtn');
            const copyBtn = document.getElementById('copyBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const helpBtn = document.getElementById('helpBtn');
            const closeHelpBtn = document.getElementById('closeHelpBtn');
            const helpModal = document.getElementById('helpModal');
            const codeTab = document.getElementById('codeTab');
            const previewTab = document.getElementById('previewTab');
            const codeTabContent = document.getElementById('codeTabContent');
            const previewTabContent = document.getElementById('previewTabContent');
            const previewFrame = document.getElementById('previewFrame');
            const notificationContainer = document.getElementById('notificationContainer');
            const statusMessage = document.getElementById('statusMessage');

            // 通知函數
            function showNotification(message, type) {
                type = type || 'success';
                const notification = document.createElement('div');
                notification.className = 'notification px-4 py-3 rounded-lg shadow-lg flex items-center';
                
                if (type === 'success') {
                    notification.classList.add('bg-green-500', 'text-white');
                } else if (type === 'error') {
                    notification.classList.add('bg-red-500', 'text-white');
                } else {
                    notification.classList.add('bg-blue-500', 'text-white');
                }
                
                const icon = type === 'success' ? 'fa-check-circle' : 
                             type === 'error' ? 'fa-exclamation-circle' : 
                             'fa-info-circle';
                
                notification.innerHTML = '<i class="fas ' + icon + ' mr-2"></i><span>' + message + '</span>';
                
                notificationContainer.appendChild(notification);
                
                setTimeout(function() {
                    notification.style.opacity = '0';
                    notification.style.transform = 'translateY(-20px)';
                    notification.style.transition = 'all 0.3s ease';
                    setTimeout(function() {
                        notificationContainer.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // 更新狀態訊息
            function updateStatusMessage(title, message, type) {
                type = type || 'info';
                let iconClass = 'fa-info-circle';
                let bgClass = 'bg-blue-50';
                let borderClass = 'border-blue-200';
                let titleClass = 'text-blue-900';
                let textClass = 'text-blue-700';
                
                if (type === 'success') {
                    iconClass = 'fa-check-circle';
                    bgClass = 'bg-green-50';
                    borderClass = 'border-green-200';
                    titleClass = 'text-green-900';
                    textClass = 'text-green-700';
                } else if (type === 'error') {
                    iconClass = 'fa-exclamation-circle';
                    bgClass = 'bg-red-50';
                    borderClass = 'border-red-200';
                    titleClass = 'text-red-900';
                    textClass = 'text-red-700';
                }
                
                statusMessage.className = 'mt-6 ' + bgClass + ' border ' + borderClass + ' rounded-lg p-4';
                statusMessage.innerHTML = '<div class="flex items-start"><i class="fas ' + iconClass + ' ' + (type === 'success' ? 'text-green-600' : type === 'error' ? 'text-red-600' : 'text-blue-600') + ' mt-1 mr-3"></i><div><h4 class="font-semibold ' + titleClass + '">' + title + '</h4><p class="' + textClass + ' text-sm mt-1">' + message + '</p></div></div>';
            }

            // 安全的解碼函數
            function safeDecodeURIComponent(encodedStr) {
                try {
                    // 嘗試解碼
                    return decodeURIComponent(encodedStr);
                } catch (e) {
                    // 如果解碼失敗，返回原始字串
                    return encodedStr;
                }
            }

            // 轉換HTML實體字符
            function decodeHtmlEntities(html) {
                // 使用DOM元素來轉換HTML實體
                const txt = document.createElement('textarea');
                txt.innerHTML = html;
                return txt.value;
            }

            // 提取程式碼
            extractBtn.addEventListener('click', function() {
                const source = sourceCode.value.trim();
                
                if (!source) {
                    showNotification('請先貼上 Google Sites 原始碼', 'error');
                    updateStatusMessage('錯誤', '請先在左側輸入框中貼上 Google Sites 原始碼', 'error');
                    return;
                }
                
                try {
                    // 使用正則表達式尋找 data-code="..." 或 data-code='...'
                    const dataCodeMatch = source.match(/data-code\s*=\s*["']([^"']+)["']/);
                    
                    if (!dataCodeMatch) {
                        showNotification('未找到 data-code 屬性', 'error');
                        updateStatusMessage('提取失敗', '在提供的原始碼中未找到 data-code 屬性', 'error');
                        return;
                    }
                    
                    // 提取 data-code 的值
                    let extractedCode = dataCodeMatch[1];
                    
                    // 檢查是否需要解碼
                    // 如果包含 %XX 格式的編碼，則嘗試解碼
                    if (/%[0-9A-Fa-f]{2}/.test(extractedCode)) {
                        extractedCode = safeDecodeURIComponent(extractedCode);
                    }
                    
                    // 轉換HTML實體字符
                    extractedCode = decodeHtmlEntities(extractedCode);
                    
                    // 顯示結果
                    outputCode.textContent = extractedCode;
                    
                    // 更新預覽
                    updatePreview(extractedCode);
                    
                    showNotification('程式碼提取成功！', 'success');
                    updateStatusMessage('提取成功', '已成功從 Google Sites 頁面中提取並轉換嵌入的程式碼', 'success');
                } catch (error) {
                    console.error(error);
                    showNotification('提取程式碼時發生錯誤：' + error.message, 'error');
                    updateStatusMessage('提取失敗', '提取程式碼時發生錯誤：' + error.message, 'error');
                }
            });

            // 更新預覽
            function updatePreview(html) {
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                previewFrame.src = url;
            }

            // 清空輸入
            clearInputBtn.addEventListener('click', function() {
                sourceCode.value = '';
                showNotification('輸入已清空', 'info');
                updateStatusMessage('準備就緒', '工具已準備就緒，請貼上 Google Sites 原始碼並點擊"提取程式碼"按鈕', 'info');
            });

            // 標籤切換
            codeTab.addEventListener('click', function() {
                codeTab.classList.add('tab-active');
                previewTab.classList.remove('tab-active');
                codeTabContent.classList.remove('hidden');
                previewTabContent.classList.add('hidden');
            });

            previewTab.addEventListener('click', function() {
                previewTab.classList.add('tab-active');
                codeTab.classList.remove('tab-active');
                previewTabContent.classList.remove('hidden');
                codeTabContent.classList.add('hidden');
                
                // 如果還沒有預覽內容，更新預覽
                const code = outputCode.textContent;
                if (code && !previewFrame.src) {
                    updatePreview(code);
                }
            });

            // 複製程式碼
            copyBtn.addEventListener('click', function() {
                const code = outputCode.textContent;
                
                if (!code || code.includes('提取的程式碼將顯示在這裡')) {
                    showNotification('沒有可複製的程式碼', 'error');
                    return;
                }
                
                navigator.clipboard.writeText(code)
                    .then(function() {
                        showNotification('程式碼已複製到剪貼簿', 'success');
                    })
                    .catch(function(err) {
                        console.error('複製失敗:', err);
                        showNotification('複製失敗，請手動選擇並複製', 'error');
                    });
            });

            // 下載 HTML
            downloadBtn.addEventListener('click', function() {
                const code = outputCode.textContent;
                
                if (!code || code.includes('提取的程式碼將顯示在這裡')) {
                    showNotification('沒有可下載的程式碼', 'error');
                    return;
                }
                
                const blob = new Blob([code], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'restored-google-sites-app.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('HTML 檔案下載中...', 'success');
            });

            // 幫助按鈕
            helpBtn.addEventListener('click', function() {
                helpModal.classList.add('active');
            });

            // 關閉幫助模態框
            closeHelpBtn.addEventListener('click', function() {
                helpModal.classList.remove('active');
            });

            // 點擊模態框外部關閉
            helpModal.addEventListener('click', function(e) {
                if (e.target === helpModal) {
                    helpModal.classList.remove('active');
                }
            });

            // 添加示例文本
            sourceCode.value = '<!-- 請將 Google Sites 頁面的原始 HTML 碼貼上到這裡 -->';
        });
    </script>
</body>
</html>