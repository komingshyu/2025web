<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯æ„›è³‡æ–™æŸ¥è©¢ç³»çµ± - è¨­å®šé é¢</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .cute-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .cute-card:hover {
            transform: translateY(-5px);
        }
        
        .cute-button {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            border: none;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .cute-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(232, 67, 147, 0.4);
        }
        
        .cute-input {
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        
        .cute-input:focus {
            outline: none;
            border-color: #fd79a8;
            box-shadow: 0 0 0 3px rgba(253, 121, 168, 0.1);
        }
        
        .field-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .field-item:hover {
            border-color: #ffeaa7;
            background: #fff5f5;
        }
        
        .field-item.selected {
            border-color: #fd79a8;
            background: #ffe0e6;
        }
        
        .drag-handle {
            cursor: grab;
            color: #fd79a8;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .cute-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #fd79a8;
        }
        
        .cute-radio {
            width: 18px;
            height: 18px;
            accent-color: #fd79a8;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ffeaa7;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #2d3436;
            margin: 0 10px;
            position: relative;
        }
        
        .step.active {
            background: #fd79a8;
            color: white;
        }
        
        .step::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 2px;
            background: #ffeaa7;
            right: -40px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .step:last-child::after {
            display: none;
        }
        
        .cute-select {
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            padding: 10px 15px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .cute-select:focus {
            outline: none;
            border-color: #fd79a8;
        }
        
        .debug-info {
            background: #f0f0f0;
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .header-tag {
            background: #fce4ec;
            color: #c2185b;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
            margin: 2px;
            border: 1px solid #f8bbd0;
        }
        
        .template-card {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }
        
        .template-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .template-card.selected {
            border-color: #fd79a8;
            transform: scale(1.02);
        }
        
        .template-preview {
            height: 120px;
            position: relative;
            overflow: hidden;
        }
        
        .template-info {
            padding: 15px;
            background: white;
        }
        
        .template-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .template-description {
            font-size: 14px;
            color: #666;
        }
        
        /* ä½¿ç”¨èªªæ˜æŒ‰éˆ•æ¨£å¼ */
        .help-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .help-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        
        /* æ¨¡æ…‹æ¡†æ¨£å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideIn 0.3s ease;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close:hover {
            color: #e84393;
        }
        
        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }
        
        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }
        
        .help-section {
            margin-bottom: 25px;
        }
        
        .help-section h3 {
            color: #e84393;
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .help-section h3 i {
            margin-right: 10px;
        }
        
        .help-section p, .help-section li {
            color: #555;
            line-height: 1.6;
        }
        
        .help-section ul {
            padding-left: 25px;
        }
      
        /* é è…³æ¨£å¼ */
        .footer {
            margin-top: auto;
            padding: 20px 0;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            background: rgba(0, 0, 0, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }
        .main-content {
            flex: 1;
            padding-bottom: 20px;
        }
        /* åŠ å¯†è¨­å®šæ¨£å¼ */
        .encryption-options {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            border: 2px solid #ffeaa7;
        }
        .encryption-level {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .encryption-level input[type="radio"] {
            margin-right: 10px;
        }
        .encryption-description {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
            margin-left: 25px;
        }
        
        /* è¼¸å…¥é¡å‹é¸é …æ¨£å¼ */
        .input-type-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 25px;
        }
        
        .input-type-option {
            display: flex;
            align-items: center;
        }
        
        .input-type-option input[type="radio"] {
            margin-right: 8px;
        }
        
        .input-type-option label {
            color: #555;
            font-size: 14px;
        }
        
        /* å¿…å¡«æ¬„ä½æ¨™è¨˜æ¨£å¼ */
        .required-field::after {
            content: " *";
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* æŸ¥è©¢æ–¹å¼è¨­å®šæ¨£å¼ */
        .search-mode-options {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #b3d9ff;
        }
        
        .search-mode-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .search-mode-option:hover {
            background: #e6f3ff;
            transform: translateX(5px);
        }
        
        .search-mode-option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }
        
        .search-mode-option label {
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
        }
        
        .search-mode-description {
            font-size: 13px;
            color: #666;
            margin-left: 28px;
            margin-top: 5px;
        }
        
        /* è¡¨æ ¼å®¹å™¨æ¨£å¼ */
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        .result-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* è¡¨é ­æ¨£å¼ */
        .result-table thead {
            background-color: rgba(253, 121, 168, 0.2);
        }

        .result-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #2d3436;
            border-bottom: 2px solid #ffeaa7;
        }

        /* è¡¨æ ¼å–®å…ƒæ ¼æ¨£å¼ */
        .result-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        /* è¡¨æ ¼è¡Œæ¨£å¼ */
        .result-table tbody tr {
            transition: all 0.3s ease;
        }

        .result-table tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .result-table tbody tr:hover {
            background-color: #ffe0e6;
            transform: scale(1.01);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media screen and (max-width: 768px) {
            .result-table {
                font-size: 14px;
            }
            
            .result-table th, 
            .result-table td {
                padding: 10px;
            }
        }
        
        /* çµæœå‘ˆç¾æ–¹å¼è¨­å®šæ¨£å¼ */
        .display-mode-options {
            background: #f5f0ff;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #d9b3ff;
        }
        
        .display-mode-option {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .display-mode-option:hover {
            background: #f0e6ff;
            transform: translateX(5px);
        }
        
        .display-mode-option input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
        }
        
        .display-mode-option label {
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
        }
        
        .display-mode-description {
            font-size: 13px;
            color: #666;
            margin-left: 28px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- ä½¿ç”¨èªªæ˜æŒ‰éˆ• -->
    <div class="help-button" onclick="openHelpModal()">
        <i class="fas fa-question-circle text-2xl text-pink-500"></i>
    </div>
    
    <!-- ä½¿ç”¨èªªæ˜æ¨¡æ…‹æ¡† -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <h2 class="text-2xl font-bold text-center mb-6 text-pink-500">ğŸŒ¸ è©¦ç®—è¡¨è½‰ç‚ºç¶²é è³‡æ–™æŸ¥è©¢ç³»çµ±çš„ä½¿ç”¨èªªæ˜ ğŸŒ¸</h2>
            
            <div class="help-section">
                <h3><i class="fas fa-info-circle"></i> ç³»çµ±ç°¡ä»‹</h3>
                <p>è½‰å‡ºç¶²é ç‰ˆè³‡æ–™æŸ¥è©¢ç³»çµ±æ˜¯ä¸€å€‹ç°¡å–®æ˜“ç”¨çš„å·¥å…·ï¼Œå¯ä»¥å°‡æ‚¨çš„Excelè³‡æ–™å¿«é€Ÿè½‰æ›ç‚ºäº’å‹•å¼ç¶²é æŸ¥è©¢ç³»çµ±ã€‚åªéœ€å¹¾å€‹ç°¡å–®æ­¥é©Ÿï¼Œå°±èƒ½å»ºç«‹ä¸€å€‹ç¾è§€åˆå¯¦ç”¨çš„æŸ¥è©¢é é¢ã€‚</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-list-ol"></i> æ“ä½œæ­¥é©Ÿ</h3>
                <ol>
                    <li><strong>æ­¥é©Ÿ1ï¼šä¸Šå‚³è©¦ç®—è¡¨æª”æ¡ˆ</strong><br>
                        é»æ“Šã€Œé¸æ“‡XLSXæª”æ¡ˆã€æŒ‰éˆ•ï¼Œä¸Šå‚³æ‚¨çš„Excelæª”æ¡ˆï¼ˆ.xlsxæˆ–.xlsæ ¼å¼ï¼‰ã€‚</li>
                    <li><strong>æ­¥é©Ÿ2ï¼šé¸æ“‡å·¥ä½œè¡¨</strong><br>
                        å¾ä¸‹æ‹‰å¼é¸å–®ä¸­é¸æ“‡è¦ä½¿ç”¨çš„å·¥ä½œè¡¨ï¼Œç„¶å¾Œé»æ“Šã€Œè¼‰å…¥å·¥ä½œè¡¨ã€ã€‚</li>
                    <li><strong>æ­¥é©Ÿ3ï¼šè¨­å®šæ¬„ä½</strong><br>
                        <ul>
                            <li><strong>æœå°‹æ¬„ä½è¨­å®š</strong>ï¼šé¸æ“‡æœ€å¤š4å€‹æ¬„ä½ä½œç‚ºæœå°‹æ¢ä»¶ï¼Œå¯ä»¥è¨­å®šç‚ºæ–‡å­—è¼¸å…¥ã€ä¸‹æ‹‰å¼é¸å–®æˆ–å¯†ç¢¼è¼¸å…¥ã€‚</li>
                            <li><strong>é¡¯ç¤ºæ¬„ä½è¨­å®š</strong>ï¼šé¸æ“‡æœ€å¤š10å€‹æ¬„ä½åœ¨æœå°‹çµæœä¸­é¡¯ç¤ºï¼Œå¯ä»¥æ‹–æ›³èª¿æ•´é †åºã€‚</li>
                            <li><strong>çµæœå‘ˆç¾æ–¹å¼è¨­å®š</strong>ï¼šé¸æ“‡æŸ¥è©¢çµæœçš„å‘ˆç¾æ–¹å¼ï¼Œå¯é¸æ“‡ç¸±å‘æ¢åˆ—å¼æˆ–æ©«å‘è¡¨æ ¼å¼ï¼Œå¯å¤šé‡é¸æ“‡ã€‚</li>
                            <li><strong>æŸ¥è©¢æ–¹å¼è¨­å®š</strong>ï¼šé¸æ“‡æŸ¥è©¢é é¢è¦æä¾›çš„æŸ¥è©¢æ–¹å¼ï¼Œå¯ä»¥é¸æ“‡ã€Œå®Œå…¨ç¬¦åˆæŸ¥è©¢ã€ã€ã€Œå«é—œéµå­—æŸ¥è©¢ã€æˆ–å…©ç¨®éƒ½é¸ã€‚</li>
                            <li><strong>é é¢è¨­å®š</strong>ï¼šè¼¸å…¥æŸ¥è©¢é é¢çš„æ¨™é¡Œå’Œå–®ä½åç¨±ã€‚</li>
                            <li><strong>é‡è¤‡è³‡æ–™è™•ç†</strong>ï¼šé¸æ“‡æ˜¯å¦è¦ç§»é™¤é‡è¤‡çš„è³‡æ–™ã€‚</li>
                            <li><strong>è³‡æ–™åŠ å¯†è¨­å®š</strong>ï¼šé¸æ“‡æ˜¯å¦è¦å°è³‡æ–™é€²è¡ŒåŠ å¯†ä¿è­·ã€‚</li>
                            <li><strong>æœå°‹æ¬„ä½åŠ å¯†è¨­å®š</strong>ï¼šé¸æ“‡æ˜¯å¦è¦å°æœå°‹æ¬„ä½çš„é¸é …å€¼é€²è¡ŒåŠ å¯†ã€‚</li>
                        </ul>
                    </li>
                    <li><strong>æ­¥é©Ÿ4ï¼šç¢ºèªè¨­å®š</strong><br>
                        æª¢è¦–æ‰€æœ‰è¨­å®šæ‘˜è¦ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œä¸‹ä¸€æ­¥ã€ã€‚</li>
                    <li><strong>æ­¥é©Ÿ5ï¼šé¸æ“‡ç¶²é æ¨¡æ¿</strong><br>
                        å¾8ç¨®ä¸åŒé¢¨æ ¼çš„æ¨¡æ¿ä¸­é¸æ“‡æ‚¨å–œæ­¡çš„è¨­è¨ˆï¼Œç„¶å¾Œé»æ“Šã€Œç”¢ç”ŸæŸ¥è©¢é é¢ã€ã€‚</li>
                </ol>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-palette"></i> æ¨¡æ¿é¢¨æ ¼èªªæ˜</h3>
                <ul>
                    <li><strong>æ´»æ½‘å¯æ„›é¢¨æ ¼</strong>ï¼šç²‰ç´…è‰²ç³»ã€åœ“æ½¤è¨­è¨ˆã€å¯æ„›åœ–æ¨™ï¼Œé©åˆè¦ªåˆ‡å‹å–„çš„å ´åˆã€‚</li>
                    <li><strong>ç°¡å–®æ¸…æ–°é¢¨æ ¼</strong>ï¼šè—ç¶ è‰²ç³»ã€ç°¡æ½”è¨­è¨ˆã€æ¸…æ–°æ„Ÿï¼Œé©åˆç°¡ç´„è‡ªç„¶çš„å ´åˆã€‚</li>
                    <li><strong>å°ˆæ¥­å½¢è±¡é¢¨æ ¼</strong>ï¼šé»‘ç™½ç°è‰²ç³»ã€ç°¡ç´„è¨­è¨ˆã€å°ˆæ¥­æ„Ÿï¼Œé©åˆæ­£å¼å•†æ¥­å ´åˆã€‚</li>
                    <li><strong>è¯éº—ç‚«å½©é¢¨æ ¼</strong>ï¼šç´«ç´…è‰²ç³»ã€æ¼¸è®Šè¨­è¨ˆã€è¯éº—æ„Ÿï¼Œé©åˆå‰µæ„è¨­è¨ˆå ´åˆã€‚</li>
                    <li><strong>ç§‘æŠ€æœªä¾†é¢¨æ ¼</strong>ï¼šè—ç´«è‰²ç³»ã€ç§‘æŠ€æ„Ÿã€æœªä¾†æ„Ÿï¼Œé©åˆç§‘æŠ€ç›¸é—œå ´åˆã€‚</li>
                    <li><strong>è‡ªç„¶å¤§åœ°é¢¨æ ¼</strong>ï¼šæ£•ç¶ è‰²ç³»ã€è‡ªç„¶æ„Ÿã€å¤§åœ°æ„Ÿï¼Œé©åˆç’°ä¿è‡ªç„¶å ´åˆã€‚</li>
                    <li><strong>æµ·æ´‹è—å¤©é¢¨æ ¼</strong>ï¼šè—ç™½è‰²ç³»ã€æµ·æ´‹æ„Ÿã€å¤©ç©ºæ„Ÿï¼Œé©åˆæ—…éŠä¼‘é–’å ´åˆã€‚</li>
                    <li><strong>å¾©å¤æ‡·èˆŠé¢¨æ ¼</strong>ï¼šæ£•é»ƒè‰²ç³»ã€å¾©å¤æ„Ÿã€æ‡·èˆŠæ„Ÿï¼Œé©åˆæ–‡åŒ–å‚³çµ±å ´åˆã€‚</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-lightbulb"></i> ä½¿ç”¨æŠ€å·§</h3>
                <ul>
                    <li><strong>æœå°‹æ¬„ä½è¨­å®š</strong>ï¼šå»ºè­°é¸æ“‡è³‡æ–™ä¸­å…·æœ‰å”¯ä¸€æ€§æˆ–å¸¸ç”¨æ–¼æŸ¥è©¢çš„æ¬„ä½ï¼Œå¦‚å§“åã€ç·¨è™Ÿã€æ—¥æœŸç­‰ã€‚</li>
                    <li><strong>è¼¸å…¥é¡å‹é¸æ“‡</strong>ï¼š
                        <ul>
                            <li><strong>æ–‡å­—è¼¸å…¥</strong>ï¼šé©ç”¨æ–¼éœ€è¦è‡ªç”±è¼¸å…¥çš„æ¬„ä½ï¼Œå¦‚å§“åã€åœ°å€ç­‰ã€‚</li>
                            <li><strong>ä¸‹æ‹‰å¼é¸å–®</strong>ï¼šé©ç”¨æ–¼é¸é …å›ºå®šçš„æ¬„ä½ï¼Œå¦‚éƒ¨é–€ã€é¡åˆ¥ç­‰ã€‚</li>
                            <li><strong>å¯†ç¢¼è¼¸å…¥</strong>ï¼šé©ç”¨æ–¼æ•æ„Ÿè³‡è¨Šæ¬„ä½ï¼Œå¦‚å¯†ç¢¼ã€èº«ä»½è­‰è™Ÿç­‰ï¼Œè¼¸å…¥æ™‚æœƒé¡¯ç¤ºç‚ºé®ç½©ã€‚</li>
                        </ul>
                    </li>
                    <li><strong>é¡¯ç¤ºæ¬„ä½é †åº</strong>ï¼šå¯ä»¥æ‹–æ›³èª¿æ•´é¡¯ç¤ºæ¬„ä½çš„é †åºï¼Œå°‡é‡è¦è³‡è¨Šæ”¾åœ¨å‰é¢ã€‚</li>
                    <li><strong>çµæœå‘ˆç¾æ–¹å¼</strong>ï¼š
                        <ul>
                            <li><strong>ç¸±å‘æ¢åˆ—å¼</strong>ï¼šæ¯ç­†è³‡æ–™å‚ç›´æ’åˆ—ï¼Œé©åˆè³‡æ–™ç­†æ•¸è¼ƒå°‘æˆ–æ¬„ä½è¼ƒå¤šçš„æƒ…æ³ã€‚</li>
                            <li><strong>æ©«å‘è¡¨æ ¼å¼</strong>ï¼šä»¥è¡¨æ ¼å½¢å¼å‘ˆç¾ï¼Œé©åˆè³‡æ–™ç­†æ•¸è¼ƒå¤šæˆ–éœ€è¦æ¯”è¼ƒçš„æƒ…æ³ã€‚</li>
                            <li><strong>å¤šé‡é¸æ“‡</strong>ï¼šå¯ä»¥åŒæ™‚é¸æ“‡å¤šç¨®å‘ˆç¾æ–¹å¼ï¼Œåœ¨æŸ¥è©¢é é¢æä¾›åˆ‡æ›æŒ‰éˆ•è®“ä½¿ç”¨è€…é¸æ“‡ã€‚</li>
                        </ul>
                    </li>
                    <li><strong>å»é‡åŠŸèƒ½</strong>ï¼šå¦‚æœè³‡æ–™ä¸­æœ‰é‡è¤‡è¨˜éŒ„ï¼Œå»ºè­°é–‹å•Ÿå»é‡åŠŸèƒ½ï¼Œè®“æœå°‹çµæœæ›´æ¸…æ™°ã€‚</li>
                    <li><strong>è³‡æ–™åŠ å¯†</strong>ï¼šå¦‚æœè³‡æ–™åŒ…å«æ•æ„Ÿè³‡è¨Šï¼Œå»ºè­°é–‹å•ŸåŠ å¯†åŠŸèƒ½ï¼Œä¿è­·è³‡æ–™å®‰å…¨ã€‚</li>
                    <li><strong>æœå°‹æ¬„ä½åŠ å¯†</strong>ï¼šå¦‚æœæœå°‹æ¬„ä½çš„é¸é …å€¼ä¹ŸåŒ…å«æ•æ„Ÿè³‡è¨Šï¼Œå»ºè­°é–‹å•Ÿæœå°‹æ¬„ä½åŠ å¯†åŠŸèƒ½ã€‚</li>
                    <li><strong>æ¨¡æ¿é¸æ“‡</strong>ï¼šæ ¹æ“šä½¿ç”¨å ´åˆå’Œç›®æ¨™å—çœ¾é¸æ“‡åˆé©çš„æ¨¡æ¿é¢¨æ ¼ï¼Œæå‡ä½¿ç”¨è€…é«”é©—ã€‚</li>
                </ul>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-file-export"></i> ç”¢ç”ŸæŸ¥è©¢é é¢å¾Œ</h3>
                <p>å®Œæˆæ‰€æœ‰æ­¥é©Ÿå¾Œï¼Œç³»çµ±æœƒè‡ªå‹•ä¸‹è¼‰ä¸€å€‹HTMLæª”æ¡ˆã€‚æ‚¨å¯ä»¥ï¼š</p>
                <ul>
                    <li>ç›´æ¥åœ¨ç€è¦½å™¨ä¸­é–‹å•Ÿä½¿ç”¨</li>
                    <li>ä¸Šå‚³åˆ°ç¶²ç«™ä¼ºæœå™¨ä¾›ä»–äººä½¿ç”¨</li>
                    <li>åœ¨å…§éƒ¨ç¶²è·¯ä¸­åˆ†äº«çµ¦åŒäº‹</li>
                    <li>åµŒå…¥åˆ°ç¾æœ‰ç¶²é ä¸­</li>
                </ul>
                <p>ç”Ÿæˆçš„æŸ¥è©¢é é¢æ˜¯ç¨ç«‹çš„HTMLæª”æ¡ˆï¼Œä¸éœ€è¦é¡å¤–çš„ä¼ºæœå™¨æˆ–è³‡æ–™åº«ï¼Œéå¸¸æ–¹ä¾¿éƒ¨ç½²ã€‚</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-lock"></i> è³‡æ–™åŠ å¯†èªªæ˜</h3>
                <p>æœ¬ç³»çµ±æä¾›ä¸‰ç¨®åŠ å¯†ç­‰ç´šï¼Œä¿è­·æ‚¨çš„è³‡æ–™å®‰å…¨ï¼š</p>
                <ul>
                    <li><strong>åŸºæœ¬åŠ å¯†ï¼ˆBase64ï¼‰</strong>ï¼šå°‡è³‡æ–™é€²è¡ŒBase64ç·¨ç¢¼ï¼Œé˜²æ­¢ç›´æ¥æŸ¥çœ‹ï¼Œä½†å®‰å…¨æ€§è¼ƒä½ã€‚</li>
                    <li><strong>ä¸­ç­‰åŠ å¯†ï¼ˆXORï¼‰</strong>ï¼šä½¿ç”¨XORæ¼”ç®—æ³•åŠ å¯†ï¼Œæ¯”Base64æ›´å®‰å…¨ï¼Œé©åˆä¸€èˆ¬è³‡æ–™ä¿è­·ã€‚</li>
                    <li><strong>é«˜ç´šåŠ å¯†ï¼ˆAESï¼‰</strong>ï¼šä½¿ç”¨æ”¹é€²çš„AESæ¼”ç®—æ³•åŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œé©åˆæ•æ„Ÿè³‡æ–™ä¿è­·ã€‚</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>è«‹å‹™å¿…å¦¥å–„ä¿ç®¡åŠ å¯†é‡‘é‘°ï¼Œéºå¤±å¾Œå°‡ç„¡æ³•è§£å¯†è³‡æ–™ï¼</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-search"></i> æœå°‹æ¬„ä½åŠ å¯†èªªæ˜</h3>
                <p>é™¤äº†å°æ•´é«”è³‡æ–™é€²è¡ŒåŠ å¯†å¤–ï¼Œæ‚¨é‚„å¯ä»¥é¸æ“‡å°æœå°‹æ¬„ä½çš„é¸é …å€¼é€²è¡ŒåŠ å¯†ï¼š</p>
                <ul>
                    <li><strong>é¸é …å€¼åŠ å¯†</strong>ï¼šä¸‹æ‹‰å¼é¸å–®ä¸­çš„é¸é …å€¼å°‡è¢«åŠ å¯†ï¼Œé˜²æ­¢åœ¨HTMLåŸå§‹ç¢¼ä¸­ç›´æ¥çœ‹åˆ°åŸå§‹è³‡æ–™ã€‚</li>
                    <li><strong>è‡ªå‹•è§£å¯†</strong>ï¼šç•¶ç”¨æˆ¶é¸æ“‡é¸é …æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•è§£å¯†é¸é …å€¼ï¼Œç„¶å¾Œé€²è¡Œæœå°‹ã€‚</li>
                    <li><strong>å¢åŠ å®‰å…¨æ€§</strong>ï¼šå³ä½¿æœ‰äººæŸ¥çœ‹HTMLåŸå§‹ç¢¼ï¼Œä¹Ÿç„¡æ³•ç›´æ¥ç²å–é¸é …çš„åŸå§‹å€¼ã€‚</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>æ­¤åŠŸèƒ½éœ€è¦èˆ‡è³‡æ–™åŠ å¯†åŠŸèƒ½ä¸€èµ·ä½¿ç”¨ï¼Œæ‰èƒ½é”åˆ°æœ€ä½³ä¿è­·æ•ˆæœã€‚</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-key"></i> å¯†ç¢¼æ¬„ä½èªªæ˜</h3>
                <p>å°æ–¼æ•æ„Ÿè³‡è¨Šçš„æœå°‹æ¬„ä½ï¼Œæ‚¨å¯ä»¥é¸æ“‡ä½¿ç”¨å¯†ç¢¼è¼¸å…¥é¡å‹ï¼š</p>
                <ul>
                    <li><strong>è¼¸å…¥é®ç½©</strong>ï¼šç”¨æˆ¶è¼¸å…¥æ™‚æœƒé¡¯ç¤ºç‚ºåœ“é»æˆ–æ˜Ÿè™Ÿï¼Œé˜²æ­¢æ—äººçªºè¦–ã€‚</li>
                    <li><strong>é©ç”¨å ´æ™¯</strong>ï¼šé©ç”¨æ–¼å¯†ç¢¼ã€èº«ä»½è­‰è™Ÿã€é›»è©±è™Ÿç¢¼ç­‰æ•æ„Ÿè³‡è¨Šçš„æœå°‹ã€‚</li>
                    <li><strong>èˆ‡ä¸‹æ‹‰å¼é¸å–®äº’æ–¥</strong>ï¼šå¯†ç¢¼è¼¸å…¥å’Œä¸‹æ‹‰å¼é¸å–®åªèƒ½é¸æ“‡ä¸€ç¨®è¼¸å…¥æ–¹å¼ã€‚</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>å¯†ç¢¼è¼¸å…¥é¡å‹åƒ…æ”¹è®Šè¼¸å…¥æ™‚çš„é¡¯ç¤ºæ–¹å¼ï¼Œä¸å½±éŸ¿è³‡æ–™çš„åŠ å¯†å’Œå„²å­˜ã€‚</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-search"></i> æŸ¥è©¢æ–¹å¼è¨­å®šèªªæ˜</h3>
                <p>æœ¬ç³»çµ±è®“æ‚¨å¯ä»¥åœ¨è¨­å®šé é¢ä¸­é å…ˆè¨­å®šæŸ¥è©¢é é¢è¦æä¾›çš„æŸ¥è©¢æ–¹å¼ï¼š</p>
                <ul>
                    <li><strong>å®Œå…¨ç¬¦åˆæŸ¥è©¢</strong>ï¼šæœå°‹çµæœå¿…é ˆèˆ‡è¼¸å…¥çš„é—œéµå­—å®Œå…¨ç›¸åŒï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ã€‚é©ç”¨æ–¼éœ€è¦ç²¾ç¢ºåŒ¹é…çš„å ´æ™¯ï¼Œå¦‚ç”¢å“ç·¨è™Ÿã€èº«ä»½è­‰è™Ÿç­‰ã€‚</li>
                    <li><strong>å«é—œéµå­—æŸ¥è©¢</strong>ï¼šæœå°‹çµæœåªè¦åŒ…å«è¼¸å…¥çš„é—œéµå­—å³å¯ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ã€‚é©ç”¨æ–¼æ¨¡ç³Šæœå°‹çš„å ´æ™¯ï¼Œå¦‚å§“åã€åœ°å€ç­‰ã€‚</li>
                    <li><strong>éˆæ´»é¸æ“‡</strong>ï¼šæ‚¨å¯ä»¥é¸æ“‡åªæä¾›ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼Œæˆ–å…©ç¨®éƒ½æä¾›è®“ç”¨æˆ¶è‡ªè¡Œé¸æ“‡ã€‚</li>
                    <li><strong>å¿…é¸è¦æ±‚</strong>ï¼šè‡³å°‘å¿…é ˆé¸æ“‡ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼Œç¢ºä¿æŸ¥è©¢é é¢èƒ½æ­£å¸¸é‹ä½œã€‚</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>æŸ¥è©¢æ–¹å¼çš„è¨­å®šæœƒå½±éŸ¿æœ€çµ‚ç”Ÿæˆçš„æŸ¥è©¢é é¢åŠŸèƒ½ï¼Œè«‹æ ¹æ“šå¯¦éš›éœ€æ±‚é¸æ“‡ã€‚</p>
            </div>
            
            <div class="help-section">
                <h3><i class="fas fa-exclamation-circle"></i> å¿…å¡«æ¬„ä½èªªæ˜</h3>
                <p>æœ¬ç³»çµ±è¦æ±‚æ‰€æœ‰æœå°‹æ¬„ä½éƒ½å¿…é ˆå¡«å¯«å…§å®¹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢ï¼š</p>
                <ul>
                    <li><strong>å¿…å¡«é™åˆ¶</strong>ï¼šæ‰€æœ‰è¨­å®šçš„æœå°‹æ¬„ä½éƒ½å¿…é ˆå¡«å¯«å…§å®¹ï¼Œå¦å‰‡ç„¡æ³•åŸ·è¡ŒæŸ¥è©¢ã€‚</li>
                    <li><strong>æç¤ºè¨Šæ¯</strong>ï¼šå¦‚æœæœ‰ä»»ä½•ä¸€å€‹æ¬„ä½æœªå¡«å¯«ï¼Œç³»çµ±æœƒé¡¯ç¤ºæç¤ºè¨Šæ¯ï¼Œè¦æ±‚å¡«å¯«æ‰€æœ‰æ¬„ä½ã€‚</li>
                    <li><strong>è¨­è¨ˆç›®çš„</strong>ï¼šé€™ç¨®è¨­è¨ˆå¯ä»¥ç¢ºä¿æŸ¥è©¢æ¢ä»¶å®Œæ•´ï¼Œæé«˜æŸ¥è©¢ç²¾ç¢ºåº¦ï¼Œé¿å…è¿”å›éå¤šä¸ç›¸é—œçš„çµæœã€‚</li>
                </ul>
                <p><strong>æ³¨æ„ï¼š</strong>è«‹ç¢ºä¿åœ¨è¨­å®šæœå°‹æ¬„ä½æ™‚ï¼Œåªé¸æ“‡å¯¦éš›éœ€è¦çš„æ¬„ä½ï¼Œé¿å…çµ¦ä½¿ç”¨è€…å¸¶ä¾†ä¸å¿…è¦çš„å¡«å¯«è² æ“”ã€‚</p>
            </div>
        </div>
    </div>
    
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸŒ¸ å°‡è¦–ç®—è¡¨è½‰ç‚ºç¶²é è³‡æ–™æŸ¥è©¢ç³»çµ±è¨­å®šV1.5 ğŸŒ¸</h1>
            <p class="text-white text-lg">è®“æ‚¨çš„è³‡æ–™æŸ¥è©¢è®Šå¾—ç°¡å–®åˆå¯æ„›ï¼</p>
        </div>
        
        <!-- æ­¥é©ŸæŒ‡ç¤ºå™¨ -->
        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
            <div class="step" id="step4">4</div>
            <div class="step" id="step5">5</div>
        </div>
        
        <!-- ä¸»è¦å…§å®¹ -->
        <div class="cute-card p-8">
            <!-- æ­¥é©Ÿ1: ä¸Šå‚³æª”æ¡ˆ -->
            <div id="uploadStep" class="step-content">
                <h2 class="text-2xl font-bold mb-6 text-center text-pink-500">ğŸ“ æ­¥é©Ÿ1ï¼šä¸Šå‚³è©¦ç®—è¡¨æª”æ¡ˆ</h2>
                <div class="text-center">
                    <label for="fileInput" class="cute-button inline-block cursor-pointer">
                        <span class="text-xl">ğŸ“¤</span> é¸æ“‡ XLSX æª”æ¡ˆ
                    </label>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <p class="mt-4 text-gray-600">è«‹é¸æ“‡ Excel è©¦ç®—è¡¨æª”æ¡ˆï¼ˆ.xlsx æˆ– .xlsï¼‰</p>
                    <div id="fileName" class="mt-2 text-pink-500 font-medium"></div>
                </div>
            </div>
            
            <!-- æ­¥é©Ÿ2: é¸æ“‡å·¥ä½œè¡¨ -->
            <div id="worksheetStep" class="step-content hidden">
                <h2 class="text-2xl font-bold mb-6 text-center text-pink-500">ğŸ“‹ æ­¥é©Ÿ2ï¼šé¸æ“‡å·¥ä½œè¡¨</h2>
                <div class="text-center">
                    <label class="block mb-4 text-lg">è«‹é¸æ“‡è¦ä½¿ç”¨çš„å·¥ä½œè¡¨ï¼š</label>
                    <select id="worksheetSelect" class="cute-select text-lg px-6 py-3">
                        <option value="">è«‹é¸æ“‡...</option>
                    </select>
                    <div class="mt-6">
                        <button onclick="loadWorksheet()" class="cute-button">
                            <span class="text-xl">âœ¨</span> è¼‰å…¥å·¥ä½œè¡¨
                        </button>
                    </div>
                </div>
                <!-- é™¤éŒ¯è³‡è¨Š -->
                <div id="debugInfo" class="debug-info hidden"></div>
            </div>
            
            <!-- æ­¥é©Ÿ3: è¨­å®šæ¬„ä½ -->
            <div id="fieldStep" class="step-content hidden">
                <h2 class="text-2xl font-bold mb-6 text-center text-pink-500">âš™ï¸ æ­¥é©Ÿ3ï¼šè¨­å®šæ¬„ä½</h2>
                
                <!-- æ¬„ä½åç¨±é è¦½ -->
                <div class="mb-6 bg-yellow-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2 text-yellow-700">ğŸ“ åµæ¸¬åˆ°çš„æ¬„ä½åç¨±ï¼š</h3>
                    <div id="headersPreview" class="flex flex-wrap gap-2"></div>
                </div>
                
                <!-- æœå°‹æ¬„ä½è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ” æœå°‹æ¬„ä½è¨­å®šï¼ˆæœ€å¤š4å€‹ï¼‰</h3>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p class="text-blue-700">
                            <i class="fas fa-info-circle mr-2"></i>
                            <strong>æ³¨æ„ï¼š</strong>æ‰€æœ‰è¨­å®šçš„æœå°‹æ¬„ä½éƒ½å¿…é ˆå¡«å¯«å…§å®¹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢ï¼Œè«‹åªé¸æ“‡å¿…è¦çš„æ¬„ä½ã€‚
                        </p>
                    </div>
                    <div id="searchFields" class="space-y-3">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- é¡¯ç¤ºæ¬„ä½è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ‘ï¸ é¡¯ç¤ºæ¬„ä½è¨­å®šï¼ˆæœ€å¤š10å€‹ï¼‰</h3>
                    <div id="displayFields" class="space-y-3">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- çµæœå‘ˆç¾æ–¹å¼è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ“Š çµæœå‘ˆç¾æ–¹å¼è¨­å®š</h3>
                    <div class="display-mode-options">
                        <div class="mb-3">
                            <p class="text-purple-700 font-medium">
                                <i class="fas fa-info-circle mr-2"></i>
                                è«‹é¸æ“‡æŸ¥è©¢çµæœçš„å‘ˆç¾æ–¹å¼ï¼ˆå¯å¤šé¸ï¼‰ï¼š
                            </p>
                        </div>
                        
                        <div class="display-mode-option">
                            <input type="checkbox" id="displayModeList" class="cute-checkbox" checked>
                            <label for="displayModeList">ç¸±å‘æ¢åˆ—å¼</label>
                        </div>
                        <div class="display-mode-description">
                            æ¯ç­†è³‡æ–™å‚ç›´æ’åˆ—ï¼Œé©åˆè³‡æ–™ç­†æ•¸è¼ƒå°‘æˆ–æ¬„ä½è¼ƒå¤šçš„æƒ…æ³ã€‚æ¯ç­†è³‡æ–™ä»¥å¡ç‰‡å½¢å¼å‘ˆç¾ï¼Œæ¬„ä½åç¨±å’Œå€¼ä¸Šä¸‹æ’åˆ—ã€‚
                        </div>
                        
                        <div class="display-mode-option">
                            <input type="checkbox" id="displayModeTable" class="cute-checkbox">
                            <label for="displayModeTable">æ©«å‘è¡¨æ ¼å¼</label>
                        </div>
                        <div class="display-mode-description">
                            ä»¥è¡¨æ ¼å½¢å¼å‘ˆç¾ï¼Œé©åˆè³‡æ–™ç­†æ•¸è¼ƒå¤šæˆ–éœ€è¦æ¯”è¼ƒçš„æƒ…æ³ã€‚æ¬„ä½åç¨±åœ¨è¡¨é ­ï¼Œè³‡æ–™ä»¥åˆ—çš„å½¢å¼å‘ˆç¾ã€‚
                        </div>
                        
                        <div id="displayModeValidation" class="mt-3 p-3 bg-yellow-100 rounded-lg hidden">
                            <p class="text-yellow-700">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®çµæœå‘ˆç¾æ–¹å¼ï¼
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- æŸ¥è©¢æ–¹å¼è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ” æŸ¥è©¢æ–¹å¼è¨­å®š</h3>
                    <div class="search-mode-options">
                        <div class="mb-3">
                            <p class="text-blue-700 font-medium">
                                <i class="fas fa-info-circle mr-2"></i>
                                è«‹é¸æ“‡æŸ¥è©¢é é¢è¦æä¾›çš„æŸ¥è©¢æ–¹å¼ï¼ˆè‡³å°‘é¸æ“‡ä¸€ç¨®ï¼‰ï¼š
                            </p>
                        </div>
                        
                        <div class="search-mode-option">
                            <input type="checkbox" id="searchModeExact" class="cute-checkbox" onchange="updateSearchModeValidation()">
                            <label for="searchModeExact">å®Œå…¨ç¬¦åˆæŸ¥è©¢</label>
                        </div>
                        <div class="search-mode-description">
                            æœå°‹çµæœå¿…é ˆèˆ‡è¼¸å…¥çš„é—œéµå­—å®Œå…¨ç›¸åŒï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ã€‚é©ç”¨æ–¼éœ€è¦ç²¾ç¢ºåŒ¹é…çš„å ´æ™¯ï¼Œå¦‚ç”¢å“ç·¨è™Ÿã€èº«ä»½è­‰è™Ÿç­‰ã€‚
                        </div>
                        
                        <div class="search-mode-option">
                            <input type="checkbox" id="searchModeContains" class="cute-checkbox" onchange="updateSearchModeValidation()">
                            <label for="searchModeContains">å«é—œéµå­—æŸ¥è©¢</label>
                        </div>
                        <div class="search-mode-description">
                            æœå°‹çµæœåªè¦åŒ…å«è¼¸å…¥çš„é—œéµå­—å³å¯ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰ã€‚é©ç”¨æ–¼æ¨¡ç³Šæœå°‹çš„å ´æ™¯ï¼Œå¦‚å§“åã€åœ°å€ç­‰ã€‚
                        </div>
                        
                        <div id="searchModeValidation" class="mt-3 p-3 bg-yellow-100 rounded-lg hidden">
                            <p class="text-yellow-700">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- é é¢è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ¨ é é¢è¨­å®š</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-2 font-medium">æŸ¥è©¢é é¢å¤§æ¨™é¡Œ</label>
                            <input type="text" id="pageTitle" class="cute-input w-full" placeholder="è«‹è¼¸å…¥æ¨™é¡Œ">
                        </div>
                        <div>
                            <label class="block mb-2 font-medium">å–®ä½åç¨±</label>
                            <input type="text" id="unitName" class="cute-input w-full" placeholder="è«‹è¼¸å…¥å–®ä½åç¨±">
                        </div>
                    </div>
                </div>
                
                <!-- å»é‡è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ”„ é‡è¤‡è³‡æ–™è™•ç†</h3>
                    <div class="flex items-center space-x-3">
                        <input type="checkbox" id="removeDuplicates" class="cute-checkbox">
                        <label for="removeDuplicates" class="text-gray-700">ç§»é™¤é‡è¤‡è³‡æ–™ï¼ˆåªé¡¯ç¤ºä¸€ç­†ï¼‰</label>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">å‹¾é¸æ­¤é¸é …å¾Œï¼Œæœå°‹çµæœä¸­ç›¸åŒçš„è³‡æ–™åªæœƒé¡¯ç¤ºä¸€ç­†</p>
                </div>
                
                <!-- åŠ å¯†è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ”’ è³‡æ–™åŠ å¯†è¨­å®š</h3>
                    <div class="flex items-center space-x-3 mb-3">
                        <input type="checkbox" id="enableEncryption" class="cute-checkbox" onchange="toggleEncryptionOptions()">
                        <label for="enableEncryption" class="text-gray-700">å•Ÿç”¨è³‡æ–™åŠ å¯†</label>
                    </div>
                    
                    <div id="encryptionOptions" class="encryption-options hidden">
                        <div class="mb-4">
                            <label class="block mb-2 font-medium">é¸æ“‡åŠ å¯†æ–¹å¼</label>
                            <div class="space-y-2">
                                <div class="encryption-level">
                                    <input type="radio" id="encryptionBase64" name="encryptionMethod" value="base64" checked>
                                    <label for="encryptionBase64">åŸºæœ¬åŠ å¯†ï¼ˆBase64ï¼‰</label>
                                </div>
                                <div class="encryption-description">å°‡è³‡æ–™é€²è¡ŒBase64ç·¨ç¢¼ï¼Œé˜²æ­¢ç›´æ¥æŸ¥çœ‹ï¼Œä½†å®‰å…¨æ€§è¼ƒä½</div>
                                
                                <div class="encryption-level">
                                    <input type="radio" id="encryptionXOR" name="encryptionMethod" value="xor">
                                    <label for="encryptionXOR">ä¸­ç­‰åŠ å¯†ï¼ˆXORï¼‰</label>
                                </div>
                                <div class="encryption-description">ä½¿ç”¨XORæ¼”ç®—æ³•åŠ å¯†ï¼Œæ¯”Base64æ›´å®‰å…¨ï¼Œé©åˆä¸€èˆ¬è³‡æ–™ä¿è­·</div>
                                
                                <div class="encryption-level">
                                    <input type="radio" id="encryptionAES" name="encryptionMethod" value="aes">
                                    <label for="encryptionAES">é«˜ç´šåŠ å¯†ï¼ˆAESï¼‰</label>
                                </div>
                                <div class="encryption-description">ä½¿ç”¨æ”¹é€²çš„AESæ¼”ç®—æ³•åŠ å¯†ï¼Œå®‰å…¨æ€§æœ€é«˜ï¼Œé©åˆæ•æ„Ÿè³‡æ–™ä¿è­·</div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block mb-2 font-medium">åŠ å¯†é‡‘é‘°</label>
                            <input type="password" id="encryptionKey" class="cute-input w-full" placeholder="è«‹è¼¸å…¥åŠ å¯†é‡‘é‘°">
                            <p class="mt-2 text-sm text-gray-500">è«‹è¨˜ä½æ­¤é‡‘é‘°ï¼Œéºå¤±å¾Œå°‡ç„¡æ³•è§£å¯†è³‡æ–™</p>
                        </div>
                    </div>
                </div>
                
                <!-- æœå°‹æ¬„ä½åŠ å¯†è¨­å®š -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold mb-4 text-pink-400">ğŸ” æœå°‹æ¬„ä½åŠ å¯†è¨­å®š</h3>
                    <div class="flex items-center space-x-3 mb-3">
                        <input type="checkbox" id="enableSearchEncryption" class="cute-checkbox" onchange="toggleSearchEncryptionOptions()" disabled>
                        <label for="enableSearchEncryption" class="text-gray-700">å•Ÿç”¨æœå°‹æ¬„ä½åŠ å¯†</label>
                    </div>
                    
                    <div id="searchEncryptionOptions" class="encryption-options hidden">
                        <div class="bg-blue-50 p-4 rounded-lg mb-4">
                            <p class="text-blue-700">
                                <i class="fas fa-info-circle mr-2"></i>
                                æ­¤åŠŸèƒ½å°‡å°ä¸‹æ‹‰å¼é¸å–®ä¸­çš„é¸é …å€¼é€²è¡ŒåŠ å¯†ï¼Œé˜²æ­¢åœ¨HTMLåŸå§‹ç¢¼ä¸­ç›´æ¥çœ‹åˆ°åŸå§‹è³‡æ–™ã€‚
                                ç•¶ç”¨æˆ¶é¸æ“‡é¸é …æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•è§£å¯†é¸é …å€¼ï¼Œç„¶å¾Œé€²è¡Œæœå°‹ã€‚
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block mb-2 font-medium">é¸æ“‡è¦åŠ å¯†çš„æœå°‹æ¬„ä½</label>
                            <div id="searchFieldEncryptionOptions" class="space-y-2">
                                <!-- å‹•æ…‹ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ­¥é©Ÿ4: ç¢ºèªè¨­å®š -->
            <div id="confirmStep" class="step-content hidden">
                <h2 class="text-2xl font-bold mb-6 text-center text-pink-500">âœ… æ­¥é©Ÿ4ï¼šç¢ºèªè¨­å®š</h2>
                <div id="configSummary" class="bg-pink-50 rounded-lg p-6">
                    <!-- å‹•æ…‹ç”Ÿæˆè¨­å®šæ‘˜è¦ -->
                </div>
                <div class="text-center mt-8">
                    <button onclick="nextStep()" class="cute-button text-xl">
                        ä¸‹ä¸€æ­¥ <span class="text-xl">â†’</span>
                    </button>
                </div>
            </div>
            
            <!-- æ­¥é©Ÿ5: é¸æ“‡æ¨¡æ¿ -->
            <div id="templateStep" class="step-content hidden">
                <h2 class="text-2xl font-bold mb-6 text-center text-pink-500">ğŸ¨ æ­¥é©Ÿ5ï¼šé¸æ“‡ç¶²é æ¨¡æ¿</h2>
                <p class="text-center text-gray-600 mb-8">è«‹é¸æ“‡æ‚¨å–œæ­¡çš„ç¶²é è¨­è¨ˆé¢¨æ ¼ï¼Œå¥—ç”¨åˆ°æŸ¥è©¢é é¢</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- æ´»æ½‘å¯æ„›é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('cute')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸŒ¸</div>
                                    <div class="text-white font-bold">æ´»æ½‘å¯æ„›</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">æ´»æ½‘å¯æ„›é¢¨æ ¼</div>
                            <div class="template-description">ç²‰ç´…è‰²ç³»ã€åœ“æ½¤è¨­è¨ˆã€å¯æ„›åœ–æ¨™</div>
                        </div>
                    </div>
                    
                    <!-- ç°¡å–®æ¸…æ–°é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('fresh')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸƒ</div>
                                    <div class="text-white font-bold">ç°¡å–®æ¸…æ–°</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">ç°¡å–®æ¸…æ–°é¢¨æ ¼</div>
                            <div class="template-description">è—ç¶ è‰²ç³»ã€ç°¡æ½”è¨­è¨ˆã€æ¸…æ–°æ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- å°ˆæ¥­å½¢è±¡é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('professional')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #434343 0%, #000000 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸ’¼</div>
                                    <div class="text-white font-bold">å°ˆæ¥­å½¢è±¡</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">å°ˆæ¥­å½¢è±¡é¢¨æ ¼</div>
                            <div class="template-description">é»‘ç™½ç°è‰²ç³»ã€ç°¡ç´„è¨­è¨ˆã€å°ˆæ¥­æ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- è¯éº—ç‚«å½©é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('glamorous')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">âœ¨</div>
                                    <div class="text-white font-bold">è¯éº—ç‚«å½©</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">è¯éº—ç‚«å½©é¢¨æ ¼</div>
                            <div class="template-description">ç´«ç´…è‰²ç³»ã€æ¼¸è®Šè¨­è¨ˆã€è¯éº—æ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- ç§‘æŠ€æœªä¾†é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('tech')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸš€</div>
                                    <div class="text-white font-bold">ç§‘æŠ€æœªä¾†</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">ç§‘æŠ€æœªä¾†é¢¨æ ¼</div>
                            <div class="template-description">è—ç´«è‰²ç³»ã€ç§‘æŠ€æ„Ÿã€æœªä¾†æ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- è‡ªç„¶å¤§åœ°é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('nature')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #8B4513 0%, #228B22 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸŒ¿</div>
                                    <div class="text-white font-bold">è‡ªç„¶å¤§åœ°</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">è‡ªç„¶å¤§åœ°é¢¨æ ¼</div>
                            <div class="template-description">æ£•ç¶ è‰²ç³»ã€è‡ªç„¶æ„Ÿã€å¤§åœ°æ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- æµ·æ´‹è—å¤©é¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('ocean')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸŒŠ</div>
                                    <div class="text-white font-bold">æµ·æ´‹è—å¤©</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">æµ·æ´‹è—å¤©é¢¨æ ¼</div>
                            <div class="template-description">è—ç™½è‰²ç³»ã€æµ·æ´‹æ„Ÿã€å¤©ç©ºæ„Ÿ</div>
                        </div>
                    </div>
                    
                    <!-- å¾©å¤æ‡·èˆŠé¢¨æ ¼ -->
                    <div class="template-card" onclick="selectTemplate('vintage')">
                        <div class="template-preview" style="background: linear-gradient(135deg, #d4a574 0%, #8b6f47 100%);">
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="text-5xl mb-2">ğŸ“œ</div>
                                    <div class="text-white font-bold">å¾©å¤æ‡·èˆŠ</div>
                                </div>
                            </div>
                        </div>
                        <div class="template-info">
                            <div class="template-name">å¾©å¤æ‡·èˆŠé¢¨æ ¼</div>
                            <div class="template-description">æ£•é»ƒè‰²ç³»ã€å¾©å¤æ„Ÿã€æ‡·èˆŠæ„Ÿ</div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button onclick="generateQueryPage()" class="cute-button text-xl">
                        <span class="text-xl">ğŸš€</span> ç”¢ç”ŸæŸ¥è©¢é é¢
                    </button>
                </div>
            </div>
            
            <!-- å°èˆªæŒ‰éˆ• -->
            <div class="flex justify-between mt-8">
                <button id="prevBtn" onclick="previousStep()" class="cute-button hidden">
                    <span class="text-xl">â†</span> ä¸Šä¸€æ­¥
                </button>
                <button id="nextBtn" onclick="nextStep()" class="cute-button ml-auto hidden">
                    ä¸‹ä¸€æ­¥ <span class="text-xl">â†’</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- é è…³ -->
    <footer class="footer">
        <p>æœ¬ç¶²é ç¨‹å¼ç”± koming è¨­è¨ˆ 2025.09.21 é è¨­æ¬„ä½åç¨±ç‰ˆ</p>
    </footer>
    
    <script>
        let currentStep = 1;
        let workbook = null;
        let worksheetData = null;
        let headers = [];
        let config = {
            searchFields: [],
            displayFields: [],
            displayModes: [], // æ–°å¢ï¼šå„²å­˜é¸æ“‡çš„çµæœå‘ˆç¾æ–¹å¼
            searchModes: [], // æ–°å¢ï¼šå„²å­˜é¸æ“‡çš„æŸ¥è©¢æ–¹å¼
            pageTitle: '',
            unitName: '',
            removeDuplicates: false,
            template: 'cute', // é è¨­æ¨¡æ¿
            enableEncryption: false,
            encryptionMethod: 'base64',
            encryptionKey: '',
            enableSearchEncryption: false,
            searchEncryptionFields: []
        };
        
        // æ¨¡æ¿å®šç¾©
        const templates = {
            cute: {
                name: 'æ´»æ½‘å¯æ„›é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #fd79a8 0%, #e84393 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #e84393 0%, #d81b60 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(232, 67, 147, 0.4)',
                inputBorder: '2px solid #ffeaa7',
                inputFocusBorder: '2px solid #fd79a8',
                inputFocusShadow: '0 0 0 3px rgba(253, 121, 168, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #fff5f7 0%, #ffeef2 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #ffd6e8 0%, #ffb3d1 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#e84393',
                icon: 'ğŸŒ¸',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,240,245,0.9) 100%)',
                resultContainerBorder: '3px solid #ffb3d1',
                resultFieldBackground: 'rgba(255, 182, 193, 0.2)',
                resultFieldBorder: '2px solid #ffb3d1'
            },
            fresh: {
                name: 'ç°¡å–®æ¸…æ–°é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #4a9b29 0%, #96d9c3 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(86, 171, 47, 0.4)',
                inputBorder: '2px solid #a8e6cf',
                inputFocusBorder: '2px solid #56ab2f',
                inputFocusShadow: '0 0 0 3px rgba(86, 171, 47, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #bae7ff 0%, #91d5ff 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#56ab2f',
                icon: 'ğŸƒ',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(230,247,255,0.9) 100%)',
                resultContainerBorder: '3px solid #91d5ff',
                resultFieldBackground: 'rgba(145, 213, 255, 0.2)',
                resultFieldBorder: '2px solid #91d5ff'
            },
            professional: {
                name: 'å°ˆæ¥­å½¢è±¡é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #434343 0%, #000000 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #2c3e50 0%, #34495e 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #1a252f 0%, #2c3e50 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(44, 62, 80, 0.4)',
                inputBorder: '2px solid #bdc3c7',
                inputFocusBorder: '2px solid #3498db',
                inputFocusShadow: '0 0 0 3px rgba(52, 152, 219, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #dee2e6 0%, #ced4da 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#2c3e50',
                icon: 'ğŸ’¼',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%)',
                resultContainerBorder: '3px solid #6c757d',
                resultFieldBackground: 'rgba(108, 117, 125, 0.1)',
                resultFieldBorder: '2px solid #6c757d'
            },
            glamorous: {
                name: 'è¯éº—ç‚«å½©é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #8E2DE2 0%, #4A00E0 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #7a24cc 0%, #4200cc 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(142, 45, 226, 0.4)',
                inputBorder: '2px solid #d9a5e3',
                inputFocusBorder: '2px solid #8E2DE2',
                inputFocusShadow: '0 0 0 3px rgba(142, 45, 226, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f8f0ff 0%, #f3e5ff 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #e6ccff 0%, #d9b3ff 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#8E2DE2',
                icon: 'âœ¨',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(243,229,255,0.9) 100%)',
                resultContainerBorder: '3px solid #d9b3ff',
                resultFieldBackground: 'rgba(217, 179, 255, 0.2)',
                resultFieldBorder: '2px solid #d9b3ff'
            },
            tech: {
                name: 'ç§‘æŠ€æœªä¾†é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #3a56d4 0%, #330a91 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(67, 97, 238, 0.4)',
                inputBorder: '2px solid #b8c6db',
                inputFocusBorder: '2px solid #4361ee',
                inputFocusShadow: '0 0 0 3px rgba(67, 97, 238, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f0f4ff 0%, #e6e9ff 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #d0d9ff 0%, #b8c6ff 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#4361ee',
                icon: 'ğŸš€',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(230,233,255,0.9) 100%)',
                resultContainerBorder: '3px solid #b8c6ff',
                resultFieldBackground: 'rgba(184, 198, 255, 0.2)',
                resultFieldBorder: '2px solid #b8c6ff'
            },
            nature: {
                name: 'è‡ªç„¶å¤§åœ°é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #8B4513 0%, #228B22 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #8B4513 0%, #556B2F 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #7a3d11 0%, #4a5a2a 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(139, 69, 19, 0.4)',
                inputBorder: '2px solid #deb887',
                inputFocusBorder: '2px solid #8B4513',
                inputFocusShadow: '0 0 0 3px rgba(139, 69, 19, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f8f5f0 0%, #f0ece6 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #e6dcc6 0%, #d4c4a8 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#8B4513',
                icon: 'ğŸŒ¿',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(240,236,230,0.9) 100%)',
                resultContainerBorder: '3px solid #d4c4a8',
                resultFieldBackground: 'rgba(212, 196, 168, 0.2)',
                resultFieldBorder: '2px solid #d4c4a8'
            },
            ocean: {
                name: 'æµ·æ´‹è—å¤©é¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #00c6ff 0%, #0072ff 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #0099c0 0%, #0066a0 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(0, 180, 216, 0.4)',
                inputBorder: '2px solid #90e0ef',
                inputFocusBorder: '2px solid #00b4d8',
                inputFocusShadow: '0 0 0 3px rgba(0, 180, 216, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #bae7ff 0%, #91d5ff 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#00b4d8',
                icon: 'ğŸŒŠ',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(230,247,255,0.9) 100%)',
                resultContainerBorder: '3px solid #91d5ff',
                resultFieldBackground: 'rgba(145, 213, 255, 0.2)',
                resultFieldBorder: '2px solid #91d5ff'
            },
            vintage: {
                name: 'å¾©å¤æ‡·èˆŠé¢¨æ ¼',
                bodyBackground: 'linear-gradient(135deg, #d4a574 0%, #8b6f47 100%)',
                cardBackground: '#ffffff',
                cardShadow: '0 10px 30px rgba(0,0,0,0.1)',
                cardHoverTransform: 'translateY(-5px)',
                buttonBackground: 'linear-gradient(135deg, #cd853f 0%, #8b4513 100%)',
                buttonHoverBackground: 'linear-gradient(135deg, #b87333 0%, #7a3d11 100%)',
                buttonHoverTransform: 'scale(1.05)',
                buttonHoverShadow: '0 5px 15px rgba(205, 133, 63, 0.4)',
                inputBorder: '2px solid #f5deb3',
                inputFocusBorder: '2px solid #cd853f',
                inputFocusShadow: '0 0 0 3px rgba(205, 133, 63, 0.1)',
                resultRowBackground: 'linear-gradient(135deg, #faf8f3 0%, #f5f0e6 100%)',
                resultRowHoverBackground: 'linear-gradient(135deg, #ede4d6 0%, #e6d4c1 100%)',
                resultRowHoverTransform: 'translateY(-5px)',
                titleColor: '#ffffff',
                subtitleColor: '#ffffff',
                sectionTitleColor: '#cd853f',
                icon: 'ğŸ“œ',
                resultContainerBackground: 'linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(245,240,230,0.9) 100%)',
                resultContainerBorder: '3px solid #e6d4c1',
                resultFieldBackground: 'rgba(230, 212, 193, 0.2)',
                resultFieldBorder: '2px solid #e6d4c1'
            }
        };
        
        // æª”æ¡ˆä¸Šå‚³è™•ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = 'å·²é¸æ“‡ï¼š' + file.name;
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        workbook = XLSX.read(data, {type: 'array'});
                        populateWorksheets();
                        showStep(2);
                    } catch (error) {
                        showNotification('æª”æ¡ˆè®€å–å¤±æ•—ï¼š' + error.message, 'error');
                        console.error('æª”æ¡ˆè®€å–éŒ¯èª¤ï¼š', error);
                    }
                };
                reader.readAsArrayBuffer(file);
            }
        });
        
        // å¡«å……å·¥ä½œè¡¨é¸é …
        function populateWorksheets() {
            const select = document.getElementById('worksheetSelect');
            select.innerHTML = '<option value="">è«‹é¸æ“‡...</option>';
            
            if (!workbook || !workbook.SheetNames) {
                showNotification('ç„¡æ³•è®€å–å·¥ä½œè¡¨æ¸…å–®', 'error');
                return;
            }
            
            workbook.SheetNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                select.appendChild(option);
            });
        }
        
        // è¼‰å…¥å·¥ä½œè¡¨
        function loadWorksheet() {
            const selectedSheet = document.getElementById('worksheetSelect').value;
            if (!selectedSheet) {
                showNotification('è«‹é¸æ“‡å·¥ä½œè¡¨ï¼', 'error');
                return;
            }
            
            try {
                const worksheet = workbook.Sheets[selectedSheet];
                
                // ä½¿ç”¨ä¸åŒçš„æ–¹å¼è®€å–è³‡æ–™ï¼Œç¢ºä¿èƒ½æ­£ç¢ºç²å–æ¨™é¡Œ
                worksheetData = XLSX.utils.sheet_to_json(worksheet, {header: 1, defval: ''});
                
                // é™¤éŒ¯è³‡è¨Š
                const debugInfo = document.getElementById('debugInfo');
                debugInfo.innerHTML = `
                    <strong>å·¥ä½œè¡¨è³‡è¨Šï¼š</strong><br>
                    å·¥ä½œè¡¨åç¨±ï¼š${selectedSheet}<br>
                    è³‡æ–™åˆ—æ•¸ï¼š${worksheetData.length}<br>
                    ç¬¬ä¸€åˆ—è³‡æ–™ï¼š${JSON.stringify(worksheetData[0])}<br>
                    ç¬¬äºŒåˆ—è³‡æ–™ï¼š${JSON.stringify(worksheetData[1])}
                `;
                debugInfo.classList.remove('hidden');
                
                if (worksheetData.length > 0) {
                    // ç¢ºä¿ headers æ˜¯é™£åˆ—
                    let firstRow = worksheetData[0];
                    console.log('ç¬¬ä¸€åˆ—åŸå§‹è³‡æ–™ï¼š', firstRow);
                    
                    // è™•ç†ä¸åŒçš„è³‡æ–™æ ¼å¼
                    if (Array.isArray(firstRow)) {
                        headers = firstRow;
                    } else if (typeof firstRow === 'object') {
                        headers = Object.values(firstRow);
                    } else {
                        headers = [firstRow];
                    }
                    
                    console.log('è™•ç†å¾Œçš„ headersï¼š', headers);
                    
                    // éæ¿¾æ‰ç©ºå€¼å’Œç„¡æ•ˆå€¼
                    headers = headers.filter(header => {
                        if (header === null || header === undefined) return false;
                        const str = String(header).trim();
                        return str !== '' && str !== 'null' && str !== 'undefined';
                    });
                    
                    console.log('éæ¿¾å¾Œçš„ headersï¼š', headers);
                    
                    if (headers.length > 0) {
                        // é¡¯ç¤ºæ¬„ä½é è¦½
                        displayHeadersPreview();
                        // å¡«å……æ¬„ä½è¨­å®š
                        populateFieldSettings();
                        showStep(3);
                    } else {
                        showNotification('ç¬¬ä¸€åˆ—æ²’æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„æ¬„ä½åç¨±ï¼', 'error');
                    }
                } else {
                    showNotification('å·¥ä½œè¡¨æ²’æœ‰è³‡æ–™ï¼', 'error');
                }
            } catch (error) {
                showNotification('è¼‰å…¥å·¥ä½œè¡¨å¤±æ•—ï¼š' + error.message, 'error');
                console.error('è¼‰å…¥å·¥ä½œè¡¨éŒ¯èª¤ï¼š', error);
            }
        }
        
        // é¡¯ç¤ºæ¬„ä½åç¨±é è¦½
        function displayHeadersPreview() {
            const preview = document.getElementById('headersPreview');
            preview.innerHTML = '';
            
            console.log('é¡¯ç¤ºæ¬„ä½é è¦½ï¼Œheaders æ•¸é‡ï¼š', headers.length);
            
            headers.forEach((header, index) => {
                const tag = document.createElement('span');
                tag.className = 'header-tag';
                tag.textContent = header;
                tag.title = `ç´¢å¼•: ${index}, å€¼: "${header}"`;
                preview.appendChild(tag);
                console.log(`æ·»åŠ æ¬„ä½æ¨™ç±¤ ${index}: ${header}`);
            });
        }
        
        // å¡«å……æ¬„ä½è¨­å®š
        function populateFieldSettings() {
            console.log('é–‹å§‹å¡«å……æ¬„ä½è¨­å®šï¼Œheaders:', headers);
            
            if (!headers || headers.length === 0) {
                showNotification('æ²’æœ‰å¯ç”¨çš„æ¬„ä½åç¨±ï¼', 'error');
                return;
            }
            
            // æœå°‹æ¬„ä½
            const searchFieldsDiv = document.getElementById('searchFields');
            searchFieldsDiv.innerHTML = '';
            
            for (let i = 0; i < 4; i++) { // ä¿®æ”¹ç‚º4å€‹æœå°‹æ¬„ä½
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-item';
                
                let options = '<option value="">è«‹é¸æ“‡æ¬„ä½</option>';
                console.log(`ç”Ÿæˆæœå°‹æ¬„ä½ ${i} çš„é¸é …`);
                
                headers.forEach((h, index) => {
                    const optionValue = h.toString().replace(/"/g, '&quot;');
                    options += `<option value="${optionValue}">${h}</option>`;
                    console.log(`æ·»åŠ é¸é …: ${h}`);
                });
                
                fieldDiv.innerHTML = 
                    '<div class="space-y-3">' +
                    '<div class="flex items-center space-x-4">' +
                    '<input type="checkbox" class="cute-checkbox" id="searchCheckbox' + i + '" onchange="updateSearchField(' + i + ', this.checked)">' +
                    '<select class="cute-select flex-1" id="searchField' + i + '" disabled>' + options + '</select>' +
                    '<input type="text" class="cute-input flex-1" id="searchLabel' + i + '" placeholder="é¡¯ç¤ºæ¨™é¡Œ" disabled>' +
                    '</div>' +
                    '<div class="input-type-options" id="inputTypeOptions' + i + '" style="display: none;">' +
                    '<div class="input-type-option">' +
                    '<input type="radio" class="cute-radio" id="searchTypeText' + i + '" name="searchType' + i + '" value="text" checked onchange="updateSearchType(' + i + ', \'text\')">' +
                    '<label for="searchTypeText' + i + '">æ–‡å­—è¼¸å…¥</label>' +
                    '</div>' +
                    '<div class="input-type-option">' +
                    '<input type="radio" class="cute-radio" id="searchTypeDropdown' + i + '" name="searchType' + i + '" value="dropdown" onchange="updateSearchType(' + i + ', \'dropdown\')">' +
                    '<label for="searchTypeDropdown' + i + '">ä¸‹æ‹‰å¼é¸å–®</label>' +
                    '</div>' +
                    '<div class="input-type-option">' +
                    '<input type="radio" class="cute-radio" id="searchTypePassword' + i + '" name="searchType' + i + '" value="password" onchange="updateSearchType(' + i + ', \'password\')">' +
                    '<label for="searchTypePassword' + i + '">å¯†ç¢¼è¼¸å…¥</label>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
                
                searchFieldsDiv.appendChild(fieldDiv);
                console.log(`æœå°‹æ¬„ä½ ${i} å·²æ·»åŠ `);
            }
            
            // é¡¯ç¤ºæ¬„ä½
            const displayFieldsDiv = document.getElementById('displayFields');
            displayFieldsDiv.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-item';
                
                let options = '<option value="">è«‹é¸æ“‡æ¬„ä½</option>';
                console.log(`ç”Ÿæˆé¡¯ç¤ºæ¬„ä½ ${i} çš„é¸é …`);
                
                headers.forEach((h, index) => {
                    const optionValue = h.toString().replace(/"/g, '&quot;');
                    options += `<option value="${optionValue}">${h}</option>`;
                    console.log(`æ·»åŠ é¸é …: ${h}`);
                });
                
                fieldDiv.innerHTML = 
                    '<div class="flex items-center space-x-4">' +
                    '<span class="drag-handle text-2xl">â˜°</span>' +
                    '<input type="checkbox" class="cute-checkbox" id="displayCheckbox' + i + '" onchange="updateDisplayField(' + i + ', this.checked)">' +
                    '<select class="cute-select flex-1" id="displayField' + i + '" disabled>' + options + '</select>' +
                    '<input type="text" class="cute-input flex-1" id="displayLabel' + i + '" placeholder="é¡¯ç¤ºæ¨™é¡Œ" disabled>' +
                    '</div>';
                
                displayFieldsDiv.appendChild(fieldDiv);
                console.log(`é¡¯ç¤ºæ¬„ä½ ${i} å·²æ·»åŠ `);
            }
            
            // åˆå§‹åŒ–æ‹–æ›³æ’åº
            initDragAndDrop();
            
            console.log('æ¬„ä½è¨­å®šå¡«å……å®Œæˆ');
        }
        
        // æ›´æ–°æœå°‹æ¬„ä½
        function updateSearchField(index, checked) {
            document.getElementById('searchField' + index).disabled = !checked;
            document.getElementById('searchLabel' + index).disabled = !checked;
            
            // é¡¯ç¤º/éš±è—è¼¸å…¥é¡å‹é¸é …
            const inputTypeOptions = document.getElementById('inputTypeOptions' + index);
            if (checked) {
                inputTypeOptions.style.display = 'block';
                
                // ç•¶é¸æ“‡æ¬„ä½æ™‚ï¼Œè‡ªå‹•å°‡æ¬„ä½åç¨±è¨­ç‚ºé¡¯ç¤ºæ¨™é¡Œ
                const fieldSelect = document.getElementById('searchField' + index);
                const labelInput = document.getElementById('searchLabel' + index);
                
                fieldSelect.addEventListener('change', function() {
                    if (this.value) {
                        labelInput.value = this.value;
                    }
                });
            } else {
                inputTypeOptions.style.display = 'none';
                // é‡ç½®è¼¸å…¥é¡å‹ç‚ºæ–‡å­—è¼¸å…¥
                document.getElementById('searchTypeText' + index).checked = true;
                updateSearchType(index, 'text');
                // æ¸…ç©ºé¸æ“‡å’Œæ¨™é¡Œ
                document.getElementById('searchField' + index).value = '';
                document.getElementById('searchLabel' + index).value = '';
            }
            
            // æ›´æ–°æœå°‹æ¬„ä½åŠ å¯†é¸é …
            updateSearchEncryptionOptions();
        }
        
        // æ›´æ–°æœå°‹æ¬„ä½é¡å‹
        function updateSearchType(index, type) {
            // é€™è£¡å¯ä»¥æ·»åŠ é¡å‹è®Šæ›´æ™‚çš„é‚è¼¯
            console.log(`æœå°‹æ¬„ä½ ${index} é¡å‹è®Šæ›´ç‚º: ${type}`);
            
            // æ›´æ–°æœå°‹æ¬„ä½åŠ å¯†é¸é …
            updateSearchEncryptionOptions();
        }
        
        // æ›´æ–°é¡¯ç¤ºæ¬„ä½
        function updateDisplayField(index, checked) {
            document.getElementById('displayField' + index).disabled = !checked;
            document.getElementById('displayLabel' + index).disabled = !checked;
            
            if (checked) {
                // ç•¶é¸æ“‡æ¬„ä½æ™‚ï¼Œè‡ªå‹•å°‡æ¬„ä½åç¨±è¨­ç‚ºé¡¯ç¤ºæ¨™é¡Œ
                const fieldSelect = document.getElementById('displayField' + index);
                const labelInput = document.getElementById('displayLabel' + index);
                
                fieldSelect.addEventListener('change', function() {
                    if (this.value) {
                        labelInput.value = this.value;
                    }
                });
            } else {
                // æ¸…ç©ºé¸æ“‡å’Œæ¨™é¡Œ
                document.getElementById('displayField' + index).value = '';
                document.getElementById('displayLabel' + index).value = '';
            }
        }
        
        // åˆå§‹åŒ–æ‹–æ›³æ’åº
        function initDragAndDrop() {
            const container = document.getElementById('displayFields');
            let draggedElement = null;
            
            container.addEventListener('dragstart', function(e) {
                if (e.target.classList.contains('field-item')) {
                    draggedElement = e.target;
                    e.target.style.opacity = '0.5';
                }
            });
            
            container.addEventListener('dragend', function(e) {
                if (e.target.classList.contains('field-item')) {
                    e.target.style.opacity = '';
                }
            });
            
            container.addEventListener('dragover', function(e) {
                e.preventDefault();
                const afterElement = getDragAfterElement(container, e.clientY);
                if (afterElement == null) {
                    container.appendChild(draggedElement);
                } else {
                    container.insertBefore(draggedElement, afterElement);
                }
            });
            
            // ç‚ºæ¯å€‹ field-item æ·»åŠ  draggable å±¬æ€§
            container.querySelectorAll('.field-item').forEach(item => {
                item.draggable = true;
            });
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.field-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // æ›´æ–°æŸ¥è©¢æ–¹å¼é©—è­‰
        function updateSearchModeValidation() {
            const exactChecked = document.getElementById('searchModeExact').checked;
            const containsChecked = document.getElementById('searchModeContains').checked;
            const validationDiv = document.getElementById('searchModeValidation');
            
            if (!exactChecked && !containsChecked) {
                validationDiv.classList.remove('hidden');
            } else {
                validationDiv.classList.add('hidden');
            }
        }
        
        // æ›´æ–°çµæœå‘ˆç¾æ–¹å¼é©—è­‰
        function updateDisplayModeValidation() {
            const listChecked = document.getElementById('displayModeList').checked;
            const tableChecked = document.getElementById('displayModeTable').checked;
            const validationDiv = document.getElementById('displayModeValidation');
            
            if (!listChecked && !tableChecked) {
                validationDiv.classList.remove('hidden');
            } else {
                validationDiv.classList.add('hidden');
            }
        }
        
        // åˆ‡æ›åŠ å¯†é¸é …é¡¯ç¤º
        function toggleEncryptionOptions() {
            const enableEncryption = document.getElementById('enableEncryption').checked;
            const encryptionOptions = document.getElementById('encryptionOptions');
            const enableSearchEncryption = document.getElementById('enableSearchEncryption');
            
            if (enableEncryption) {
                encryptionOptions.classList.remove('hidden');
                enableSearchEncryption.disabled = false;
            } else {
                encryptionOptions.classList.add('hidden');
                enableSearchEncryption.disabled = true;
                enableSearchEncryption.checked = false;
                toggleSearchEncryptionOptions();
            }
        }
        
        // åˆ‡æ›æœå°‹æ¬„ä½åŠ å¯†é¸é …é¡¯ç¤º
        function toggleSearchEncryptionOptions() {
            const enableSearchEncryption = document.getElementById('enableSearchEncryption').checked;
            const searchEncryptionOptions = document.getElementById('searchEncryptionOptions');
            
            if (enableSearchEncryption) {
                searchEncryptionOptions.classList.remove('hidden');
                updateSearchEncryptionOptions();
            } else {
                searchEncryptionOptions.classList.add('hidden');
            }
        }
        
        // æ›´æ–°æœå°‹æ¬„ä½åŠ å¯†é¸é …
        function updateSearchEncryptionOptions() {
            const searchFieldEncryptionOptions = document.getElementById('searchFieldEncryptionOptions');
            searchFieldEncryptionOptions.innerHTML = '';
            
            // æ”¶é›†æ‰€æœ‰ä½¿ç”¨ä¸‹æ‹‰å¼é¸å–®çš„æœå°‹æ¬„ä½
            for (let i = 0; i < 4; i++) {
                const checkbox = document.getElementById('searchCheckbox' + i);
                if (checkbox && checkbox.checked) {
                    const field = document.getElementById('searchField' + i).value;
                    const label = document.getElementById('searchLabel' + i).value;
                    const typeRadio = document.querySelector('input[name="searchType' + i + '"]:checked');
                    const type = typeRadio ? typeRadio.value : 'text';
                    
                    if (field && label && type === 'dropdown') {
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'flex items-center space-x-3';
                        optionDiv.innerHTML = 
                            '<input type="checkbox" class="cute-checkbox" id="searchEncryptCheckbox' + i + '" value="' + field + '">' +
                            '<label for="searchEncryptCheckbox' + i + '" class="text-gray-700">' + label + ' (' + field + ')</label>';
                        
                        searchFieldEncryptionOptions.appendChild(optionDiv);
                    }
                }
            }
            
            // å¦‚æœæ²’æœ‰å¯ç”¨çš„æœå°‹æ¬„ä½ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯
            if (searchFieldEncryptionOptions.children.length === 0) {
                searchFieldEncryptionOptions.innerHTML = 
                    '<div class="text-gray-500 italic">è«‹å…ˆè¨­å®šä½¿ç”¨ä¸‹æ‹‰å¼é¸å–®çš„æœå°‹æ¬„ä½</div>';
            }
        }
        
        // é¡¯ç¤ºæ­¥é©Ÿ
        function showStep(step) {
            currentStep = step;
            
            // éš±è—æ‰€æœ‰æ­¥é©Ÿ
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // é¡¯ç¤ºç•¶å‰æ­¥é©Ÿ
            const stepContents = ['uploadStep', 'worksheetStep', 'fieldStep', 'confirmStep', 'templateStep'];
            document.getElementById(stepContents[step - 1]).classList.remove('hidden');
            
            // æ›´æ–°æ­¥é©ŸæŒ‡ç¤ºå™¨
            document.querySelectorAll('.step').forEach((indicator, index) => {
                if (index < step) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
            
            // æ›´æ–°æŒ‰éˆ•
            document.getElementById('prevBtn').classList.toggle('hidden', step === 1);
            document.getElementById('nextBtn').classList.toggle('hidden', step === 5);
            
            // å¦‚æœæ˜¯ç¬¬å››æ­¥ï¼Œç”Ÿæˆè¨­å®šæ‘˜è¦
            if (step === 4) {
                generateConfigSummary();
            }
        }
        
        // ä¸‹ä¸€æ­¥
        function nextStep() {
            if (currentStep === 3) {
                // é©—è­‰è¨­å®š
                if (!validateConfig()) {
                    return;
                }
                saveConfig();
            }
            showStep(currentStep + 1);
        }
        
        // ä¸Šä¸€æ­¥
        function previousStep() {
            showStep(currentStep - 1);
        }
        
        // é¸æ“‡æ¨¡æ¿
        function selectTemplate(templateId) {
            // ç§»é™¤æ‰€æœ‰æ¨¡æ¿çš„é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // æ·»åŠ é¸ä¸­ç‹€æ…‹åˆ°ç•¶å‰æ¨¡æ¿
            event.currentTarget.classList.add('selected');
            
            // ä¿å­˜é¸æ“‡çš„æ¨¡æ¿
            config.template = templateId;
            
            // é¡¯ç¤ºé€šçŸ¥
            showNotification(`å·²é¸æ“‡ ${templates[templateId].name} æ¨¡æ¿`, 'success');
        }
        
        // é©—è­‰è¨­å®š
        function validateConfig() {
            let searchCount = 0;
            let displayCount = 0;
            
            // æª¢æŸ¥æœå°‹æ¬„ä½
            for (let i = 0; i < 4; i++) { // ä¿®æ”¹ç‚º4å€‹æœå°‹æ¬„ä½
                const checkbox = document.getElementById('searchCheckbox' + i);
                if (checkbox && checkbox.checked) {
                    searchCount++;
                    const field = document.getElementById('searchField' + i).value;
                    const label = document.getElementById('searchLabel' + i).value;
                    if (!field || !label) {
                        showNotification('è«‹å®Œæ•´å¡«å¯«æœå°‹æ¬„ä½è¨­å®šï¼', 'error');
                        return false;
                    }
                }
            }
            
            if (searchCount === 0) {
                showNotification('è«‹è‡³å°‘è¨­å®šä¸€å€‹æœå°‹æ¬„ä½ï¼', 'error');
                return false;
            }
            
            // æª¢æŸ¥é¡¯ç¤ºæ¬„ä½
            for (let i = 0; i < 10; i++) {
                const checkbox = document.getElementById('displayCheckbox' + i);
                if (checkbox && checkbox.checked) {
                    displayCount++;
                    const field = document.getElementById('displayField' + i).value;
                    const label = document.getElementById('displayLabel' + i).value;
                    if (!field || !label) {
                        showNotification('è«‹å®Œæ•´å¡«å¯«é¡¯ç¤ºæ¬„ä½è¨­å®šï¼', 'error');
                        return false;
                    }
                }
            }
            
            if (displayCount === 0) {
                showNotification('è«‹è‡³å°‘è¨­å®šä¸€å€‹é¡¯ç¤ºæ¬„ä½ï¼', 'error');
                return false;
            }
            
            // æª¢æŸ¥çµæœå‘ˆç¾æ–¹å¼è¨­å®š
            const listChecked = document.getElementById('displayModeList').checked;
            const tableChecked = document.getElementById('displayModeTable').checked;
            
            if (!listChecked && !tableChecked) {
                showNotification('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®çµæœå‘ˆç¾æ–¹å¼ï¼', 'error');
                return false;
            }
            
            // æª¢æŸ¥æŸ¥è©¢æ–¹å¼è¨­å®š
            const exactChecked = document.getElementById('searchModeExact').checked;
            const containsChecked = document.getElementById('searchModeContains').checked;
            
            if (!exactChecked && !containsChecked) {
                showNotification('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼', 'error');
                return false;
            }
            
            // æª¢æŸ¥é é¢è¨­å®š
            const pageTitle = document.getElementById('pageTitle').value;
            const unitName = document.getElementById('unitName').value;
            
            if (!pageTitle || !unitName) {
                showNotification('è«‹å¡«å¯«é é¢æ¨™é¡Œå’Œå–®ä½åç¨±ï¼', 'error');
                return false;
            }
            
            // æª¢æŸ¥åŠ å¯†è¨­å®š
            const enableEncryption = document.getElementById('enableEncryption').checked;
            if (enableEncryption) {
                const encryptionKey = document.getElementById('encryptionKey').value;
                if (!encryptionKey) {
                    showNotification('è«‹è¼¸å…¥åŠ å¯†é‡‘é‘°ï¼', 'error');
                    return false;
                }
            }
            
            // æª¢æŸ¥æœå°‹æ¬„ä½åŠ å¯†è¨­å®š
            const enableSearchEncryption = document.getElementById('enableSearchEncryption').checked;
            if (enableSearchEncryption) {
                const searchEncryptCheckboxes = document.querySelectorAll('#searchFieldEncryptionOptions input[type="checkbox"]:checked');
                if (searchEncryptCheckboxes.length === 0) {
                    showNotification('è«‹é¸æ“‡è‡³å°‘ä¸€å€‹è¦åŠ å¯†çš„æœå°‹æ¬„ä½ï¼', 'error');
                    return false;
                }
            }
            
            return true;
        }
        
        // å„²å­˜è¨­å®š
        function saveConfig() {
            config.searchFields = [];
            config.displayFields = [];
            config.displayModes = []; // æ–°å¢ï¼šå„²å­˜çµæœå‘ˆç¾æ–¹å¼
            config.searchModes = []; // æ–°å¢ï¼šå„²å­˜æŸ¥è©¢æ–¹å¼
            config.pageTitle = document.getElementById('pageTitle').value;
            config.unitName = document.getElementById('unitName').value;
            config.removeDuplicates = document.getElementById('removeDuplicates').checked;
            
            // å„²å­˜çµæœå‘ˆç¾æ–¹å¼
            if (document.getElementById('displayModeList').checked) {
                config.displayModes.push('list');
            }
            if (document.getElementById('displayModeTable').checked) {
                config.displayModes.push('table');
            }
            
            // å„²å­˜æŸ¥è©¢æ–¹å¼
            if (document.getElementById('searchModeExact').checked) {
                config.searchModes.push('exact');
            }
            if (document.getElementById('searchModeContains').checked) {
                config.searchModes.push('contains');
            }
            
            // å„²å­˜åŠ å¯†è¨­å®š
            config.enableEncryption = document.getElementById('enableEncryption').checked;
            if (config.enableEncryption) {
                const encryptionMethod = document.querySelector('input[name="encryptionMethod"]:checked').value;
                config.encryptionMethod = encryptionMethod;
                config.encryptionKey = document.getElementById('encryptionKey').value;
            }
            
            // å„²å­˜æœå°‹æ¬„ä½åŠ å¯†è¨­å®š
            config.enableSearchEncryption = document.getElementById('enableSearchEncryption').checked;
            config.searchEncryptionFields = [];
            if (config.enableSearchEncryption) {
                const searchEncryptCheckboxes = document.querySelectorAll('#searchFieldEncryptionOptions input[type="checkbox"]:checked');
                searchEncryptCheckboxes.forEach(checkbox => {
                    config.searchEncryptionFields.push(checkbox.value);
                });
            }
            
            // å„²å­˜æœå°‹æ¬„ä½
            for (let i = 0; i < 4; i++) { // ä¿®æ”¹ç‚º4å€‹æœå°‹æ¬„ä½
                const checkbox = document.getElementById('searchCheckbox' + i);
                if (checkbox && checkbox.checked) {
                    const field = document.getElementById('searchField' + i).value;
                    const label = document.getElementById('searchLabel' + i).value;
                    const typeRadio = document.querySelector('input[name="searchType' + i + '"]:checked');
                    const type = typeRadio ? typeRadio.value : 'text';
                    
                    config.searchFields.push({
                        field: field,
                        label: label,
                        type: type
                    });
                    console.log(`å„²å­˜æœå°‹æ¬„ä½ ${i}: ${field} - ${label} - é¡å‹: ${type}`);
                }
            }
            
            // å„²å­˜é¡¯ç¤ºæ¬„ä½ï¼ˆæŒ‰ç…§æ‹–æ›³å¾Œçš„é †åºï¼‰
            const displayFieldItems = document.querySelectorAll('#displayFields .field-item');
            displayFieldItems.forEach((item, index) => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox && checkbox.checked) {
                    const select = item.querySelector('select');
                    const input = item.querySelector('input[type="text"]');
                    config.displayFields.push({
                        field: select.value,
                        label: input.value
                    });
                    console.log(`å„²å­˜é¡¯ç¤ºæ¬„ä½ ${index}: ${select.value} - ${input.value}`);
                }
            });
            
            console.log('æœ€çµ‚è¨­å®šï¼š', config);
        }
        
        // ç”Ÿæˆè¨­å®šæ‘˜è¦
        function generateConfigSummary() {
            const summary = document.getElementById('configSummary');
            let searchFieldsHtml = '';
            config.searchFields.forEach(f => {
                const typeNames = {
                    'text': 'æ–‡å­—è¼¸å…¥',
                    'dropdown': 'ä¸‹æ‹‰å¼é¸å–®',
                    'password': 'å¯†ç¢¼è¼¸å…¥'
                };
                searchFieldsHtml += '<li>' + f.label + ' (' + f.field + ') - ' + typeNames[f.type] + '</li>';
            });
            
            let displayFieldsHtml = '';
            config.displayFields.forEach(f => {
                displayFieldsHtml += '<li>' + f.label + ' (' + f.field + ')</li>';
            });
            
            let displayModesHtml = '';
            if (config.displayModes.includes('list')) {
                displayModesHtml += '<li>ç¸±å‘æ¢åˆ—å¼</li>';
            }
            if (config.displayModes.includes('table')) {
                displayModesHtml += '<li>æ©«å‘è¡¨æ ¼å¼</li>';
            }
            
            let searchModesHtml = '';
            if (config.searchModes.includes('exact')) {
                searchModesHtml += '<li>å®Œå…¨ç¬¦åˆæŸ¥è©¢</li>';
            }
            if (config.searchModes.includes('contains')) {
                searchModesHtml += '<li>å«é—œéµå­—æŸ¥è©¢</li>';
            }
            
            let encryptionHtml = '';
            if (config.enableEncryption) {
                const methodNames = {
                    'base64': 'åŸºæœ¬åŠ å¯†ï¼ˆBase64ï¼‰',
                    'xor': 'ä¸­ç­‰åŠ å¯†ï¼ˆXORï¼‰',
                    'aes': 'é«˜ç´šåŠ å¯†ï¼ˆAESï¼‰'
                };
                encryptionHtml = '<div>' +
                    '<h4 class="font-semibold text-pink-500">ğŸ”’ è³‡æ–™åŠ å¯†è¨­å®š</h4>' +
                    '<p class="mt-2">âœ… å·²å•Ÿç”¨è³‡æ–™åŠ å¯†</p>' +
                    '<p>åŠ å¯†æ–¹å¼ï¼š' + methodNames[config.encryptionMethod] + '</p>' +
                    '</div>';
            } else {
                encryptionHtml = '<div>' +
                    '<h4 class="font-semibold text-pink-500">ğŸ”’ è³‡æ–™åŠ å¯†è¨­å®š</h4>' +
                    '<p class="mt-2">âŒ æœªå•Ÿç”¨è³‡æ–™åŠ å¯†</p>' +
                    '</div>';
            }
            
            let searchEncryptionHtml = '';
            if (config.enableSearchEncryption) {
                searchEncryptionHtml = '<div>' +
                    '<h4 class="font-semibold text-pink-500">ğŸ” æœå°‹æ¬„ä½åŠ å¯†è¨­å®š</h4>' +
                    '<p class="mt-2">âœ… å·²å•Ÿç”¨æœå°‹æ¬„ä½åŠ å¯†</p>' +
                    '<p>åŠ å¯†æ¬„ä½ï¼š' + config.searchEncryptionFields.join(', ') + '</p>' +
                    '</div>';
            } else {
                searchEncryptionHtml = '<div>' +
                    '<h4 class="font-semibold text-pink-500">ğŸ” æœå°‹æ¬„ä½åŠ å¯†è¨­å®š</h4>' +
                    '<p class="mt-2">âŒ æœªå•Ÿç”¨æœå°‹æ¬„ä½åŠ å¯†</p>' +
                    '</div>';
            }
            
            summary.innerHTML = 
                '<h3 class="text-xl font-bold mb-4 text-pink-600">ğŸ“‹ è¨­å®šæ‘˜è¦</h3>' +
                '<div class="space-y-4">' +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ” æœå°‹æ¬„ä½</h4>' +
                '<ul class="list-disc list-inside mt-2">' + searchFieldsHtml + '</ul>' +
                '<p class="mt-2 text-sm text-blue-600"><i class="fas fa-info-circle mr-1"></i> æ‰€æœ‰æœå°‹æ¬„ä½éƒ½å¿…é ˆå¡«å¯«å…§å®¹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢</p>' +
                '</div>' +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ‘ï¸ é¡¯ç¤ºæ¬„ä½</h4>' +
                '<ul class="list-disc list-inside mt-2">' + displayFieldsHtml + '</ul>' +
                '</div>' +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ“Š çµæœå‘ˆç¾æ–¹å¼</h4>' +
                '<ul class="list-disc list-inside mt-2">' + displayModesHtml + '</ul>' +
                '</div>' +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ” æŸ¥è©¢æ–¹å¼</h4>' +
                '<ul class="list-disc list-inside mt-2">' + searchModesHtml + '</ul>' +
                '</div>' +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ”„ é‡è¤‡è³‡æ–™è™•ç†</h4>' +
                '<p class="mt-2">' + (config.removeDuplicates ? 'âœ… ç§»é™¤é‡è¤‡è³‡æ–™ï¼ˆåªé¡¯ç¤ºä¸€ç­†ï¼‰' : 'âŒ é¡¯ç¤ºæ‰€æœ‰è³‡æ–™ï¼ˆåŒ…å«é‡è¤‡ï¼‰') + '</p>' +
                '</div>' +
                encryptionHtml +
                searchEncryptionHtml +
                '<div>' +
                '<h4 class="font-semibold text-pink-500">ğŸ“„ é é¢è¨­å®š</h4>' +
                '<p class="mt-2">æ¨™é¡Œï¼š' + config.pageTitle + '</p>' +
                '<p>å–®ä½ï¼š' + config.unitName + '</p>' +
                '</div>' +
                '</div>';
        }
        
        // å­—ç¬¦ä¸²è½‰æ›ç‚º Uint8Array
        function stringToUint8Array(str) {
            const encoder = new TextEncoder();
            return encoder.encode(str);
        }
        
        // Uint8Array è½‰æ›ç‚ºå­—ç¬¦ä¸²
        function uint8ArrayToString(uint8Array) {
            const decoder = new TextDecoder();
            return decoder.decode(uint8Array);
        }
        
        // åŠ å¯†å–®å€‹å€¼
        function encryptValue(value, method, key) {
            if (!value) return value;
            
            try {
                switch (method) {
                    case 'base64':
                        return btoa(unescape(encodeURIComponent(value)));
                        
                    case 'xor':
                        // ä½¿ç”¨æ”¹é€²çš„ XOR åŠ å¯†
                        const dataBytes = stringToUint8Array(value);
                        const keyBytes = stringToUint8Array(key);
                        const resultBytes = new Uint8Array(dataBytes.length);
                        
                        for (let i = 0; i < dataBytes.length; i++) {
                            resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                        }
                        
                        return btoa(String.fromCharCode.apply(null, resultBytes));
                        
                    case 'aes':
                        // ç°¡åŒ–çš„ AES æ¨¡æ“¬åŠ å¯† - ä½¿ç”¨å–®ä¸€è¼ªæ¬¡ï¼Œç¢ºä¿ä¸€è‡´æ€§
                        const dataBytesAES = stringToUint8Array(value);
                        const keyBytesAES = stringToUint8Array(key);
                        const resultBytesAES = new Uint8Array(dataBytesAES.length);
                        
                        // ç°¡å–®çš„å–®è¼ªåŠ å¯†ï¼Œé¿å…è¤‡é›œæ€§å°è‡´çš„éŒ¯èª¤
                        for (let i = 0; i < dataBytesAES.length; i++) {
                            const keyByte = keyBytesAES[i % keyBytesAES.length];
                            resultBytesAES[i] = (dataBytesAES[i] + keyByte + 123) % 256; // ä½¿ç”¨å›ºå®šåç§»é‡
                        }
                        
                        return btoa(String.fromCharCode.apply(null, resultBytesAES));
                        
                    default:
                        return value;
                }
            } catch (e) {
                console.error('åŠ å¯†å¤±æ•—:', e);
                return value;
            }
        }
        
        // è§£å¯†å–®å€‹å€¼
        function decryptValue(encryptedValue, method, key) {
            if (!encryptedValue) return encryptedValue;
            
            try {
                switch (method) {
                    case 'base64':
                        return decodeURIComponent(escape(atob(encryptedValue)));
                        
                    case 'xor':
                        // ä½¿ç”¨æ”¹é€²çš„ XOR è§£å¯†
                        const encryptedData = atob(encryptedValue);
                        const dataBytes = new Uint8Array(encryptedData.split('').map(char => char.charCodeAt(0)));
                        const keyBytes = stringToUint8Array(key);
                        const resultBytes = new Uint8Array(dataBytes.length);
                        
                        for (let i = 0; i < dataBytes.length; i++) {
                            resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                        }
                        
                        return uint8ArrayToString(resultBytes);
                        
                    case 'aes':
                        // ç°¡åŒ–çš„ AES æ¨¡æ“¬è§£å¯† - å¿…é ˆèˆ‡åŠ å¯†å®Œå…¨å°ç¨±
                        const encryptedDataAES = atob(encryptedValue);
                        const dataBytesAES = new Uint8Array(encryptedDataAES.split('').map(char => char.charCodeAt(0)));
                        const keyBytesAES = stringToUint8Array(key);
                        const resultBytesAES = new Uint8Array(dataBytesAES.length);
                        
                        // èˆ‡åŠ å¯†å®Œå…¨å°ç¨±çš„è§£å¯†éç¨‹
                        for (let i = 0; i < dataBytesAES.length; i++) {
                            const keyByte = keyBytesAES[i % keyBytesAES.length];
                            resultBytesAES[i] = (dataBytesAES[i] - keyByte - 123 + 256) % 256; // ä½¿ç”¨ç›¸åŒçš„å›ºå®šåç§»é‡
                        }
                        
                        return uint8ArrayToString(resultBytesAES);
                        
                    default:
                        return encryptedValue;
                }
            } catch (e) {
                console.error('è§£å¯†å¤±æ•—:', e);
                return null;
            }
        }
        
        // åŠ å¯†è³‡æ–™å‡½æ•¸
        function encryptData(data, method, key) {
            if (!data) return data;
            
            try {
                switch (method) {
                    case 'base64':
                        return btoa(unescape(encodeURIComponent(JSON.stringify(data))));
                        
                    case 'xor':
                        // ä½¿ç”¨æ”¹é€²çš„ XOR åŠ å¯† - åˆ†æ‰¹è™•ç†é¿å…å †ç–Šæº¢å‡º
                        const jsonString = JSON.stringify(data);
                        const chunkSize = 1000; // æ¯æ¬¡è™•ç†1000å€‹å­—ç¬¦
                        let encryptedChunks = [];
                        
                        for (let i = 0; i < jsonString.length; i += chunkSize) {
                            const chunk = jsonString.substring(i, i + chunkSize);
                            const dataBytes = stringToUint8Array(chunk);
                            const keyBytes = stringToUint8Array(key);
                            const resultBytes = new Uint8Array(dataBytes.length);
                            
                            for (let j = 0; j < dataBytes.length; j++) {
                                resultBytes[j] = dataBytes[j] ^ keyBytes[j % keyBytes.length];
                            }
                            
                            encryptedChunks.push(btoa(String.fromCharCode.apply(null, resultBytes)));
                        }
                        
                        return encryptedChunks.join('|'); // ä½¿ç”¨|åˆ†éš”ç¬¦é€£æ¥åŠ å¯†å¡Š
                        
                    case 'aes':
                        // ç°¡åŒ–çš„ AES æ¨¡æ“¬åŠ å¯† - èˆ‡å–®å€‹å€¼åŠ å¯†ä½¿ç”¨ç›¸åŒçš„é‚è¼¯
                        const jsonStringAES = JSON.stringify(data);
                        const chunkSizeAES = 1000; // æ¯æ¬¡è™•ç†1000å€‹å­—ç¬¦
                        let encryptedChunksAES = [];
                        
                        for (let i = 0; i < jsonStringAES.length; i += chunkSizeAES) {
                            const chunk = jsonStringAES.substring(i, i + chunkSizeAES);
                            const dataBytes = stringToUint8Array(chunk);
                            const keyBytes = stringToUint8Array(key);
                            const resultBytes = new Uint8Array(dataBytes.length);
                            
                            // ä½¿ç”¨èˆ‡å–®å€‹å€¼åŠ å¯†ç›¸åŒçš„ç°¡å–®é‚è¼¯
                            for (let j = 0; j < dataBytes.length; j++) {
                                const keyByte = keyBytes[j % keyBytes.length];
                                resultBytes[j] = (dataBytes[j] + keyByte + 123) % 256;
                            }
                            
                            encryptedChunksAES.push(btoa(String.fromCharCode.apply(null, resultBytes)));
                        }
                        
                        return encryptedChunksAES.join('|'); // ä½¿ç”¨|åˆ†éš”ç¬¦é€£æ¥åŠ å¯†å¡Š
                        
                    default:
                        return data;
                }
            } catch (e) {
                console.error('åŠ å¯†å¤±æ•—:', e);
                return null;
            }
        }
        
        // è§£å¯†è³‡æ–™å‡½æ•¸
        function decryptData(encryptedData, method, key) {
            if (!encryptedData) return encryptedData;
            
            try {
                switch (method) {
                    case 'base64':
                        return JSON.parse(decodeURIComponent(escape(atob(encryptedData))));
                        
                    case 'xor':
                        // ä½¿ç”¨æ”¹é€²çš„ XOR è§£å¯† - åˆ†æ‰¹è™•ç†é¿å…å †ç–Šæº¢å‡º
                        const encryptedChunks = encryptedData.split('|');
                        let decryptedString = '';
                        
                        for (const chunk of encryptedChunks) {
                            const encryptedString = atob(chunk);
                            const dataBytes = new Uint8Array(encryptedString.split('').map(char => char.charCodeAt(0)));
                            const keyBytes = stringToUint8Array(key);
                            const resultBytes = new Uint8Array(dataBytes.length);
                            
                            for (let i = 0; i < dataBytes.length; i++) {
                                resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                            }
                            
                            decryptedString += uint8ArrayToString(resultBytes);
                        }
                        
                        return JSON.parse(decryptedString);
                        
                    case 'aes':
                        // ç°¡åŒ–çš„ AES æ¨¡æ“¬è§£å¯† - èˆ‡åŠ å¯†å®Œå…¨å°ç¨±
                        const encryptedChunksAES = encryptedData.split('|');
                        let decryptedStringAES = '';
                        
                        for (const chunk of encryptedChunksAES) {
                            const encryptedString = atob(chunk);
                            const dataBytes = new Uint8Array(encryptedString.split('').map(char => char.charCodeAt(0)));
                            const keyBytes = stringToUint8Array(key);
                            const resultBytes = new Uint8Array(dataBytes.length);
                            
                            // ä½¿ç”¨èˆ‡åŠ å¯†å®Œå…¨å°ç¨±çš„è§£å¯†éç¨‹
                            for (let i = 0; i < dataBytes.length; i++) {
                                const keyByte = keyBytes[i % keyBytes.length];
                                resultBytes[i] = (dataBytes[i] - keyByte - 123 + 256) % 256;
                            }
                            
                            decryptedStringAES += uint8ArrayToString(resultBytes);
                        }
                        
                        return JSON.parse(decryptedStringAES);
                        
                    default:
                        return encryptedData;
                }
            } catch (e) {
                console.error('è§£å¯†å¤±æ•—:', e);
                showNotification("è³‡æ–™è§£å¯†å¤±æ•—ï¼Œè«‹æª¢æŸ¥åŠ å¯†é‡‘é‘°æ˜¯å¦æ­£ç¢º", "error");
                return null;
            }
        }
        
        // ç”¢ç”ŸæŸ¥è©¢é é¢
        function generateQueryPage() {
            // æª¢æŸ¥æ˜¯å¦é¸æ“‡äº†æ¨¡æ¿
            if (!config.template) {
                showNotification('è«‹é¸æ“‡ä¸€å€‹ç¶²é æ¨¡æ¿ï¼', 'error');
                return;
            }
            
            // ç”¢ç”ŸæŸ¥è©¢é é¢ HTML
            const queryPageHTML = generateQueryPageHTML();
            
            // å»ºç«‹ä¸€å€‹æ–°çš„ blob ä¸¦ä¸‹è¼‰
            const blob = new Blob([queryPageHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'query_page.html';
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('æŸ¥è©¢é é¢å·²ç”Ÿæˆï¼è«‹ä¸‹è¼‰ä¸¦é–‹å•Ÿæª”æ¡ˆã€‚', 'success');
        }
        
        // ç”¢ç”ŸæŸ¥è©¢é é¢ HTML
        function generateQueryPageHTML() {
            // ç²å–ç•¶å‰é¸æ“‡çš„æ¨¡æ¿
            const template = templates[config.template];
            
            // æº–å‚™è³‡æ–™ï¼Œå¦‚æœå•Ÿç”¨äº†åŠ å¯†å‰‡åŠ å¯†è³‡æ–™
            let processedWorksheetData = worksheetData;
            let encryptionInfo = '';
            
            if (config.enableEncryption) {
                // åŠ å¯†æ•´å€‹æ•¸æ“šé›†
                processedWorksheetData = encryptData(worksheetData, config.encryptionMethod, config.encryptionKey);
                encryptionInfo = JSON.stringify({
                    enabled: true,
                    method: config.encryptionMethod,
                    key: config.encryptionKey
                });
            } else {
                encryptionInfo = JSON.stringify({
                    enabled: false
                });
            }
            
            // ç”Ÿæˆæœå°‹æ¬„ä½ HTML
            let searchFieldsHtml = '';
            config.searchFields.forEach((field, index) => {
                if (field.type === 'dropdown') {
                    // ç”Ÿæˆä¸‹æ‹‰å¼é¸å–®
                    const fieldIndex = headers.indexOf(field.field);
                    const uniqueValues = new Set();
                    
                    // æ”¶é›†è©²æ¬„ä½çš„æ‰€æœ‰å”¯ä¸€å€¼
                    for (let i = 1; i < worksheetData.length; i++) {
                        const value = worksheetData[i][fieldIndex];
                        if (value !== undefined && value !== null && value !== '') {
                            uniqueValues.add(String(value).trim());
                        }
                    }
                    
                    // å°‡Setè½‰ç‚ºé™£åˆ—ä¸¦æ’åº
                    const sortedValues = Array.from(uniqueValues).sort();
                    
                    // ç”Ÿæˆä¸‹æ‹‰å¼é¸å–®çš„é¸é …
                    let optionsHtml = '<option value="">è«‹é¸æ“‡</option>';
                    sortedValues.forEach(value => {
                        let optionValue = value;
                        let displayValue = value;
                        
                        // å¦‚æœå•Ÿç”¨äº†æœå°‹æ¬„ä½åŠ å¯†ä¸”æ­¤æ¬„ä½åœ¨åŠ å¯†åˆ—è¡¨ä¸­ï¼Œå‰‡åŠ å¯†é¸é …å€¼
                        if (config.enableSearchEncryption && config.searchEncryptionFields.includes(field.field)) {
                            optionValue = encryptValue(value, config.encryptionMethod, config.encryptionKey);
                        }
                        
                        optionsHtml += `<option value="${escapeHtml(optionValue)}">${escapeHtml(displayValue)}</option>`;
                    });
                    
                    searchFieldsHtml += 
                        '<div>' +
                        '<label class="block mb-2 font-medium text-gray-700 required-field">' + escapeHtml(field.label) + '</label>' +
                        '<select id="search' + index + '" class="cute-select w-full">' + optionsHtml + '</select>' +
                        '</div>';
                } else if (field.type === 'password') {
                    // ç”Ÿæˆå¯†ç¢¼è¼¸å…¥æ¡†
                    searchFieldsHtml += 
                        '<div>' +
                        '<label class="block mb-2 font-medium text-gray-700 required-field">' + escapeHtml(field.label) + '</label>' +
                        '<input type="password" id="search' + index + '" class="cute-input w-full" placeholder="è«‹è¼¸å…¥' + escapeHtml(field.label) + '">' +
                        '</div>';
                } else {
                    // ç”Ÿæˆæ–‡å­—è¼¸å…¥æ¡†
                    searchFieldsHtml += 
                        '<div>' +
                        '<label class="block mb-2 font-medium text-gray-700 required-field">' + escapeHtml(field.label) + '</label>' +
                        '<input type="text" id="search' + index + '" class="cute-input w-full" placeholder="è«‹è¼¸å…¥' + escapeHtml(field.label) + '">' +
                        '</div>';
                }
            });
            
            // ç”ŸæˆæŸ¥è©¢æ–¹å¼é¸é … HTML
            let searchModeOptionsHtml = '';
            if (config.searchModes.includes('exact')) {
                // å¦‚æœåªæœ‰ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼Œæˆ–è€…é€™æ˜¯ç¬¬ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼Œå‰‡è¨­ç‚ºé¸ä¸­
                const checked = config.searchModes.length === 1 || config.searchModes[0] === 'exact' ? 'checked' : '';
                searchModeOptionsHtml += 
                    '<label class="inline-flex items-center mr-6">' +
                    '<input type="radio" name="searchMode" value="exact" class="cute-radio" ' + checked + '>' +
                    '<span class="ml-2">å®Œå…¨ç¬¦åˆæŸ¥è©¢</span>' +
                    '</label>';
            }
            if (config.searchModes.includes('contains')) {
                // å¦‚æœåªæœ‰ä¸€ç¨®æŸ¥è©¢æ–¹å¼ï¼Œå‰‡è¨­ç‚ºé¸ä¸­
                const checked = config.searchModes.length === 1 || (config.searchModes.length > 1 && config.searchModes[0] === 'contains') ? 'checked' : '';
                searchModeOptionsHtml += 
                    '<label class="inline-flex items-center">' +
                    '<input type="radio" name="searchMode" value="contains" class="cute-radio" ' + checked + '>' +
                    '<span class="ml-2">å«é—œéµå­—æŸ¥è©¢</span>' +
                    '</label>';
            }
            
            // ç”Ÿæˆ JavaScript ä»£ç¢¼
            const javascriptCode = `
                // è¼‰å…¥è³‡æ–™
                const worksheetData = ${JSON.stringify(processedWorksheetData)};
                const encryptionInfo = ${encryptionInfo};
                const config = ${JSON.stringify(config)};
                
                // å®šç¾©æ¨™é¡Œè¡Œ
                const headers = ${JSON.stringify(headers)};
                
                // ç•¶å‰çµæœå‘ˆç¾æ–¹å¼
                let currentDisplayMode = config.displayModes[0] || 'list';
                
                // ç•¶å‰æŸ¥è©¢çµæœ
                let currentResults = [];
                
                // å­—ç¬¦ä¸²è½‰æ›ç‚º Uint8Array
                function stringToUint8Array(str) {
                    const encoder = new TextEncoder();
                    return encoder.encode(str);
                }
                
                // Uint8Array è½‰æ›ç‚ºå­—ç¬¦ä¸²
                function uint8ArrayToString(uint8Array) {
                    const decoder = new TextDecoder();
                    return decoder.decode(uint8Array);
                }
                
                // åŠ å¯†å–®å€‹å€¼
                function encryptValue(value, method, key) {
                    if (!value) return value;
                    
                    try {
                        switch (method) {
                            case 'base64':
                                return btoa(unescape(encodeURIComponent(value)));
                                
                            case 'xor':
                                // ä½¿ç”¨æ”¹é€²çš„ XOR åŠ å¯†
                                const dataBytes = stringToUint8Array(value);
                                const keyBytes = stringToUint8Array(key);
                                const resultBytes = new Uint8Array(dataBytes.length);
                                
                                for (let i = 0; i < dataBytes.length; i++) {
                                    resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                                }
                                
                                return btoa(String.fromCharCode.apply(null, resultBytes));
                                
                            case 'aes':
                                // ç°¡åŒ–çš„ AES æ¨¡æ“¬åŠ å¯† - ä½¿ç”¨å–®ä¸€è¼ªæ¬¡ï¼Œç¢ºä¿ä¸€è‡´æ€§
                                const dataBytesAES = stringToUint8Array(value);
                                const keyBytesAES = stringToUint8Array(key);
                                const resultBytesAES = new Uint8Array(dataBytesAES.length);
                                
                                // ç°¡å–®çš„å–®è¼ªåŠ å¯†ï¼Œé¿å…è¤‡é›œæ€§å°è‡´çš„éŒ¯èª¤
                                for (let i = 0; i < dataBytesAES.length; i++) {
                                    const keyByte = keyBytesAES[i % keyBytesAES.length];
                                    resultBytesAES[i] = (dataBytesAES[i] + keyByte + 123) % 256; // ä½¿ç”¨å›ºå®šåç§»é‡
                                }
                                
                                return btoa(String.fromCharCode.apply(null, resultBytesAES));
                                
                            default:
                                return value;
                        }
                    } catch (e) {
                        console.error('åŠ å¯†å¤±æ•—:', e);
                        return value;
                    }
                }
                
                // è§£å¯†å–®å€‹å€¼
                function decryptValue(encryptedValue, method, key) {
                    if (!encryptedValue) return encryptedValue;
                    
                    try {
                        switch (method) {
                            case 'base64':
                                return decodeURIComponent(escape(atob(encryptedValue)));
                                
                            case 'xor':
                                // ä½¿ç”¨æ”¹é€²çš„ XOR è§£å¯†
                                const encryptedData = atob(encryptedValue);
                                const dataBytes = new Uint8Array(encryptedData.split('').map(char => char.charCodeAt(0)));
                                const keyBytes = stringToUint8Array(key);
                                const resultBytes = new Uint8Array(dataBytes.length);
                                
                                for (let i = 0; i < dataBytes.length; i++) {
                                    resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                                }
                                
                                return uint8ArrayToString(resultBytes);
                                
                            case 'aes':
                                // ç°¡åŒ–çš„ AES æ¨¡æ“¬è§£å¯† - å¿…é ˆèˆ‡åŠ å¯†å®Œå…¨å°ç¨±
                                const encryptedDataAES = atob(encryptedValue);
                                const dataBytesAES = new Uint8Array(encryptedDataAES.split('').map(char => char.charCodeAt(0)));
                                const keyBytesAES = stringToUint8Array(key);
                                const resultBytesAES = new Uint8Array(dataBytesAES.length);
                                
                                // èˆ‡åŠ å¯†å®Œå…¨å°ç¨±çš„è§£å¯†éç¨‹
                                for (let i = 0; i < dataBytesAES.length; i++) {
                                    const keyByte = keyBytesAES[i % keyBytesAES.length];
                                    resultBytesAES[i] = (dataBytesAES[i] - keyByte - 123 + 256) % 256; // ä½¿ç”¨ç›¸åŒçš„å›ºå®šåç§»é‡
                                }
                                
                                return uint8ArrayToString(resultBytesAES);
                                
                            default:
                                return encryptedValue;
                        }
                    } catch (e) {
                        console.error('è§£å¯†å¤±æ•—:', e);
                        return null;
                    }
                }
                
                // åŠ å¯†è³‡æ–™å‡½æ•¸ - ä¿®å¾©å †ç–Šæº¢å‡ºå•é¡Œ
                function encryptData(data, method, key) {
                    if (!data) return data;
                    
                    try {
                        switch (method) {
                            case 'base64':
                                return btoa(unescape(encodeURIComponent(JSON.stringify(data))));
                                
                            case 'xor':
                                // ä½¿ç”¨æ”¹é€²çš„ XOR åŠ å¯† - åˆ†æ‰¹è™•ç†é¿å…å †ç–Šæº¢å‡º
                                const jsonString = JSON.stringify(data);
                                const chunkSize = 1000; // æ¯æ¬¡è™•ç†1000å€‹å­—ç¬¦
                                let encryptedChunks = [];
                                
                                for (let i = 0; i < jsonString.length; i += chunkSize) {
                                    const chunk = jsonString.substring(i, i + chunkSize);
                                    const dataBytes = stringToUint8Array(chunk);
                                    const keyBytes = stringToUint8Array(key);
                                    const resultBytes = new Uint8Array(dataBytes.length);
                                    
                                    for (let j = 0; j < dataBytes.length; j++) {
                                        resultBytes[j] = dataBytes[j] ^ keyBytes[j % keyBytes.length];
                                    }
                                    
                                    encryptedChunks.push(btoa(String.fromCharCode.apply(null, resultBytes)));
                                }
                                
                                return encryptedChunks.join('|'); // ä½¿ç”¨|åˆ†éš”ç¬¦é€£æ¥åŠ å¯†å¡Š
                                
                            case 'aes':
                                // ç°¡åŒ–çš„ AES æ¨¡æ“¬åŠ å¯† - èˆ‡å–®å€‹å€¼åŠ å¯†ä½¿ç”¨ç›¸åŒçš„é‚è¼¯
                                const jsonStringAES = JSON.stringify(data);
                                const chunkSizeAES = 1000; // æ¯æ¬¡è™•ç†1000å€‹å­—ç¬¦
                                let encryptedChunksAES = [];
                                
                                for (let i = 0; i < jsonStringAES.length; i += chunkSizeAES) {
                                    const chunk = jsonStringAES.substring(i, i + chunkSizeAES);
                                    const dataBytes = stringToUint8Array(chunk);
                                    const keyBytes = stringToUint8Array(key);
                                    const resultBytes = new Uint8Array(dataBytes.length);
                                    
                                    // ä½¿ç”¨èˆ‡å–®å€‹å€¼åŠ å¯†ç›¸åŒçš„ç°¡å–®é‚è¼¯
                                    for (let j = 0; j < dataBytes.length; j++) {
                                        const keyByte = keyBytes[j % keyBytes.length];
                                        resultBytes[j] = (dataBytes[j] + keyByte + 123) % 256;
                                    }
                                    
                                    encryptedChunksAES.push(btoa(String.fromCharCode.apply(null, resultBytes)));
                                }
                                
                                return encryptedChunksAES.join('|'); // ä½¿ç”¨|åˆ†éš”ç¬¦é€£æ¥åŠ å¯†å¡Š
                                
                            default:
                                return data;
                        }
                    } catch (e) {
                        console.error('åŠ å¯†å¤±æ•—:', e);
                        return null;
                    }
                }
                
                // è§£å¯†è³‡æ–™å‡½æ•¸ - ä¿®å¾©å †ç–Šæº¢å‡ºå•é¡Œ
                function decryptData(encryptedData, method, key) {
                    if (!encryptedData) return encryptedData;
                    
                    try {
                        switch (method) {
                            case 'base64':
                                return JSON.parse(decodeURIComponent(escape(atob(encryptedData))));
                                
                            case 'xor':
                                // ä½¿ç”¨æ”¹é€²çš„ XOR è§£å¯† - åˆ†æ‰¹è™•ç†é¿å…å †ç–Šæº¢å‡º
                                const encryptedChunks = encryptedData.split('|');
                                let decryptedString = '';
                                
                                for (const chunk of encryptedChunks) {
                                    const encryptedString = atob(chunk);
                                    const dataBytes = new Uint8Array(encryptedString.split('').map(char => char.charCodeAt(0)));
                                    const keyBytes = stringToUint8Array(key);
                                    const resultBytes = new Uint8Array(dataBytes.length);
                                    
                                    for (let i = 0; i < dataBytes.length; i++) {
                                        resultBytes[i] = dataBytes[i] ^ keyBytes[i % keyBytes.length];
                                    }
                                    
                                    decryptedString += uint8ArrayToString(resultBytes);
                                }
                                
                                return JSON.parse(decryptedString);
                                
                            case 'aes':
                                // ç°¡åŒ–çš„ AES æ¨¡æ“¬è§£å¯† - èˆ‡åŠ å¯†å®Œå…¨å°ç¨±
                                const encryptedChunksAES = encryptedData.split('|');
                                let decryptedStringAES = '';
                                
                                for (const chunk of encryptedChunksAES) {
                                    const encryptedString = atob(chunk);
                                    const dataBytes = new Uint8Array(encryptedString.split('').map(char => char.charCodeAt(0)));
                                    const keyBytes = stringToUint8Array(key);
                                    const resultBytes = new Uint8Array(dataBytes.length);
                                    
                                    // ä½¿ç”¨èˆ‡åŠ å¯†å®Œå…¨å°ç¨±çš„è§£å¯†éç¨‹
                                    for (let i = 0; i < dataBytes.length; i++) {
                                        const keyByte = keyBytes[i % keyBytes.length];
                                        resultBytes[i] = (dataBytes[i] - keyByte - 123 + 256) % 256;
                                    }
                                    
                                    decryptedStringAES += uint8ArrayToString(resultBytes);
                                }
                                
                                return JSON.parse(decryptedStringAES);
                                
                            default:
                                return encryptedData;
                        }
                    } catch (e) {
                        console.error('è§£å¯†å¤±æ•—:', e);
                        showNotification("è³‡æ–™è§£å¯†å¤±æ•—ï¼Œè«‹æª¢æŸ¥åŠ å¯†é‡‘é‘°æ˜¯å¦æ­£ç¢º", "error");
                        return null;
                    }
                }
                
                // åŸ·è¡Œæœå°‹
                function performSearch() {
                    console.log('é–‹å§‹åŸ·è¡Œæœå°‹');
                    
                    // æª¢æŸ¥æ‰€æœ‰æœå°‹æ¬„ä½æ˜¯å¦éƒ½æœ‰å€¼
                    let allFieldsFilled = true;
                    let emptyFields = [];
                    
                    config.searchFields.forEach((field, index) => {
                        let value;
                        if (field.type === 'dropdown') {
                            // ä¸‹æ‹‰å¼é¸å–®
                            value = document.getElementById("search" + index).value;
                        } else {
                            // æ–‡å­—è¼¸å…¥æ¡†æˆ–å¯†ç¢¼è¼¸å…¥æ¡†
                            value = document.getElementById("search" + index).value.trim();
                        }
                        
                        if (!value) {
                            allFieldsFilled = false;
                            emptyFields.push(field.label);
                        }
                    });
                    
                    if (!allFieldsFilled) {
                        showNotification("è«‹å¡«å¯«æ‰€æœ‰æœå°‹æ¬„ä½ï¼š" + emptyFields.join("ã€"), "warning");
                        return;
                    }
                    
                    // ç²å–æŸ¥è©¢æ–¹å¼
                    const searchModeRadio = document.querySelector('input[name="searchMode"]:checked');
                    if (!searchModeRadio) {
                        showNotification("è«‹é¸æ“‡æŸ¥è©¢æ–¹å¼ï¼", "warning");
                        return;
                    }
                    const searchMode = searchModeRadio.value;
                    console.log('æŸ¥è©¢æ–¹å¼:', searchMode);
                    
                    const searchTerms = [];
                    config.searchFields.forEach((field, index) => {
                        let value;
                        if (field.type === 'dropdown') {
                            // ä¸‹æ‹‰å¼é¸å–®
                            const select = document.getElementById("search" + index);
                            value = select.value;
                            
                            // å¦‚æœå•Ÿç”¨äº†æœå°‹æ¬„ä½åŠ å¯†ä¸”æ­¤æ¬„ä½åœ¨åŠ å¯†åˆ—è¡¨ä¸­ï¼Œå‰‡è§£å¯†é¸é …å€¼
                            if (config.enableSearchEncryption && config.searchEncryptionFields.includes(field.field) && value) {
                                value = decryptValue(value, encryptionInfo.method, encryptionInfo.key);
                            }
                        } else {
                            // æ–‡å­—è¼¸å…¥æ¡†æˆ–å¯†ç¢¼è¼¸å…¥æ¡†
                            value = document.getElementById("search" + index).value.trim();
                        }
                        
                        if (value) {
                            searchTerms.push({
                                field: field.field,
                                value: value.toLowerCase(),
                                originalValue: value
                            });
                            console.log(\`æœå°‹æ¢ä»¶ \${index}: æ¬„ä½="\${field.field}", å€¼="\${value}"\`);
                        }
                    });
                    
                    if (searchTerms.length === 0) {
                        showNotification("è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹æœå°‹æ¢ä»¶ï¼", "warning");
                        return;
                    }
                    
                    console.log('æ‰€æœ‰æœå°‹æ¢ä»¶:', searchTerms);
                    
                    // ç²å–å¯¦éš›è³‡æ–™
                    let actualData;
                    if (encryptionInfo.enabled) {
                        console.log('è§£å¯†è³‡æ–™ä¸­...');
                        actualData = decryptData(worksheetData, encryptionInfo.method, encryptionInfo.key);
                        if (!actualData) {
                            console.error('è³‡æ–™è§£å¯†å¤±æ•—');
                            showNotification("è³‡æ–™è§£å¯†å¤±æ•—ï¼Œè«‹æª¢æŸ¥åŠ å¯†é‡‘é‘°æ˜¯å¦æ­£ç¢º", "error");
                            return;
                        }
                        console.log('è³‡æ–™è§£å¯†å®Œæˆï¼Œè³‡æ–™ç­†æ•¸:', actualData ? actualData.length : 0);
                    } else {
                        actualData = worksheetData;
                        console.log('ä½¿ç”¨æœªåŠ å¯†è³‡æ–™ï¼Œè³‡æ–™ç­†æ•¸:', actualData ? actualData.length : 0);
                    }
                    
                    // åŸ·è¡Œæœå°‹é‚è¼¯
                    const results = [];
                    for (let i = 1; i < actualData.length; i++) {
                        const row = actualData[i];
                        let match = true;
                        
                        for (const term of searchTerms) {
                            const fieldIndex = headers.indexOf(term.field);
                            
                            if (fieldIndex !== -1) {
                                const cellValue = String(row[fieldIndex] || "");
                                const searchTerm = term.value;
                                
                                // æ ¹æ“šæŸ¥è©¢æ–¹å¼é€²è¡Œæ¯”è¼ƒ
                                if (searchMode === 'exact') {
                                    // å®Œå…¨ç¬¦åˆæŸ¥è©¢ï¼šä¸å€åˆ†å¤§å°å¯«å®Œå…¨åŒ¹é…
                                    if (cellValue.toLowerCase() !== searchTerm.toLowerCase()) {
                                        match = false;
                                        break;
                                    }
                                } else {
                                    // å«é—œéµå­—æŸ¥è©¢ï¼šä¸å€åˆ†å¤§å°å¯«åŒ…å«
                                    if (!cellValue.toLowerCase().includes(searchTerm.toLowerCase())) {
                                        match = false;
                                        break;
                                    }
                                }
                            } else {
                                match = false;
                                break;
                            }
                        }
                        
                        if (match) {
                            results.push(row);
                        }
                    }
                    
                    console.log(\`æœå°‹å®Œæˆï¼Œæ‰¾åˆ° \${results.length} ç­†çµæœ\`);
                    
                    // å»é‡è™•ç†
                    let finalResults = results;
                    if (config.removeDuplicates && results.length > 0) {
                        finalResults = removeDuplicates(results);
                        console.log(\`å»é‡å¾Œå‰©é¤˜ \${finalResults.length} ç­†çµæœ\`);
                    }
                    
                    // å„²å­˜ç•¶å‰çµæœ
                    currentResults = finalResults;
                    
                    // é¡¯ç¤ºçµæœ
                    displayResults(finalResults);
                }
                
                // å»é™¤é‡è¤‡è³‡æ–™
                function removeDuplicates(results) {
                    const seen = new Set();
                    const uniqueResults = [];
                    
                    results.forEach(row => {
                        // å‰µå»ºä¸€å€‹åŸºæ–¼æ‰€æœ‰é¡¯ç¤ºæ¬„ä½çš„å”¯ä¸€éµ
                        let keyParts = [];
                        config.displayFields.forEach(field => {
                            const fieldIndex = headers.indexOf(field.field);
                            if (fieldIndex !== -1) {
                                const value = String(row[fieldIndex] || "").trim();
                                keyParts.push(value);
                            }
                        });
                        
                        // å¦‚æœæ‰€æœ‰é¡¯ç¤ºæ¬„ä½éƒ½ç‚ºç©ºï¼Œå‰‡ä½¿ç”¨æ•´è¡Œæ•¸æ“šä½œç‚ºéµ
                        const key = keyParts.length > 0 ? keyParts.join("|") : JSON.stringify(row);
                        
                        if (!seen.has(key)) {
                            seen.add(key);
                            uniqueResults.push(row);
                        }
                    });
                    
                    return uniqueResults;
                }
                
                // é¡¯ç¤ºçµæœ
                function displayResults(results) {
                    const resultsDiv = document.getElementById("results");
                    
                    if (results.length === 0) {
                        resultsDiv.innerHTML = 
                            "<div class=\\"no-results\\">" +
                            "<span class=\\"text-4xl\\">ğŸ˜¢</span>" +
                            "<p>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„è³‡æ–™</p>" +
                            "</div>";
                        return;
                    }
                    
                    // æ ¹æ“šç•¶å‰å‘ˆç¾æ–¹å¼é¡¯ç¤ºçµæœ
                    if (currentDisplayMode === 'list') {
                        displayResultsAsList(results);
                    } else if (currentDisplayMode === 'table') {
                        displayResultsAsTable(results);
                    }
                }
                
                // ä»¥åˆ—è¡¨å½¢å¼é¡¯ç¤ºçµæœ
                function displayResultsAsList(results) {
                    const resultsDiv = document.getElementById("results");
                    let html = '<div class="results-container">';
                    
                    results.forEach((row, index) => {
                        html += "<div class=\\"result-row\\">";
                        config.displayFields.forEach(field => {
                            const fieldIndex = headers.indexOf(field.field);
                            const value = fieldIndex !== -1 ? escapeHtml(String(row[fieldIndex] || "")) : "";
                            html += "<div class=\\"result-field\\"><strong>" + escapeHtml(field.label) + ":</strong> " + value + "</div>";
                        });
                        html += "</div>";
                    });
                    
                    html += '</div>';
                    resultsDiv.innerHTML = html;
                }
                
                // ä»¥è¡¨æ ¼å½¢å¼é¡¯ç¤ºçµæœ
                function displayResultsAsTable(results) {
                    const resultsDiv = document.getElementById("results");
                    
                    // å»ºç«‹è¡¨æ ¼çµæ§‹
                    let html = "<div class=\\"table-container\\">";
                    html += "<table class=\\"result-table\\">";
                    
                    // è¡¨é ­
                    html += "<thead>";
                    html += "<tr>";
                    config.displayFields.forEach(field => {
                        html += "<th>" + escapeHtml(field.label) + "</th>";
                    });
                    html += "</tr>";
                    html += "</thead>";
                    
                    // è¡¨èº«
                    html += "<tbody>";
                    results.forEach((row, index) => {
                        html += "<tr>";
                        config.displayFields.forEach(field => {
                            const fieldIndex = headers.indexOf(field.field);
                            const value = fieldIndex !== -1 ? escapeHtml(String(row[fieldIndex] || "")) : "";
                            html += "<td>" + value + "</td>";
                        });
                        html += "</tr>";
                    });
                    html += "</tbody>";
                    
                    html += "</table>";
                    html += "</div>";
                    
                    resultsDiv.innerHTML = html;
                }
                
                // åˆ‡æ›çµæœå‘ˆç¾æ–¹å¼
                function switchDisplayMode(mode) {
                    currentDisplayMode = mode;
                    
                    // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                    document.querySelectorAll('.display-mode-btn').forEach(btn => {
                        if (btn.dataset.mode === mode) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    
                    // é‡æ–°é¡¯ç¤ºçµæœ
                    displayResults(currentResults);
                }
                
                // é¡¯ç¤ºé€šçŸ¥
                function showNotification(message, type) {
                    const colors = {
                        success: "bg-green-500",
                        warning: "bg-yellow-500",
                        error: "bg-red-500"
                    };
                    
                    const notification = document.createElement("div");
                    notification.className = "fixed top-4 right-4 " + colors[type] + " text-white px-6 py-3 rounded-lg shadow-lg z-50";
                    notification.textContent = message;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                }
                
                // HTML è·³è„«å‡½æ•¸
                function escapeHtml(text) {
                    const map = {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#039;'
                    };
                    return text.replace(/[&<>"']/g, m => map[m]);
                }
                
                // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
                document.addEventListener('DOMContentLoaded', function() {
                    console.log('é é¢è¼‰å…¥å®Œæˆ');
                    console.log('åŠ å¯†è¨­å®šï¼š', encryptionInfo.enabled ? 'å·²å•Ÿç”¨' : 'æœªå•Ÿç”¨');
                    
                    // å¦‚æœæœ‰å¤šç¨®å‘ˆç¾æ–¹å¼ï¼Œå‰‡é¡¯ç¤ºåˆ‡æ›æŒ‰éˆ•
                    if (config.displayModes.length > 1) {
                        const switcher = document.getElementById('displayModeSwitcher');
                        switcher.style.display = 'block';
                        
                        // ç”Ÿæˆåˆ‡æ›æŒ‰éˆ•
                        let buttonsHtml = '';
                        config.displayModes.forEach(mode => {
                            const modeNames = {
                                'list': 'ç¸±å‘æ¢åˆ—å¼',
                                'table': 'æ©«å‘è¡¨æ ¼å¼'
                            };
                            const isActive = mode === currentDisplayMode ? 'active' : '';
                            buttonsHtml += \`<button class="display-mode-btn \${isActive}" data-mode="\${mode}" onclick="switchDisplayMode('\${mode}')">\${modeNames[mode]}</button>\`;
                        });
                        switcher.innerHTML = '<span>å‘ˆç¾æ–¹å¼ï¼š</span>' + buttonsHtml;
                    }
                });
            `;
            
            return '<!DOCTYPE html>' +
            '<html lang="zh-TW">' +
            '<head>' +
            '<meta charset="UTF-8">' +
            '<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
            '<title>' + escapeHtml(config.pageTitle) + '</title>' +
            '<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">' +
            '<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">' +
            '<style>' +
            'body {' +
            '    font-family: \'Noto Sans TC\', sans-serif;' +
            '    background: ' + template.bodyBackground + ';' +
            '    min-height: 100vh;' +
            '    padding: 20px 0;' +
            '}' +
            '' +
            '.cute-card {' +
            '    background: ' + template.cardBackground + ';' +
            '    border-radius: 20px;' +
            '    box-shadow: ' + template.cardShadow + ';' +
            '    transition: transform 0.3s ease;' +
            '}' +
            '' +
            '.cute-card:hover {' +
            '    transform: ' + template.cardHoverTransform + ';' +
            '}' +
            '' +
            '.cute-button {' +
            '    background: ' + template.buttonBackground + ';' +
            '    color: white;' +
            '    padding: 12px 30px;' +
            '    border-radius: 25px;' +
            '    border: none;' +
            '    font-weight: 500;' +
            '    transition: all 0.3s ease;' +
            '    cursor: pointer;' +
            '}' +
            '' +
            '.cute-button:hover {' +
            '    background: ' + template.buttonHoverBackground + ';' +
            '    transform: ' + template.buttonHoverTransform + ';' +
            '    box-shadow: ' + template.buttonHoverShadow + ';' +
            '}' +
            '' +
            '.cute-input {' +
            '    border: ' + template.inputBorder + ';' +
            '    border-radius: 15px;' +
            '    padding: 10px 15px;' +
            '    transition: all 0.3s ease;' +
            '}' +
            '' +
            '.cute-input:focus {' +
            '    outline: none;' +
            '    border: ' + template.inputFocusBorder + ';' +
            '    box-shadow: ' + template.inputFocusShadow + ';' +
            '}' +
            '' +
            '.cute-select {' +
            '    border: ' + template.inputBorder + ';' +
            '    border-radius: 15px;' +
            '    padding: 10px 15px;' +
            '    background: white;' +
            '    transition: all 0.3s ease;' +
            '}' +
            '' +
            '.cute-select:focus {' +
            '    outline: none;' +
            '    border: ' + template.inputFocusBorder + ';' +
            '}' +
            '' +
            '.cute-radio {' +
            '    width: 18px;' +
            '    height: 18px;' +
            '    accent-color: #fd79a8;' +
            '}' +
            '' +
            '.result-row {' +
            '    background: ' + template.resultRowBackground + ';' +
            '    border-radius: 20px;' +
            '    padding: 20px;' +
            '    margin-bottom: 15px;' +
            '    transition: all 0.3s ease;' +
            '    text-align: left;' +
            '    border: 2px solid transparent;' +
            '    box-shadow: 0 5px 15px rgba(0,0,0,0.1);' +
            '}' +
            '' +
            '.result-row:hover {' +
            '    background: ' + template.resultRowHoverBackground + ';' +
            '    transform: ' + template.resultRowHoverTransform + ';' +
            '    border-color: ' + template.resultFieldBorder + ';' +
            '}' +
            '' +
            '.result-field {' +
            '    margin-bottom: 12px;' +
            '    padding: 8px 12px;' +
            '    background: ' + template.resultFieldBackground + ';' +
            '    border-radius: 10px;' +
            '    border-left: 4px solid ' + template.resultFieldBorder + ';' +
            '    font-size: 16px;' +
            '    line-height: 1.5;' +
            '}' +
            '' +
            '.result-field strong {' +
            '    color: #2d3436;' +
            '    font-weight: 600;' +
            '    margin-right: 8px;' +
            '}' +
            '' +
            '.no-results {' +
            '    text-align: center;' +
            '    padding: 60px 20px;' +
            '    color: #636e72;' +
            '    font-size: 20px;' +
            '    background: rgba(255,255,255,0.8);' +
            '    border-radius: 20px;' +
            '    box-shadow: 0 5px 15px rgba(0,0,0,0.1);' +
            '}' +
            '' +
            '.required-field::after {' +
            '    content: " *";' +
            '    color: #e74c3c;' +
            '    font-weight: bold;' +
            '}' +
            '' +
            /* çµæœå®¹å™¨æ¨£å¼ - ç¾åŒ–é¡¯ç¤ºç‰ˆé¢ */
            '.results-container {' +
            '    max-width: 900px;' +
            '    margin: 0 auto;' +
            '    padding: 20px;' +
            '    background: ' + template.resultContainerBackground + ';' +
            '    border-radius: 25px;' +
            '    border: ' + template.resultContainerBorder + ';' +
            '    box-shadow: 0 10px 30px rgba(0,0,0,0.15);' +
            '    backdrop-filter: blur(10px);' +
            '}' +
            '' +
            /* è¡¨æ ¼å®¹å™¨æ¨£å¼ */
            '.table-container {' +
            '    overflow-x: auto;' +
            '    margin: 20px auto;' +
            '    max-width: 1000px;' +
            '    padding: 20px;' +
            '    background: ' + template.resultContainerBackground + ';' +
            '    border-radius: 25px;' +
            '    border: ' + template.resultContainerBorder + ';' +
            '    box-shadow: 0 10px 30px rgba(0,0,0,0.15);' +
            '    backdrop-filter: blur(10px);' +
            '}' +

            /* è¡¨æ ¼æ¨£å¼ */
            '.result-table {' +
            '    width: 100%;' +
            '    border-collapse: collapse;' +
            '    border-radius: 15px;' +
            '    overflow: hidden;' +
            '    box-shadow: 0 5px 15px rgba(0,0,0,0.1);' +
            '}' +

            /* è¡¨é ­æ¨£å¼ */
            '.result-table thead {' +
            '    background-color: rgba(253, 121, 168, 0.3);' +
            '}' +

            '.result-table th {' +
            '    padding: 18px;' +
            '    text-align: left;' +
            '    font-weight: 600;' +
            '    color: #2d3436;' +
            '    border-bottom: 3px solid #ffeaa7;' +
            '    font-size: 16px;' +
            '}' +

            /* è¡¨æ ¼å–®å…ƒæ ¼æ¨£å¼ */
            '.result-table td {' +
            '    padding: 15px 18px;' +
            '    border-bottom: 1px solid rgba(255, 234, 167, 0.3);' +
            '    text-align: left;' +
            '    font-size: 15px;' +
            '    line-height: 1.5;' +
            '}' +

            /* è¡¨æ ¼è¡Œæ¨£å¼ */
            '.result-table tbody tr {' +
            '    transition: all 0.3s ease;' +
            '}' +

            '.result-table tbody tr:nth-child(even) {' +
            '    background-color: rgba(255, 255, 255, 0.5);' +
            '}' +

            '.result-table tbody tr:hover {' +
            '    background-color: rgba(255, 224, 230, 0.7);' +
            '    transform: scale(1.02);' +
            '    box-shadow: 0 5px 15px rgba(0,0,0,0.15);' +
            '}' +

            /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
            '@media screen and (max-width: 768px) {' +
            '    .result-table {' +
            '        font-size: 14px;' +
            '    }' +
            '    ' +
            '    .result-table th, ' +
            '    .result-table td {' +
            '        padding: 12px;' +
            '    }' +
            '    ' +
            '    .results-container {' +
            '        max-width: 95%;' +
            '        padding: 15px;' +
            '    }' +
            '    ' +
            '    .result-row {' +
            '        padding: 15px;' +
            '    }' +
            '    ' +
            '    .result-field {' +
            '        font-size: 14px;' +
            '        margin-bottom: 10px;' +
            '    }' +
            '}' +
            '' +
            /* å‘ˆç¾æ–¹å¼åˆ‡æ›æŒ‰éˆ•æ¨£å¼ */
            '.display-mode-switcher {' +
            '    display: flex;' +
            '    justify-content: center;' +
            '    margin-bottom: 25px;' +
            '    flex-wrap: wrap;' +
            '}' +
            '' +
            '.display-mode-btn {' +
            '    background: rgba(255, 255, 255, 0.8);' +
            '    border: 2px solid ' + template.resultFieldBorder + ';' +
            '    padding: 10px 20px;' +
            '    margin: 0 8px 8px 0;' +
            '    border-radius: 25px;' +
            '    cursor: pointer;' +
            '    transition: all 0.3s ease;' +
            '    font-weight: 500;' +
            '    font-size: 14px;' +
            '    color: #2d3436;' +
            '    backdrop-filter: blur(5px);' +
            '}' +
            '' +
            '.display-mode-btn.active {' +
            '    background: ' + template.buttonBackground + ';' +
            '    color: white;' +
            '    border-color: transparent;' +
            '    transform: scale(1.05);' +
            '    box-shadow: 0 5px 15px rgba(232, 67, 147, 0.3);' +
            '}' +
            '' +
            '.display-mode-btn:hover {' +
            '    background: ' + template.buttonBackground + ';' +
            '    color: white;' +
            '    border-color: transparent;' +
            '    transform: scale(1.05);' +
            '    box-shadow: 0 5px 15px rgba(232, 67, 147, 0.3);' +
            '}' +
            '' +
            /* æœå°‹çµæœæ¨™é¡Œæ¨£å¼ */
            '.results-title {' +
            '    text-align: center;' +
            '    margin-bottom: 20px;' +
            '    font-size: 24px;' +
            '    font-weight: bold;' +
            '    color: ' + template.sectionTitleColor + ';' +
            '    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);' +
            '}' +
            '' +
            /* çµæœè¨ˆæ•¸æ¨£å¼ */
            '.results-count {' +
            '    text-align: center;' +
            '    margin-bottom: 20px;' +
            '    font-size: 16px;' +
            '    color: #636e72;' +
            '    background: rgba(255, 255, 255, 0.6);' +
            '    display: inline-block;' +
            '    padding: 8px 16px;' +
            '    border-radius: 20px;' +
            '    border: 1px solid ' + template.resultFieldBorder + ';' +
            '}' +
            '</style>' +
            '</head>' +
            '<body>' +
            '<div class="container mx-auto px-4 py-8 max-w-6xl">' +
            '<!-- æ¨™é¡Œ -->' +
            '<div class="text-center mb-8">' +
            '<h1 class="text-4xl font-bold mb-2" style="color: ' + template.titleColor + '"><span class="text-4xl">' + template.icon + '</span> ' + escapeHtml(config.pageTitle) + ' <span class="text-4xl">' + template.icon + '</span></h1>' +
            '<p style="color: ' + template.subtitleColor + '" class="text-lg">ç°¡å–®åˆå¥½ç”¨çš„è³‡æ–™æŸ¥è©¢ç³»çµ±</p>' +
            '</div>' +
            '' +
            '<!-- æœå°‹å€å¡Š -->' +
            '<div class="cute-card p-8 mb-8">' +
            '<h2 class="text-2xl font-bold mb-6 text-center" style="color: ' + template.sectionTitleColor + '">ğŸ” è³‡æ–™æœå°‹</h2>' +
            '<div class="bg-blue-50 p-4 rounded-lg mb-6">' +
            '<p class="text-blue-700 text-center">' +
            '<i class="fas fa-info-circle mr-2"></i>' +
            '<strong>æ³¨æ„ï¼š</strong>æ‰€æœ‰æœå°‹æ¬„ä½éƒ½å¿…é ˆå¡«å¯«å…§å®¹æ‰èƒ½åŸ·è¡ŒæŸ¥è©¢' +
            '</p>' +
            '</div>' +
            '<div class="grid md:grid-cols-2 gap-4">' + searchFieldsHtml + '</div>' +
            
            // åªæœ‰ç•¶è¨­å®šäº†æŸ¥è©¢æ–¹å¼æ™‚æ‰é¡¯ç¤ºæŸ¥è©¢æ–¹å¼é¸æ“‡å€å¡Š
            (config.searchModes.length > 0 ? 
            '<div class="mt-6">' +
            '<label class="block mb-2 font-medium text-gray-700">æŸ¥è©¢æ–¹å¼</label>' +
            '<div class="flex space-x-6">' + searchModeOptionsHtml + '</div>' +
            '</div>' : '') +
            
            '<div class="text-center mt-6">' +
            '<button onclick="performSearch()" class="cute-button text-xl">' +
            '<span class="text-xl">ğŸ”</span> é–‹å§‹æœå°‹' +
            '</button>' +
            '</div>' +
            '</div>' +
            '' +
            '<!-- çµæœå€å¡Š -->' +
            '<div class="cute-card p-8">' +
            '<h2 class="results-title">ğŸ“Š æœå°‹çµæœ</h2>' +
            
            // å‘ˆç¾æ–¹å¼åˆ‡æ›æŒ‰éˆ•ï¼ˆå¦‚æœæœ‰å¤šç¨®å‘ˆç¾æ–¹å¼ï¼‰
            '<div id="displayModeSwitcher" class="display-mode-switcher" style="display: none;">' +
            '</div>' +
            
            '<div id="results">' +
            '<div class="no-results">' +
            '<span class="text-4xl">ğŸ“­</span>' +
            '<p>è«‹è¼¸å…¥æœå°‹æ¢ä»¶å¾Œé»æ“Šã€Œé–‹å§‹æœå°‹ã€</p>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '' +
            '<!-- é å°¾ -->' +
            '<div class="text-center mt-8" style="color: ' + template.titleColor + '">' +
            '<p>ğŸ’– ' + escapeHtml(config.unitName) + ' ğŸ’–</p>' +
            '</div>' +
            '</div>' +
            '' +
            '<script>' + javascriptCode + '<\/script>' +
            '</body>' +
            '</html>';
        }
        
        // HTML è·³è„«å‡½æ•¸
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            const colors = {
                success: 'bg-green-500',
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 ' + colors[type] + ' text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // æ‰“é–‹ä½¿ç”¨èªªæ˜æ¨¡æ…‹æ¡†
        function openHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
        }
        
        // é—œé–‰ä½¿ç”¨èªªæ˜æ¨¡æ…‹æ¡†
        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }
        
        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
        
        // ç‚ºçµæœå‘ˆç¾æ–¹å¼è¨­å®šæ·»åŠ é©—è­‰
        document.addEventListener('DOMContentLoaded', function() {
            // ç‚ºçµæœå‘ˆç¾æ–¹å¼è¨­å®šæ·»åŠ äº‹ä»¶ç›£è½å™¨
            const displayModeList = document.getElementById('displayModeList');
            const displayModeTable = document.getElementById('displayModeTable');
            
            if (displayModeList) {
                displayModeList.addEventListener('change', updateDisplayModeValidation);
            }
            
            if (displayModeTable) {
                displayModeTable.addEventListener('change', updateDisplayModeValidation);
            }
        });
    </script>
</body>
</html>